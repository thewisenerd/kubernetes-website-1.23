<!doctype html><html lang=en class=no-js>
<head>
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JPP6RFM2BP"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-JPP6RFM2BP')</script>
<link rel=alternate hreflang=zh href=https://kubernetes.io/zh/docs/tasks/inject-data-application/>
<link rel=alternate hreflang=ko href=https://kubernetes.io/ko/docs/tasks/inject-data-application/>
<link rel=alternate hreflang=ja href=https://kubernetes.io/ja/docs/tasks/inject-data-application/>
<link rel=alternate hreflang=fr href=https://kubernetes.io/fr/docs/tasks/inject-data-application/>
<link rel=alternate hreflang=de href=https://kubernetes.io/de/docs/tasks/inject-data-application/>
<link rel=alternate hreflang=es href=https://kubernetes.io/es/docs/tasks/inject-data-application/>
<link rel=alternate hreflang=id href=https://kubernetes.io/id/docs/tasks/inject-data-application/>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.87.0">
<link rel=canonical type=text/html href=https://kubernetes.io/docs/tasks/inject-data-application/>
<link rel="shortcut icon" type=image/png href=/images/favicon.png>
<link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=manifest href=/manifest.webmanifest>
<link rel=apple-touch-icon href=/images/kubernetes-192x192.png>
<title>Inject Data Into Applications | Kubernetes</title><meta property="og:title" content="Inject Data Into Applications">
<meta property="og:description" content="Specify configuration and other data for the Pods that run your workload.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://kubernetes.io/docs/tasks/inject-data-application/"><meta property="og:site_name" content="Kubernetes">
<meta itemprop=name content="Inject Data Into Applications">
<meta itemprop=description content="Specify configuration and other data for the Pods that run your workload."><meta name=twitter:card content="summary">
<meta name=twitter:title content="Inject Data Into Applications">
<meta name=twitter:description content="Specify configuration and other data for the Pods that run your workload.">
<link href=/scss/main.css rel=stylesheet>
<script src=/js/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","url":"https://kubernetes.io","logo":"https://kubernetes.io/images/favicon.png"}</script>
<meta name=theme-color content="#326ce5">
<link rel=stylesheet href=/css/feature-states.css>
<meta name=description content="Specify configuration and other data for the Pods that run your workload.">
<meta property="og:description" content="Specify configuration and other data for the Pods that run your workload.">
<meta name=twitter:description content="Specify configuration and other data for the Pods that run your workload.">
<meta property="og:url" content="https://kubernetes.io/docs/tasks/inject-data-application/">
<meta property="og:title" content="Inject Data Into Applications">
<meta name=twitter:title content="Inject Data Into Applications">
<meta name=twitter:image content="https://kubernetes.io/images/favicon.png">
<meta name=twitter:image:alt content="Kubernetes">
<meta property="og:image" content="/images/kubernetes-horizontal-color.png">
<meta property="og:type" content="article">
<script src=/js/script.js></script>
</head>
<body class=td-section>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" data-auto-burger=primary>
<a class=navbar-brand href=/></a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-2 mb-lg-0">
<a class="nav-link active" href=/docs/>Documentation</a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/blog/>Kubernetes Blog</a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/training/>Training</a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/partners/>Partners</a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/community/>Community</a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/case-studies/>Case Studies</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
Versions
</a>
<div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/releases>Release Information</a>
<a class=dropdown-item href=https://kubernetes.io/docs/tasks/inject-data-application/>v1.27</a>
<a class=dropdown-item href=https://v1-26.docs.kubernetes.io/docs/tasks/inject-data-application/>v1.26</a>
<a class=dropdown-item href=https://v1-25.docs.kubernetes.io/docs/tasks/inject-data-application/>v1.25</a>
<a class=dropdown-item href=https://v1-24.docs.kubernetes.io/docs/tasks/inject-data-application/>v1.24</a>
<a class=dropdown-item href=https://v1-23.docs.kubernetes.io/docs/tasks/inject-data-application/>v1.23</a>
</div>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdownMenuLink role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
English
</a>
<div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/zh/docs/tasks/inject-data-application/>中文 Chinese</a>
<a class=dropdown-item href=/ko/docs/tasks/inject-data-application/>한국어 Korean</a>
<a class=dropdown-item href=/ja/docs/tasks/inject-data-application/>日本語 Japanese</a>
<a class=dropdown-item href=/fr/docs/tasks/inject-data-application/>Français</a>
<a class=dropdown-item href=/de/docs/tasks/inject-data-application/>Deutsch</a>
<a class=dropdown-item href=/es/docs/tasks/inject-data-application/>Español</a>
<a class=dropdown-item href=/id/docs/tasks/inject-data-application/>Bahasa Indonesia</a>
</div>
</li>
</ul>
</div>
<button id=hamburger onclick=kub.toggleMenu() data-auto-burger-exclude><div></div></button>
</nav>
</header>
<div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<div class=td-content>
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.
</p><p>
<a href=/docs/tasks/inject-data-application/>Return to the regular view of this page</a>.
</p>
</div>
<h1 class=title>Inject Data Into Applications</h1>
<div class=lead>Specify configuration and other data for the Pods that run your workload.</div>
<ul>
<li>1: <a href=#pg-c9af1e81bb6e109f6c41febe44f0931b>Define a Command and Arguments for a Container</a></li>
<li>2: <a href=#pg-eff97c25c917cdb414eda016df0e2bca>Define Dependent Environment Variables</a></li>
<li>3: <a href=#pg-82c93897176489678232542102daea40>Define Environment Variables for a Container</a></li>
<li>4: <a href=#pg-66c0456fdbef5e5116dd606d1e6f73cc>Expose Pod Information to Containers Through Environment Variables</a></li>
<li>5: <a href=#pg-bcf93d1cd019501fd0b7649e9fbcaf60>Expose Pod Information to Containers Through Files</a></li>
<li>6: <a href=#pg-7f9454a1e775548c23ee5b300a9218a3>Distribute Credentials Securely Using Secrets</a></li>
</ul>
<div class=content>
</div>
</div>
<div class=td-content>
<h1 id=pg-c9af1e81bb6e109f6c41febe44f0931b>1 - Define a Command and Arguments for a Container</h1>
<p>This page shows how to define commands and arguments when you run a container
in a <a class=glossary-tooltip title="A Pod represents a set of running containers in your cluster." data-toggle=tooltip data-placement=top href=/docs/concepts/workloads/pods/ target=_blank aria-label=Pod>Pod</a>.</p>
<h2 id=before-you-begin>Before you begin</h2>
<p><p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
<a href=https://minikube.sigs.k8s.io/docs/tutorials/multi_node/>minikube</a>
or you can use one of these Kubernetes playgrounds:</p>
<ul>
<li><a href=https://www.katacoda.com/courses/kubernetes/playground>Katacoda</a></li>
<li><a href=http://labs.play-with-k8s.com/>Play with Kubernetes</a></li>
</ul>
To check the version, enter <code>kubectl version</code>.
</p>
<h2 id=define-a-command-and-arguments-when-you-create-a-pod>Define a command and arguments when you create a Pod</h2>
<p>When you create a Pod, you can define a command and arguments for the
containers that run in the Pod. To define a command, include the <code>command</code>
field in the configuration file. To define arguments for the command, include
the <code>args</code> field in the configuration file. The command and arguments that
you define cannot be changed after the Pod is created.</p>
<p>The command and arguments that you define in the configuration file
override the default command and arguments provided by the container image.
If you define args, but do not define a command, the default command is used
with your new arguments.</p>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> The <code>command</code> field corresponds to <code>entrypoint</code> in some container runtimes.
</div>
<p>In this exercise, you create a Pod that runs one container. The configuration
file for the Pod defines a command and two arguments:</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/en/examples/pods/commands.yaml download=pods/commands.yaml><code>pods/commands.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-commands-yaml')" title="Copy pods/commands.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-commands-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>command-demo<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>purpose</span>:<span style=color:#bbb> </span>demonstrate-command<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>command-demo-container<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>debian<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;printenv&#34;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;HOSTNAME&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;KUBERNETES_PORT&#34;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>restartPolicy</span>:<span style=color:#bbb> </span>OnFailure<span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<ol>
<li>
<p>Create a Pod based on the YAML configuration file:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl apply -f https://k8s.io/examples/pods/commands.yaml
</code></pre></div></li>
<li>
<p>List the running Pods:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get pods
</code></pre></div><p>The output shows that the container that ran in the command-demo Pod has
completed.</p>
</li>
<li>
<p>To see the output of the command that ran in the container, view the logs
from the Pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl logs command-demo
</code></pre></div><p>The output shows the values of the HOSTNAME and KUBERNETES_PORT environment
variables:</p>
<pre><code>command-demo
tcp://10.3.240.1:443
</code></pre></li>
</ol>
<h2 id=use-environment-variables-to-define-arguments>Use environment variables to define arguments</h2>
<p>In the preceding example, you defined the arguments directly by
providing strings. As an alternative to providing strings directly,
you can define arguments by using environment variables:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MESSAGE<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;hello world&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;/bin/echo&#34;</span>]<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;$(MESSAGE)&#34;</span>]<span style=color:#bbb>
</span></code></pre></div><p>This means you can define an argument for a Pod using any of
the techniques available for defining environment variables, including
<a href=/docs/tasks/configure-pod-container/configure-pod-configmap/>ConfigMaps</a>
and
<a href=/docs/concepts/configuration/secret/>Secrets</a>.</p>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> The environment variable appears in parentheses, <code>"$(VAR)"</code>. This is
required for the variable to be expanded in the <code>command</code> or <code>args</code> field.
</div>
<h2 id=run-a-command-in-a-shell>Run a command in a shell</h2>
<p>In some cases, you need your command to run in a shell. For example, your
command might consist of several commands piped together, or it might be a shell
script. To run your command in a shell, wrap it like this:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>command: <span style=color:#666>[</span><span style=color:#b44>&#34;/bin/sh&#34;</span><span style=color:#666>]</span>
args: <span style=color:#666>[</span><span style=color:#b44>&#34;-c&#34;</span>, <span style=color:#b44>&#34;while true; do echo hello; sleep 10;done&#34;</span><span style=color:#666>]</span>
</code></pre></div><h2 id=what-s-next>What's next</h2>
<ul>
<li>Learn more about <a href=/docs/tasks/>configuring pods and containers</a>.</li>
<li>Learn more about <a href=/docs/tasks/debug/debug-application/get-shell-running-container/>running commands in a container</a>.</li>
<li>See <a href=/docs/reference/generated/kubernetes-api/v1.23/#container-v1-core>Container</a>.</li>
</ul>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-eff97c25c917cdb414eda016df0e2bca>2 - Define Dependent Environment Variables</h1>
<p>This page shows how to define dependent environment variables for a container
in a Kubernetes Pod.</p>
<h2 id=before-you-begin>Before you begin</h2>
<p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
<a href=https://minikube.sigs.k8s.io/docs/tutorials/multi_node/>minikube</a>
or you can use one of these Kubernetes playgrounds:</p>
<ul>
<li><a href=https://www.katacoda.com/courses/kubernetes/playground>Katacoda</a></li>
<li><a href=http://labs.play-with-k8s.com/>Play with Kubernetes</a></li>
</ul>
<h2 id=define-an-environment-dependent-variable-for-a-container>Define an environment dependent variable for a container</h2>
<p>When you create a Pod, you can set dependent environment variables for the containers that run in the Pod. To set dependent environment variables, you can use $(VAR_NAME) in the <code>value</code> of <code>env</code> in the configuration file.</p>
<p>In this exercise, you create a Pod that runs one container. The configuration
file for the Pod defines an dependent environment variable with common usage defined. Here is the configuration manifest for the
Pod:</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/en/examples/pods/inject/dependent-envars.yaml download=pods/inject/dependent-envars.yaml><code>pods/inject/dependent-envars.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-inject-dependent-envars-yaml')" title="Copy pods/inject/dependent-envars.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-inject-dependent-envars-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>dependent-envars-demo<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>dependent-envars-demo<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- while true; do echo -en &#39;\n&#39;; printf UNCHANGED_REFERENCE=$UNCHANGED_REFERENCE&#39;\n&#39;; printf SERVICE_ADDRESS=$SERVICE_ADDRESS&#39;\n&#39;;printf ESCAPED_REFERENCE=$ESCAPED_REFERENCE&#39;\n&#39;; sleep 30; done;<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- sh<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- -c<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>busybox:1.28<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>SERVICE_PORT<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;80&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>SERVICE_IP<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;172.17.0.1&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>UNCHANGED_REFERENCE<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;$(PROTOCOL)://$(SERVICE_IP):$(SERVICE_PORT)&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>PROTOCOL<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;https&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>SERVICE_ADDRESS<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;$(PROTOCOL)://$(SERVICE_IP):$(SERVICE_PORT)&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>ESCAPED_REFERENCE<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;$$(PROTOCOL)://$(SERVICE_IP):$(SERVICE_PORT)&#34;</span><span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<ol>
<li>
<p>Create a Pod based on that manifest:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl apply -f https://k8s.io/examples/pods/inject/dependent-envars.yaml
</code></pre></div><pre><code>pod/dependent-envars-demo created
</code></pre></li>
<li>
<p>List the running Pods:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get pods dependent-envars-demo
</code></pre></div><pre><code>NAME                      READY     STATUS    RESTARTS   AGE
dependent-envars-demo     1/1       Running   0          9s
</code></pre></li>
<li>
<p>Check the logs for the container running in your Pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl logs pod/dependent-envars-demo
</code></pre></div><pre><code>
UNCHANGED_REFERENCE=$(PROTOCOL)://172.17.0.1:80
SERVICE_ADDRESS=https://172.17.0.1:80
ESCAPED_REFERENCE=$(PROTOCOL)://172.17.0.1:80
</code></pre></li>
</ol>
<p>As shown above, you have defined the correct dependency reference of <code>SERVICE_ADDRESS</code>, bad dependency reference of <code>UNCHANGED_REFERENCE</code> and skip dependent references of <code>ESCAPED_REFERENCE</code>.</p>
<p>When an environment variable is already defined when being referenced,
the reference can be correctly resolved, such as in the <code>SERVICE_ADDRESS</code> case.</p>
<p>When the environment variable is undefined or only includes some variables, the undefined environment variable is treated as a normal string, such as <code>UNCHANGED_REFERENCE</code>. Note that incorrectly parsed environment variables, in general, will not block the container from starting.</p>
<p>The <code>$(VAR_NAME)</code> syntax can be escaped with a double <code>$</code>, ie: <code>$$(VAR_NAME)</code>.
Escaped references are never expanded, regardless of whether the referenced variable
is defined or not. This can be seen from the <code>ESCAPED_REFERENCE</code> case above.</p>
<h2 id=what-s-next>What's next</h2>
<ul>
<li>Learn more about <a href=/docs/tasks/inject-data-application/environment-variable-expose-pod-information/>environment variables</a>.</li>
<li>See <a href=/docs/reference/generated/kubernetes-api/v1.23/#envvarsource-v1-core>EnvVarSource</a>.</li>
</ul>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-82c93897176489678232542102daea40>3 - Define Environment Variables for a Container</h1>
<p>This page shows how to define environment variables for a container
in a Kubernetes Pod.</p>
<h2 id=before-you-begin>Before you begin</h2>
<p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
<a href=https://minikube.sigs.k8s.io/docs/tutorials/multi_node/>minikube</a>
or you can use one of these Kubernetes playgrounds:</p>
<ul>
<li><a href=https://www.katacoda.com/courses/kubernetes/playground>Katacoda</a></li>
<li><a href=http://labs.play-with-k8s.com/>Play with Kubernetes</a></li>
</ul>
<h2 id=define-an-environment-variable-for-a-container>Define an environment variable for a container</h2>
<p>When you create a Pod, you can set environment variables for the containers
that run in the Pod. To set environment variables, include the <code>env</code> or
<code>envFrom</code> field in the configuration file.</p>
<p>In this exercise, you create a Pod that runs one container. The configuration
file for the Pod defines an environment variable with name <code>DEMO_GREETING</code> and
value <code>"Hello from the environment"</code>. Here is the configuration manifest for the
Pod:</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/en/examples/pods/inject/envars.yaml download=pods/inject/envars.yaml><code>pods/inject/envars.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-inject-envars-yaml')" title="Copy pods/inject/envars.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-inject-envars-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>envar-demo<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>purpose</span>:<span style=color:#bbb> </span>demonstrate-envars<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>envar-demo-container<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>gcr.io/google-samples/node-hello:1.0<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>DEMO_GREETING<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;Hello from the environment&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>DEMO_FAREWELL<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;Such a sweet sorrow&#34;</span><span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<ol>
<li>
<p>Create a Pod based on that manifest:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl apply -f https://k8s.io/examples/pods/inject/envars.yaml
</code></pre></div></li>
<li>
<p>List the running Pods:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get pods -l <span style=color:#b8860b>purpose</span><span style=color:#666>=</span>demonstrate-envars
</code></pre></div><p>The output is similar to:</p>
<pre><code>NAME            READY     STATUS    RESTARTS   AGE
envar-demo      1/1       Running   0          9s
</code></pre></li>
<li>
<p>List the Pod's container environment variables:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl <span style=color:#a2f>exec</span> envar-demo -- printenv
</code></pre></div><p>The output is similar to this:</p>
<pre><code>NODE_VERSION=4.4.2
EXAMPLE_SERVICE_PORT_8080_TCP_ADDR=10.3.245.237
HOSTNAME=envar-demo
...
DEMO_GREETING=Hello from the environment
DEMO_FAREWELL=Such a sweet sorrow
</code></pre></li>
</ol>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> The environment variables set using the <code>env</code> or <code>envFrom</code> field
override any environment variables specified in the container image.
</div>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> Environment variables may reference each other, however ordering is important.
Variables making use of others defined in the same context must come later in
the list. Similarly, avoid circular references.
</div>
<h2 id=using-environment-variables-inside-of-your-config>Using environment variables inside of your config</h2>
<p>Environment variables that you define in a Pod's configuration can be used
elsewhere in the configuration, for example in commands and arguments that
you set for the Pod's containers.
In the example configuration below, the <code>GREETING</code>, <code>HONORIFIC</code>, and
<code>NAME</code> environment variables are set to <code>Warm greetings to</code>, <code>The Most Honorable</code>, and <code>Kubernetes</code>, respectively. Those environment variables
are then used in the CLI arguments passed to the <code>env-print-demo</code>
container.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>print-greeting<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>env-print-demo<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>bash<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>GREETING<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;Warm greetings to&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>HONORIFIC<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;The Most Honorable&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>NAME<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;Kubernetes&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;echo&#34;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;$(GREETING) $(HONORIFIC) $(NAME)&#34;</span>]<span style=color:#bbb>
</span></code></pre></div><p>Upon creation, the command <code>echo Warm greetings to The Most Honorable Kubernetes</code> is run on the container.</p>
<h2 id=what-s-next>What's next</h2>
<ul>
<li>Learn more about <a href=/docs/tasks/inject-data-application/environment-variable-expose-pod-information/>environment variables</a>.</li>
<li>Learn about <a href=/docs/concepts/configuration/secret/#using-secrets-as-environment-variables>using secrets as environment variables</a>.</li>
<li>See <a href=/docs/reference/generated/kubernetes-api/v1.23/#envvarsource-v1-core>EnvVarSource</a>.</li>
</ul>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-66c0456fdbef5e5116dd606d1e6f73cc>4 - Expose Pod Information to Containers Through Environment Variables</h1>
<p>This page shows how a Pod can use environment variables to expose information
about itself to Containers running in the Pod. Environment variables can expose
Pod fields and Container fields.</p>
<h2 id=before-you-begin>Before you begin</h2>
<p><p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
<a href=https://minikube.sigs.k8s.io/docs/tutorials/multi_node/>minikube</a>
or you can use one of these Kubernetes playgrounds:</p>
<ul>
<li><a href=https://www.katacoda.com/courses/kubernetes/playground>Katacoda</a></li>
<li><a href=http://labs.play-with-k8s.com/>Play with Kubernetes</a></li>
</ul>
To check the version, enter <code>kubectl version</code>.
</p>
<h2 id=the-downward-api>The Downward API</h2>
<p>There are two ways to expose Pod and Container fields to a running Container:</p>
<ul>
<li>Environment variables</li>
<li><a href=/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/#the-downward-api>Volume Files</a></li>
</ul>
<p>Together, these two ways of exposing Pod and Container fields are called the
<em>Downward API</em>.</p>
<h2 id=use-pod-fields-as-values-for-environment-variables>Use Pod fields as values for environment variables</h2>
<p>In this exercise, you create a Pod that has one Container. Here is the
configuration file for the Pod:</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/en/examples/pods/inject/dapi-envars-pod.yaml download=pods/inject/dapi-envars-pod.yaml><code>pods/inject/dapi-envars-pod.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-inject-dapi-envars-pod-yaml')" title="Copy pods/inject/dapi-envars-pod.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-inject-dapi-envars-pod-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>dapi-envars-fieldref<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>k8s.gcr.io/busybox<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span><span style=color:#b44>&#34;sh&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;-c&#34;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- while true; do<span style=color:#bbb>
</span><span style=color:#bbb>          </span>echo -en &#39;\n&#39;;<span style=color:#bbb>
</span><span style=color:#bbb>          </span>printenv MY_NODE_NAME MY_POD_NAME MY_POD_NAMESPACE;<span style=color:#bbb>
</span><span style=color:#bbb>          </span>printenv MY_POD_IP MY_POD_SERVICE_ACCOUNT;<span style=color:#bbb>
</span><span style=color:#bbb>          </span>sleep 10;<span style=color:#bbb>
</span><span style=color:#bbb>        </span>done;<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MY_NODE_NAME<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>fieldRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>fieldPath</span>:<span style=color:#bbb> </span>spec.nodeName<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MY_POD_NAME<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>fieldRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>fieldPath</span>:<span style=color:#bbb> </span>metadata.name<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MY_POD_NAMESPACE<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>fieldRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>fieldPath</span>:<span style=color:#bbb> </span>metadata.namespace<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MY_POD_IP<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>fieldRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>fieldPath</span>:<span style=color:#bbb> </span>status.podIP<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MY_POD_SERVICE_ACCOUNT<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>fieldRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>fieldPath</span>:<span style=color:#bbb> </span>spec.serviceAccountName<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>restartPolicy</span>:<span style=color:#bbb> </span>Never<span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<p>In the configuration file, you can see five environment variables. The <code>env</code>
field is an array of
<a href=/docs/reference/generated/kubernetes-api/v1.23/#envvar-v1-core>EnvVars</a>.
The first element in the array specifies that the <code>MY_NODE_NAME</code> environment
variable gets its value from the Pod's <code>spec.nodeName</code> field. Similarly, the
other environment variables get their names from Pod fields.</p>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> The fields in this example are Pod fields. They are not fields of the
Container in the Pod.
</div>
<p>Create the Pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl apply -f https://k8s.io/examples/pods/inject/dapi-envars-pod.yaml
</code></pre></div><p>Verify that the Container in the Pod is running:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get pods
</code></pre></div><p>View the Container's logs:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl logs dapi-envars-fieldref
</code></pre></div><p>The output shows the values of selected environment variables:</p>
<pre><code>minikube
dapi-envars-fieldref
default
172.17.0.4
default
</code></pre><p>To see why these values are in the log, look at the <code>command</code> and <code>args</code> fields
in the configuration file. When the Container starts, it writes the values of
five environment variables to stdout. It repeats this every ten seconds.</p>
<p>Next, get a shell into the Container that is running in your Pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl <span style=color:#a2f>exec</span> -it dapi-envars-fieldref -- sh
</code></pre></div><p>In your shell, view the environment variables:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>/# printenv
</code></pre></div><p>The output shows that certain environment variables have been assigned the
values of Pod fields:</p>
<pre><code>MY_POD_SERVICE_ACCOUNT=default
...
MY_POD_NAMESPACE=default
MY_POD_IP=172.17.0.4
...
MY_NODE_NAME=minikube
...
MY_POD_NAME=dapi-envars-fieldref
</code></pre><h2 id=use-container-fields-as-values-for-environment-variables>Use Container fields as values for environment variables</h2>
<p>In the preceding exercise, you used Pod fields as the values for environment
variables. In this next exercise, you use Container fields as the values for
environment variables. Here is the configuration file for a Pod that has one
container:</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/en/examples/pods/inject/dapi-envars-container.yaml download=pods/inject/dapi-envars-container.yaml><code>pods/inject/dapi-envars-container.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-inject-dapi-envars-container-yaml')" title="Copy pods/inject/dapi-envars-container.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-inject-dapi-envars-container-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>dapi-envars-resourcefieldref<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>k8s.gcr.io/busybox:1.24<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span><span style=color:#b44>&#34;sh&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;-c&#34;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- while true; do<span style=color:#bbb>
</span><span style=color:#bbb>          </span>echo -en &#39;\n&#39;;<span style=color:#bbb>
</span><span style=color:#bbb>          </span>printenv MY_CPU_REQUEST MY_CPU_LIMIT;<span style=color:#bbb>
</span><span style=color:#bbb>          </span>printenv MY_MEM_REQUEST MY_MEM_LIMIT;<span style=color:#bbb>
</span><span style=color:#bbb>          </span>sleep 10;<span style=color:#bbb>
</span><span style=color:#bbb>        </span>done;<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;32Mi&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;125m&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;64Mi&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;250m&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MY_CPU_REQUEST<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>resourceFieldRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>containerName</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>resource</span>:<span style=color:#bbb> </span>requests.cpu<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MY_CPU_LIMIT<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>resourceFieldRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>containerName</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>resource</span>:<span style=color:#bbb> </span>limits.cpu<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MY_MEM_REQUEST<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>resourceFieldRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>containerName</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>resource</span>:<span style=color:#bbb> </span>requests.memory<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>MY_MEM_LIMIT<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>resourceFieldRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>containerName</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>resource</span>:<span style=color:#bbb> </span>limits.memory<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>restartPolicy</span>:<span style=color:#bbb> </span>Never<span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<p>In the configuration file, you can see four environment variables. The <code>env</code>
field is an array of
<a href=/docs/reference/generated/kubernetes-api/v1.23/#envvar-v1-core>EnvVars</a>.
The first element in the array specifies that the <code>MY_CPU_REQUEST</code> environment
variable gets its value from the <code>requests.cpu</code> field of a Container named
<code>test-container</code>. Similarly, the other environment variables get their values
from Container fields.</p>
<p>Create the Pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl apply -f https://k8s.io/examples/pods/inject/dapi-envars-container.yaml
</code></pre></div><p>Verify that the Container in the Pod is running:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get pods
</code></pre></div><p>View the Container's logs:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl logs dapi-envars-resourcefieldref
</code></pre></div><p>The output shows the values of selected environment variables:</p>
<pre><code>1
1
33554432
67108864
</code></pre><h2 id=what-s-next>What's next</h2>
<ul>
<li><a href=/docs/tasks/inject-data-application/define-environment-variable-container/>Defining Environment Variables for a Container</a></li>
<li><a href=/docs/reference/generated/kubernetes-api/v1.23/#podspec-v1-core>PodSpec</a></li>
<li><a href=/docs/reference/generated/kubernetes-api/v1.23/#container-v1-core>Container</a></li>
<li><a href=/docs/reference/generated/kubernetes-api/v1.23/#envvar-v1-core>EnvVar</a></li>
<li><a href=/docs/reference/generated/kubernetes-api/v1.23/#envvarsource-v1-core>EnvVarSource</a></li>
<li><a href=/docs/reference/generated/kubernetes-api/v1.23/#objectfieldselector-v1-core>ObjectFieldSelector</a></li>
<li><a href=/docs/reference/generated/kubernetes-api/v1.23/#resourcefieldselector-v1-core>ResourceFieldSelector</a></li>
</ul>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-bcf93d1cd019501fd0b7649e9fbcaf60>5 - Expose Pod Information to Containers Through Files</h1>
<p>This page shows how a Pod can use a
<a href=/docs/reference/generated/kubernetes-api/v1.23/#downwardapivolumefile-v1-core><code>DownwardAPIVolumeFile</code></a>
to expose information about itself to Containers running in the Pod.
A <code>DownwardAPIVolumeFile</code> can expose Pod fields and Container fields.</p>
<h2 id=before-you-begin>Before you begin</h2>
<p><p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
<a href=https://minikube.sigs.k8s.io/docs/tutorials/multi_node/>minikube</a>
or you can use one of these Kubernetes playgrounds:</p>
<ul>
<li><a href=https://www.katacoda.com/courses/kubernetes/playground>Katacoda</a></li>
<li><a href=http://labs.play-with-k8s.com/>Play with Kubernetes</a></li>
</ul>
To check the version, enter <code>kubectl version</code>.
</p>
<h2 id=the-downward-api>The Downward API</h2>
<p>There are two ways to expose Pod and Container fields to a running Container:</p>
<ul>
<li><a href=/docs/tasks/inject-data-application/environment-variable-expose-pod-information/#the-downward-api>Environment variables</a></li>
<li>Volume files</li>
</ul>
<p>Together, these two ways of exposing Pod and Container fields are called the
"Downward API".</p>
<h2 id=store-pod-fields>Store Pod fields</h2>
<p>In this exercise, you create a Pod that has one Container.
Here is the configuration file for the Pod:</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/en/examples/pods/inject/dapi-volume.yaml download=pods/inject/dapi-volume.yaml><code>pods/inject/dapi-volume.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-inject-dapi-volume-yaml')" title="Copy pods/inject/dapi-volume.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-inject-dapi-volume-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>kubernetes-downwardapi-volume-example<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>zone</span>:<span style=color:#bbb> </span>us-est-coast<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>cluster</span>:<span style=color:#bbb> </span>test-cluster1<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rack</span>:<span style=color:#bbb> </span>rack-22<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>build</span>:<span style=color:#bbb> </span>two<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>builder</span>:<span style=color:#bbb> </span>john-doe<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>client-container<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>k8s.gcr.io/busybox<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;sh&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;-c&#34;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- while true; do<span style=color:#bbb>
</span><span style=color:#bbb>          </span>if [[ -e /etc/podinfo/labels ]]; then<span style=color:#bbb>
</span><span style=color:#bbb>            </span>echo -en &#39;\n\n&#39;; cat /etc/podinfo/labels; fi;<span style=color:#bbb>
</span><span style=color:#bbb>          </span>if [[ -e /etc/podinfo/annotations ]]; then<span style=color:#bbb>
</span><span style=color:#bbb>            </span>echo -en &#39;\n\n&#39;; cat /etc/podinfo/annotations; fi;<span style=color:#bbb>
</span><span style=color:#bbb>          </span>sleep 5;<span style=color:#bbb>
</span><span style=color:#bbb>        </span>done;<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>volumeMounts</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>podinfo<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>mountPath</span>:<span style=color:#bbb> </span>/etc/podinfo<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>podinfo<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>downwardAPI</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>items</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span>- <span style=color:green;font-weight:700>path</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;labels&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>fieldRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>fieldPath</span>:<span style=color:#bbb> </span>metadata.labels<span style=color:#bbb>
</span><span style=color:#bbb>          </span>- <span style=color:green;font-weight:700>path</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;annotations&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>fieldRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>fieldPath</span>:<span style=color:#bbb> </span>metadata.annotations<span style=color:#bbb>
</span><span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<p>In the configuration file, you can see that the Pod has a <code>downwardAPI</code> Volume,
and the Container mounts the Volume at <code>/etc/podinfo</code>.</p>
<p>Look at the <code>items</code> array under <code>downwardAPI</code>. Each element of the array is a
<a href=/docs/reference/generated/kubernetes-api/v1.23/#downwardapivolumefile-v1-core>DownwardAPIVolumeFile</a>.
The first element specifies that the value of the Pod's
<code>metadata.labels</code> field should be stored in a file named <code>labels</code>.
The second element specifies that the value of the Pod's <code>annotations</code>
field should be stored in a file named <code>annotations</code>.</p>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> The fields in this example are Pod fields. They are not
fields of the Container in the Pod.
</div>
<p>Create the Pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl apply -f https://k8s.io/examples/pods/inject/dapi-volume.yaml
</code></pre></div><p>Verify that the container in the Pod is running:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get pods
</code></pre></div><p>View the container's logs:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl logs kubernetes-downwardapi-volume-example
</code></pre></div><p>The output shows the contents of the <code>labels</code> file and the <code>annotations</code> file:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#b8860b>cluster</span><span style=color:#666>=</span><span style=color:#b44>&#34;test-cluster1&#34;</span>
<span style=color:#b8860b>rack</span><span style=color:#666>=</span><span style=color:#b44>&#34;rack-22&#34;</span>
<span style=color:#b8860b>zone</span><span style=color:#666>=</span><span style=color:#b44>&#34;us-est-coast&#34;</span>

<span style=color:#b8860b>build</span><span style=color:#666>=</span><span style=color:#b44>&#34;two&#34;</span>
<span style=color:#b8860b>builder</span><span style=color:#666>=</span><span style=color:#b44>&#34;john-doe&#34;</span>
</code></pre></div><p>Get a shell into the container that is running in your Pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl <span style=color:#a2f>exec</span> -it kubernetes-downwardapi-volume-example -- sh
</code></pre></div><p>In your shell, view the <code>labels</code> file:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>/# cat /etc/podinfo/labels
</code></pre></div><p>The output shows that all of the Pod's labels have been written
to the <code>labels</code> file:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#b8860b>cluster</span><span style=color:#666>=</span><span style=color:#b44>&#34;test-cluster1&#34;</span>
<span style=color:#b8860b>rack</span><span style=color:#666>=</span><span style=color:#b44>&#34;rack-22&#34;</span>
<span style=color:#b8860b>zone</span><span style=color:#666>=</span><span style=color:#b44>&#34;us-est-coast&#34;</span>
</code></pre></div><p>Similarly, view the <code>annotations</code> file:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>/# cat /etc/podinfo/annotations
</code></pre></div><p>View the files in the <code>/etc/podinfo</code> directory:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>/# ls -laR /etc/podinfo
</code></pre></div><p>In the output, you can see that the <code>labels</code> and <code>annotations</code> files
are in a temporary subdirectory: in this example,
<code>..2982_06_02_21_47_53.299460680</code>. In the <code>/etc/podinfo</code> directory, <code>..data</code> is
a symbolic link to the temporary subdirectory. Also in the <code>/etc/podinfo</code> directory,
<code>labels</code> and <code>annotations</code> are symbolic links.</p>
<pre><code>drwxr-xr-x  ... Feb 6 21:47 ..2982_06_02_21_47_53.299460680
lrwxrwxrwx  ... Feb 6 21:47 ..data -&gt; ..2982_06_02_21_47_53.299460680
lrwxrwxrwx  ... Feb 6 21:47 annotations -&gt; ..data/annotations
lrwxrwxrwx  ... Feb 6 21:47 labels -&gt; ..data/labels

/etc/..2982_06_02_21_47_53.299460680:
total 8
-rw-r--r--  ... Feb  6 21:47 annotations
-rw-r--r--  ... Feb  6 21:47 labels
</code></pre><p>Using symbolic links enables dynamic atomic refresh of the metadata; updates are
written to a new temporary directory, and the <code>..data</code> symlink is updated
atomically using <a href=http://man7.org/linux/man-pages/man2/rename.2.html>rename(2)</a>.</p>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> A container using Downward API as a
<a href=/docs/concepts/storage/volumes/#using-subpath>subPath</a> volume mount will not
receive Downward API updates.
</div>
<p>Exit the shell:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>/# <span style=color:#a2f>exit</span>
</code></pre></div><h2 id=store-container-fields>Store Container fields</h2>
<p>The preceding exercise, you stored Pod fields in a
<a href=/docs/reference/generated/kubernetes-api/v1.23/#downwardapivolumefile-v1-core><code>DownwardAPIVolumeFile</code></a>..
In this next exercise, you store Container fields. Here is the configuration
file for a Pod that has one Container:</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/en/examples/pods/inject/dapi-volume-resources.yaml download=pods/inject/dapi-volume-resources.yaml><code>pods/inject/dapi-volume-resources.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-inject-dapi-volume-resources-yaml')" title="Copy pods/inject/dapi-volume-resources.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-inject-dapi-volume-resources-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>kubernetes-downwardapi-volume-example-2<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>client-container<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>k8s.gcr.io/busybox:1.24<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;sh&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;-c&#34;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- while true; do<span style=color:#bbb>
</span><span style=color:#bbb>          </span>echo -en &#39;\n&#39;;<span style=color:#bbb>
</span><span style=color:#bbb>          </span>if [[ -e /etc/podinfo/cpu_limit ]]; then<span style=color:#bbb>
</span><span style=color:#bbb>            </span>echo -en &#39;\n&#39;; cat /etc/podinfo/cpu_limit; fi;<span style=color:#bbb>
</span><span style=color:#bbb>          </span>if [[ -e /etc/podinfo/cpu_request ]]; then<span style=color:#bbb>
</span><span style=color:#bbb>            </span>echo -en &#39;\n&#39;; cat /etc/podinfo/cpu_request; fi;<span style=color:#bbb>
</span><span style=color:#bbb>          </span>if [[ -e /etc/podinfo/mem_limit ]]; then<span style=color:#bbb>
</span><span style=color:#bbb>            </span>echo -en &#39;\n&#39;; cat /etc/podinfo/mem_limit; fi;<span style=color:#bbb>
</span><span style=color:#bbb>          </span>if [[ -e /etc/podinfo/mem_request ]]; then<span style=color:#bbb>
</span><span style=color:#bbb>            </span>echo -en &#39;\n&#39;; cat /etc/podinfo/mem_request; fi;<span style=color:#bbb>
</span><span style=color:#bbb>          </span>sleep 5;<span style=color:#bbb>
</span><span style=color:#bbb>        </span>done;<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;32Mi&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;125m&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;64Mi&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;250m&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>volumeMounts</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>podinfo<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>mountPath</span>:<span style=color:#bbb> </span>/etc/podinfo<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>podinfo<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>downwardAPI</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>items</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span>- <span style=color:green;font-weight:700>path</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;cpu_limit&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>resourceFieldRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>containerName</span>:<span style=color:#bbb> </span>client-container<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>resource</span>:<span style=color:#bbb> </span>limits.cpu<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>divisor</span>:<span style=color:#bbb> </span>1m<span style=color:#bbb>
</span><span style=color:#bbb>          </span>- <span style=color:green;font-weight:700>path</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;cpu_request&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>resourceFieldRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>containerName</span>:<span style=color:#bbb> </span>client-container<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>resource</span>:<span style=color:#bbb> </span>requests.cpu<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>divisor</span>:<span style=color:#bbb> </span>1m<span style=color:#bbb>
</span><span style=color:#bbb>          </span>- <span style=color:green;font-weight:700>path</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;mem_limit&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>resourceFieldRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>containerName</span>:<span style=color:#bbb> </span>client-container<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>resource</span>:<span style=color:#bbb> </span>limits.memory<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>divisor</span>:<span style=color:#bbb> </span>1Mi<span style=color:#bbb>
</span><span style=color:#bbb>          </span>- <span style=color:green;font-weight:700>path</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;mem_request&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:green;font-weight:700>resourceFieldRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>containerName</span>:<span style=color:#bbb> </span>client-container<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>resource</span>:<span style=color:#bbb> </span>requests.memory<span style=color:#bbb>
</span><span style=color:#bbb>              </span><span style=color:green;font-weight:700>divisor</span>:<span style=color:#bbb> </span>1Mi<span style=color:#bbb>
</span><span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<p>In the configuration file, you can see that the Pod has a
<a href=/concepts/storage/volumes/#downwardapi><code>downwardAPI</code> volume</a>,
and the Container mounts the volume at <code>/etc/podinfo</code>.</p>
<p>Look at the <code>items</code> array under <code>downwardAPI</code>. Each element of the array is a
<a href=/docs/reference/generated/kubernetes-api/v1.23/#downwardapivolumefile-v1-core><code>DownwardAPIVolumeFile</code></a>.</p>
<p>The first element specifies that in the Container named <code>client-container</code>,
the value of the <code>limits.cpu</code> field in the format specified by <code>1m</code> should be
stored in a file named <code>cpu_limit</code>. The <code>divisor</code> field is optional and has the
default value of <code>1</code> which means cores for cpu and bytes for memory.</p>
<p>Create the Pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl apply -f https://k8s.io/examples/pods/inject/dapi-volume-resources.yaml
</code></pre></div><p>Get a shell into the container that is running in your Pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl <span style=color:#a2f>exec</span> -it kubernetes-downwardapi-volume-example-2 -- sh
</code></pre></div><p>In your shell, view the <code>cpu_limit</code> file:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>/# cat /etc/podinfo/cpu_limit
</code></pre></div><p>You can use similar commands to view the <code>cpu_request</code>, <code>mem_limit</code> and
<code>mem_request</code> files.</p>
<h2 id=capabilities-of-the-downward-api>Capabilities of the Downward API</h2>
<p>The following information is available to containers through environment
variables and <code>downwardAPI</code> volumes:</p>
<ul>
<li>
<p>Information available via <code>fieldRef</code>:</p>
<ul>
<li><code>metadata.name</code> - the pod's name</li>
<li><code>metadata.namespace</code> - the pod's namespace</li>
<li><code>metadata.uid</code> - the pod's UID</li>
<li><code>metadata.labels['&lt;KEY>']</code> - the value of the pod's label <code>&lt;KEY></code>
(for example, <code>metadata.labels['mylabel']</code>)</li>
<li><code>metadata.annotations['&lt;KEY>']</code> - the value of the pod's annotation <code>&lt;KEY></code>
(for example, <code>metadata.annotations['myannotation']</code>)</li>
</ul>
</li>
<li>
<p>Information available via <code>resourceFieldRef</code>:</p>
<ul>
<li>A Container's CPU limit</li>
<li>A Container's CPU request</li>
<li>A Container's memory limit</li>
<li>A Container's memory request</li>
<li>A Container's hugepages limit (provided that the <code>DownwardAPIHugePages</code>
<a href=/docs/reference/command-line-tools-reference/feature-gates/>feature gate</a> is enabled)</li>
<li>A Container's hugepages request (provided that the <code>DownwardAPIHugePages</code>
<a href=/docs/reference/command-line-tools-reference/feature-gates/>feature gate</a> is enabled)</li>
<li>A Container's ephemeral-storage limit</li>
<li>A Container's ephemeral-storage request</li>
</ul>
</li>
</ul>
<p>In addition, the following information is available through
<code>downwardAPI</code> volume <code>fieldRef</code>:</p>
<ul>
<li><code>metadata.labels</code> - all of the pod's labels, formatted as <code>label-key="escaped-label-value"</code>
with one label per line</li>
<li><code>metadata.annotations</code> - all of the pod's annotations, formatted as
<code>annotation-key="escaped-annotation-value"</code> with one annotation per line</li>
</ul>
<p>The following information is available through environment variables:</p>
<ul>
<li><code>status.podIP</code> - the pod's IP address</li>
<li><code>spec.serviceAccountName</code> - the pod's service account name</li>
<li><code>spec.nodeName</code> - the name of the node to which the scheduler always attempts to
schedule the pod</li>
<li><code>status.hostIP</code> - the IP of the node to which the Pod is assigned</li>
</ul>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> If CPU and memory limits are not specified for a Container, the
Downward API defaults to the node allocatable value for CPU and memory.
</div>
<h2 id=project-keys-to-specific-paths-and-file-permissions>Project keys to specific paths and file permissions</h2>
<p>You can project keys to specific paths and specific permissions on a per-file
basis. For more information, see
<a href=/docs/concepts/configuration/secret/>Secrets</a>.</p>
<h2 id=motivation-for-the-downward-api>Motivation for the Downward API</h2>
<p>It is sometimes useful for a container to have information about itself, without
being overly coupled to Kubernetes. The Downward API allows containers to consume
information about themselves or the cluster without using the Kubernetes client
or API server.</p>
<p>An example is an existing application that assumes a particular well-known
environment variable holds a unique identifier. One possibility is to wrap the
application, but that is tedious and error prone, and it violates the goal of low
coupling. A better option would be to use the Pod's name as an identifier, and
inject the Pod's name into the well-known environment variable.</p>
<h2 id=what-s-next>What's next</h2>
<ul>
<li>Check the <a href=/docs/reference/generated/kubernetes-api/v1.23/#podspec-v1-core><code>PodSpec</code></a>
API definition which defines the desired state of a Pod.</li>
<li>Check the <a href=/docs/reference/generated/kubernetes-api/v1.23/#volume-v1-core><code>Volume</code></a>
API definition which defines a generic volume in a Pod for containers to access.</li>
<li>Check the <a href=/docs/reference/generated/kubernetes-api/v1.23/#downwardapivolumesource-v1-core><code>DownwardAPIVolumeSource</code></a>
API definition which defines a volume that contains Downward API information.</li>
<li>Check the <a href=/docs/reference/generated/kubernetes-api/v1.23/#downwardapivolumefile-v1-core><code>DownwardAPIVolumeFile</code></a>
API definition which contains references to object or resource fields for
populating a file in the Downward API volume.</li>
<li>Check the <a href=/docs/reference/generated/kubernetes-api/v1.23/#resourcefieldselector-v1-core><code>ResourceFieldSelector</code></a>
API definition which specifies the container resources and their output format.</li>
</ul>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-7f9454a1e775548c23ee5b300a9218a3>6 - Distribute Credentials Securely Using Secrets</h1>
<p>This page shows how to securely inject sensitive data, such as passwords and
encryption keys, into Pods.</p>
<h2 id=before-you-begin>Before you begin</h2>
<p>You need to have a Kubernetes cluster, and the kubectl command-line tool must
be configured to communicate with your cluster. It is recommended to run this tutorial on a cluster with at least two nodes that are not acting as control plane hosts. If you do not already have a
cluster, you can create one by using
<a href=https://minikube.sigs.k8s.io/docs/tutorials/multi_node/>minikube</a>
or you can use one of these Kubernetes playgrounds:</p>
<ul>
<li><a href=https://www.katacoda.com/courses/kubernetes/playground>Katacoda</a></li>
<li><a href=http://labs.play-with-k8s.com/>Play with Kubernetes</a></li>
</ul>
<h3 id=convert-your-secret-data-to-a-base-64-representation>Convert your secret data to a base-64 representation</h3>
<p>Suppose you want to have two pieces of secret data: a username <code>my-app</code> and a password
<code>39528$vdg7Jb</code>. First, use a base64 encoding tool to convert your username and password to a base64 representation. Here's an example using the commonly available base64 program:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#a2f>echo</span> -n <span style=color:#b44>&#39;my-app&#39;</span> | base64
<span style=color:#a2f>echo</span> -n <span style=color:#b44>&#39;39528$vdg7Jb&#39;</span> | base64
</code></pre></div><p>The output shows that the base-64 representation of your username is <code>bXktYXBw</code>,
and the base-64 representation of your password is <code>Mzk1MjgkdmRnN0pi</code>.</p>
<div class="alert alert-warning caution callout" role=alert>
<strong>Caution:</strong> Use a local tool trusted by your OS to decrease the security risks of external tools.
</div>
<h2 id=create-a-secret>Create a Secret</h2>
<p>Here is a configuration file you can use to create a Secret that holds your
username and password:</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/en/examples/pods/inject/secret.yaml download=pods/inject/secret.yaml><code>pods/inject/secret.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-inject-secret-yaml')" title="Copy pods/inject/secret.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-inject-secret-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Secret<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-secret<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>data</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>username</span>:<span style=color:#bbb> </span>bXktYXBw<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>password</span>:<span style=color:#bbb> </span>Mzk1MjgkdmRnN0pi<span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<ol>
<li>
<p>Create the Secret</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl apply -f https://k8s.io/examples/pods/inject/secret.yaml
</code></pre></div></li>
<li>
<p>View information about the Secret:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get secret test-secret
</code></pre></div><p>Output:</p>
<pre><code>NAME          TYPE      DATA      AGE
test-secret   Opaque    2         1m
</code></pre></li>
<li>
<p>View more detailed information about the Secret:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl describe secret test-secret
</code></pre></div><p>Output:</p>
<pre><code>Name:       test-secret
Namespace:  default
Labels:     &lt;none&gt;
Annotations:    &lt;none&gt;

Type:   Opaque

Data
====
password:   13 bytes
username:   7 bytes
</code></pre></li>
</ol>
<h3 id=create-a-secret-directly-with-kubectl>Create a Secret directly with kubectl</h3>
<p>If you want to skip the Base64 encoding step, you can create the
same Secret using the <code>kubectl create secret</code> command. For example:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create secret generic test-secret --from-literal<span style=color:#666>=</span><span style=color:#b44>&#39;username=my-app&#39;</span> --from-literal<span style=color:#666>=</span><span style=color:#b44>&#39;password=39528$vdg7Jb&#39;</span>
</code></pre></div><p>This is more convenient. The detailed approach shown earlier runs
through each step explicitly to demonstrate what is happening.</p>
<h2 id=create-a-pod-that-has-access-to-the-secret-data-through-a-volume>Create a Pod that has access to the secret data through a Volume</h2>
<p>Here is a configuration file you can use to create a Pod:</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/en/examples/pods/inject/secret-pod.yaml download=pods/inject/secret-pod.yaml><code>pods/inject/secret-pod.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-inject-secret-pod-yaml')" title="Copy pods/inject/secret-pod.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-inject-secret-pod-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>secret-test-pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>volumeMounts</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#080;font-style:italic># name must match the volume name below</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>secret-volume<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>mountPath</span>:<span style=color:#bbb> </span>/etc/secret-volume<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># The secret data is exposed to Containers in the Pod through a Volume.</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>secret-volume<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>secret</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>secretName</span>:<span style=color:#bbb> </span>test-secret<span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<ol>
<li>
<p>Create the Pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl apply -f https://k8s.io/examples/pods/inject/secret-pod.yaml
</code></pre></div></li>
<li>
<p>Verify that your Pod is running:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get pod secret-test-pod
</code></pre></div><p>Output:</p>
<pre><code>NAME              READY     STATUS    RESTARTS   AGE
secret-test-pod   1/1       Running   0          42m
</code></pre></li>
<li>
<p>Get a shell into the Container that is running in your Pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl <span style=color:#a2f>exec</span> -i -t secret-test-pod -- /bin/bash
</code></pre></div></li>
<li>
<p>The secret data is exposed to the Container through a Volume mounted under
<code>/etc/secret-volume</code>.</p>
<p>In your shell, list the files in the <code>/etc/secret-volume</code> directory:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#080;font-style:italic># Run this in the shell inside the container</span>
ls /etc/secret-volume
</code></pre></div><p>The output shows two files, one for each piece of secret data:</p>
<pre><code>password username
</code></pre></li>
<li>
<p>In your shell, display the contents of the <code>username</code> and <code>password</code> files:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#080;font-style:italic># Run this in the shell inside the container</span>
<span style=color:#a2f>echo</span> <span style=color:#b44>&#34;</span><span style=color:#a2f;font-weight:700>$(</span> cat /etc/secret-volume/username <span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>&#34;</span>
<span style=color:#a2f>echo</span> <span style=color:#b44>&#34;</span><span style=color:#a2f;font-weight:700>$(</span> cat /etc/secret-volume/password <span style=color:#a2f;font-weight:700>)</span><span style=color:#b44>&#34;</span>
</code></pre></div><p>The output is your username and password:</p>
<pre><code>my-app
39528$vdg7Jb
</code></pre></li>
</ol>
<h2 id=define-container-environment-variables-using-secret-data>Define container environment variables using Secret data</h2>
<h3 id=define-a-container-environment-variable-with-data-from-a-single-secret>Define a container environment variable with data from a single Secret</h3>
<ul>
<li>
<p>Define an environment variable as a key-value pair in a Secret:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create secret generic backend-user --from-literal<span style=color:#666>=</span>backend-username<span style=color:#666>=</span><span style=color:#b44>&#39;backend-admin&#39;</span>
</code></pre></div></li>
<li>
<p>Assign the <code>backend-username</code> value defined in the Secret to the <code>SECRET_USERNAME</code> environment variable in the Pod specification.</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/en/examples/pods/inject/pod-single-secret-env-variable.yaml download=pods/inject/pod-single-secret-env-variable.yaml><code>pods/inject/pod-single-secret-env-variable.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-inject-pod-single-secret-env-variable-yaml')" title="Copy pods/inject/pod-single-secret-env-variable.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-inject-pod-single-secret-env-variable-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>env-single-secret<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>envars-test-container<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>SECRET_USERNAME<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>secretKeyRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>backend-user<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>key</span>:<span style=color:#bbb> </span>backend-username<span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
</li>
<li>
<p>Create the Pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create -f https://k8s.io/examples/pods/inject/pod-single-secret-env-variable.yaml
</code></pre></div></li>
<li>
<p>In your shell, display the content of <code>SECRET_USERNAME</code> container environment variable</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl <span style=color:#a2f>exec</span> -i -t env-single-secret -- /bin/sh -c <span style=color:#b44>&#39;echo $SECRET_USERNAME&#39;</span>
</code></pre></div><p>The output is</p>
<pre><code>backend-admin
</code></pre></li>
</ul>
<h3 id=define-container-environment-variables-with-data-from-multiple-secrets>Define container environment variables with data from multiple Secrets</h3>
<ul>
<li>
<p>As with the previous example, create the Secrets first.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create secret generic backend-user --from-literal<span style=color:#666>=</span>backend-username<span style=color:#666>=</span><span style=color:#b44>&#39;backend-admin&#39;</span>
kubectl create secret generic db-user --from-literal<span style=color:#666>=</span>db-username<span style=color:#666>=</span><span style=color:#b44>&#39;db-admin&#39;</span>
</code></pre></div></li>
<li>
<p>Define the environment variables in the Pod specification.</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/en/examples/pods/inject/pod-multiple-secret-env-variable.yaml download=pods/inject/pod-multiple-secret-env-variable.yaml><code>pods/inject/pod-multiple-secret-env-variable.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-inject-pod-multiple-secret-env-variable-yaml')" title="Copy pods/inject/pod-multiple-secret-env-variable.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-inject-pod-multiple-secret-env-variable-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>envvars-multiple-secrets<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>envars-test-container<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>env</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>BACKEND_USERNAME<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>secretKeyRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>backend-user<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>key</span>:<span style=color:#bbb> </span>backend-username<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>DB_USERNAME<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>valueFrom</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>secretKeyRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>db-user<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>key</span>:<span style=color:#bbb> </span>db-username<span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
</li>
<li>
<p>Create the Pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create -f https://k8s.io/examples/pods/inject/pod-multiple-secret-env-variable.yaml
</code></pre></div></li>
<li>
<p>In your shell, display the container environment variables</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl <span style=color:#a2f>exec</span> -i -t envvars-multiple-secrets -- /bin/sh -c <span style=color:#b44>&#39;env | grep _USERNAME&#39;</span>
</code></pre></div><p>The output is</p>
<pre><code>DB_USERNAME=db-admin
BACKEND_USERNAME=backend-admin
</code></pre></li>
</ul>
<h2 id=configure-all-key-value-pairs-in-a-secret-as-container-environment-variables>Configure all key-value pairs in a Secret as container environment variables</h2>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> This functionality is available in Kubernetes v1.6 and later.
</div>
<ul>
<li>
<p>Create a Secret containing multiple key-value pairs</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create secret generic test-secret --from-literal<span style=color:#666>=</span><span style=color:#b8860b>username</span><span style=color:#666>=</span><span style=color:#b44>&#39;my-app&#39;</span> --from-literal<span style=color:#666>=</span><span style=color:#b8860b>password</span><span style=color:#666>=</span><span style=color:#b44>&#39;39528$vdg7Jb&#39;</span>
</code></pre></div></li>
<li>
<p>Use envFrom to define all of the Secret's data as container environment variables. The key from the Secret becomes the environment variable name in the Pod.</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/en/examples/pods/inject/pod-secret-envFrom.yaml download=pods/inject/pod-secret-envFrom.yaml><code>pods/inject/pod-secret-envFrom.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-inject-pod-secret-envfrom-yaml')" title="Copy pods/inject/pod-secret-envFrom.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-inject-pod-secret-envfrom-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>envfrom-secret<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>envars-test-container<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>nginx<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>envFrom</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>secretRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-secret<span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
</li>
<li>
<p>Create the Pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create -f https://k8s.io/examples/pods/inject/pod-secret-envFrom.yaml
</code></pre></div></li>
<li>
<p>In your shell, display <code>username</code> and <code>password</code> container environment variables</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl <span style=color:#a2f>exec</span> -i -t envfrom-secret -- /bin/sh -c <span style=color:#b44>&#39;echo &#34;username: $username\npassword: $password\n&#34;&#39;</span>
</code></pre></div><p>The output is</p>
<pre><code>username: my-app
password: 39528$vdg7Jb
</code></pre></li>
</ul>
<h3 id=references>References</h3>
<ul>
<li><a href=/docs/reference/generated/kubernetes-api/v1.23/#secret-v1-core>Secret</a></li>
<li><a href=/docs/reference/generated/kubernetes-api/v1.23/#volume-v1-core>Volume</a></li>
<li><a href=/docs/reference/generated/kubernetes-api/v1.23/#pod-v1-core>Pod</a></li>
</ul>
<h2 id=what-s-next>What's next</h2>
<ul>
<li>Learn more about <a href=/docs/concepts/configuration/secret/>Secrets</a>.</li>
<li>Learn about <a href=/docs/concepts/storage/volumes/>Volumes</a>.</li>
</ul>
</div>
</main>
</div>
</div>
<footer class=d-print-none>
<div class=footer__links>
<nav>
<a class=text-white href=/docs/home/>Home</a>
<a class=text-white href=/blog/>Blog</a>
<a class=text-white href=/training/>Training</a>
<a class=text-white href=/partners/>Partners</a>
<a class=text-white href=/community/>Community</a>
<a class=text-white href=/case-studies/>Case Studies</a>
</nav>
</div>
<div class=container-fluid>
<div class=row>
<div class="col-6 col-sm-2 text-xs-center order-sm-2">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list">
<a class=text-white target=_blank href=https://discuss.kubernetes.io>
<i class="fa fa-envelope"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter>
<a class=text-white target=_blank href=https://twitter.com/kubernetesio>
<i class="fab fa-twitter"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Calendar aria-label=Calendar>
<a class=text-white target=_blank href="https://calendar.google.com/calendar/embed?src=calendar%40kubernetes.io">
<i class="fas fa-calendar-alt"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Youtube aria-label=Youtube>
<a class=text-white target=_blank href=https://youtube.com/kubernetescommunity>
<i class="fab fa-youtube"></i>
</a>
</li>
</ul>
</div>
<div class="col-6 col-sm-2 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank href=https://github.com/kubernetes/kubernetes>
<i class="fab fa-github"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack>
<a class=text-white target=_blank href=https://slack.k8s.io>
<i class="fab fa-slack"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Contribute aria-label=Contribute>
<a class=text-white target=_blank href=https://git.k8s.io/community/contributors/guide>
<i class="fas fa-edit"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow">
<a class=text-white target=_blank href=https://stackoverflow.com/questions/tagged/kubernetes>
<i class="fab fa-stack-overflow"></i>
</a>
</li>
</ul>
</div>
<div class="col-12 col-sm-8 text-center order-sm-2">
<small class=text-white>&copy; 2023 The Kubernetes Authors | Documentation Distributed under <a href=https://git.k8s.io/website/LICENSE class=light-text>CC BY 4.0</a></small>
<br>
<small class=text-white>Copyright &copy; 2023 The Linux Foundation &reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage class=light-text>Trademark Usage page</a></small>
<br>
<small class=text-white>ICP license: 京ICP备17074266号-3</small>
</div>
</div>
</div>
</footer>
</div>
<script src=/js/popper-1.14.3.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=/js/bootstrap-4.3.1.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script>
<script src=/js/main.min.40616251a9b6e4b689e7769be0340661efa4d7ebb73f957404e963e135b4ed52.js integrity="sha256-QGFiUam25LaJ53ab4DQGYe+k1+u3P5V0BOlj4TW07VI=" crossorigin=anonymous></script>
</body>
</html>