<!doctype html><html lang=ko class=no-js>
<head>
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JPP6RFM2BP"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-JPP6RFM2BP')</script>
<link rel=alternate hreflang=en href=https://kubernetes.io/docs/concepts/policy/>
<link rel=alternate hreflang=zh href=https://kubernetes.io/zh/docs/concepts/policy/>
<link rel=alternate hreflang=ja href=https://kubernetes.io/ja/docs/concepts/policy/>
<link rel=alternate hreflang=fr href=https://kubernetes.io/fr/docs/concepts/policy/>
<link rel=alternate hreflang=de href=https://kubernetes.io/de/docs/concepts/policy/>
<link rel=alternate hreflang=es href=https://kubernetes.io/es/docs/concepts/policy/>
<link rel=alternate hreflang=id href=https://kubernetes.io/id/docs/concepts/policy/>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.87.0">
<link rel=canonical type=text/html href=https://kubernetes.io/ko/docs/concepts/policy/>
<link rel="shortcut icon" type=image/png href=/images/favicon.png>
<link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=manifest href=/manifest.webmanifest>
<link rel=apple-touch-icon href=/images/kubernetes-192x192.png>
<title>정책 | Kubernetes</title><meta property="og:title" content="정책">
<meta property="og:description" content="리소스의 그룹에 적용되도록 구성할 수 있는 정책
">
<meta property="og:type" content="website">
<meta property="og:url" content="https://kubernetes.io/ko/docs/concepts/policy/"><meta property="og:site_name" content="Kubernetes">
<meta itemprop=name content="정책">
<meta itemprop=description content="리소스의 그룹에 적용되도록 구성할 수 있는 정책
"><meta name=twitter:card content="summary">
<meta name=twitter:title content="정책">
<meta name=twitter:description content="리소스의 그룹에 적용되도록 구성할 수 있는 정책
">
<link href=/scss/main.css rel=stylesheet>
<script src=/js/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","url":"https://kubernetes.io","logo":"https://kubernetes.io/images/favicon.png"}</script>
<meta name=theme-color content="#326ce5">
<link rel=stylesheet href=/css/feature-states.css>
<meta name=description content="리소스의 그룹에 적용되도록 구성할 수 있는 정책
">
<meta property="og:description" content="리소스의 그룹에 적용되도록 구성할 수 있는 정책
">
<meta name=twitter:description content="리소스의 그룹에 적용되도록 구성할 수 있는 정책
">
<meta property="og:url" content="https://kubernetes.io/ko/docs/concepts/policy/">
<meta property="og:title" content="정책">
<meta name=twitter:title content="정책">
<meta name=twitter:image content="https://kubernetes.io/images/favicon.png">
<meta name=twitter:image:alt content="Kubernetes">
<meta property="og:image" content="/images/kubernetes-horizontal-color.png">
<meta property="og:type" content="article">
<script src=/js/script.js></script>
</head>
<body class=td-section>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" data-auto-burger=primary>
<a class=navbar-brand href=/ko/></a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-2 mb-lg-0">
<a class="nav-link active" href=/ko/docs/>문서</a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/ko/blog/>쿠버네티스 블로그</a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/ko/training/>교육</a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/ko/partners/>파트너</a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/ko/community/>커뮤니티</a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/ko/case-studies/>사례 연구</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
버전
</a>
<div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/releases>Release Information</a>
<a class=dropdown-item href=https://kubernetes.io/ko/docs/concepts/policy/>v1.27</a>
<a class=dropdown-item href=https://v1-26.docs.kubernetes.io/ko/docs/concepts/policy/>v1.26</a>
<a class=dropdown-item href=https://v1-25.docs.kubernetes.io/ko/docs/concepts/policy/>v1.25</a>
<a class=dropdown-item href=https://v1-24.docs.kubernetes.io/ko/docs/concepts/policy/>v1.24</a>
<a class=dropdown-item href=https://v1-23.docs.kubernetes.io/ko/docs/concepts/policy/>v1.23</a>
</div>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdownMenuLink role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
한국어 Korean
</a>
<div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/docs/concepts/policy/>English</a>
<a class=dropdown-item href=/zh/docs/concepts/policy/>中文 Chinese</a>
<a class=dropdown-item href=/ja/docs/concepts/policy/>日本語 Japanese</a>
<a class=dropdown-item href=/fr/docs/concepts/policy/>Français</a>
<a class=dropdown-item href=/de/docs/concepts/policy/>Deutsch</a>
<a class=dropdown-item href=/es/docs/concepts/policy/>Español</a>
<a class=dropdown-item href=/id/docs/concepts/policy/>Bahasa Indonesia</a>
</div>
</li>
</ul>
</div>
<button id=hamburger onclick=kub.toggleMenu() data-auto-burger-exclude><div></div></button>
</nav>
</header>
<div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<div class=td-content>
<div class="pageinfo pageinfo-primary d-print-none">
<p>
이 섹션의 다중 페이지 출력 화면임.
<a href=# onclick="return print(),!1">여기를 클릭하여 프린트</a>.
</p><p>
<a href=/ko/docs/concepts/policy/>이 페이지의 일반 화면으로 돌아가기</a>.
</p>
</div>
<h1 class=title>정책</h1>
<div class=lead>리소스의 그룹에 적용되도록 구성할 수 있는 정책</div>
<ul>
<li>1: <a href=#pg-a935ff8c59eb116b43494255cc67f69a>리밋 레인지(Limit Range)</a></li>
<li>2: <a href=#pg-94ddc6e901c30f256138db11d09f05a3>리소스 쿼터</a></li>
<li>3: <a href=#pg-59977cbac423e20437db079757cb03df>파드 시큐리티 폴리시</a></li>
<li>4: <a href=#pg-b528c4464c030f3f044124b38d778f04>노드 리소스 매니저</a></li>
</ul>
<div class=content>
</div>
</div>
<div class=td-content>
<h1 id=pg-a935ff8c59eb116b43494255cc67f69a>1 - 리밋 레인지(Limit Range)</h1>
<p>기본적으로 컨테이너는 쿠버네티스 클러스터에서 무제한 <a href=/ko/docs/concepts/configuration/manage-resources-containers/>컴퓨팅 리소스</a>로 실행된다.
리소스 쿼터을 사용하면 클러스터 관리자는 <a class=glossary-tooltip title="쿠버네티스에서 동일한 물리 클러스터에서 다중의 가상 클러스터를 지원하기 위해 사용하는 추상화." data-toggle=tooltip data-placement=top href=/ko/docs/concepts/overview/working-with-objects/namespaces target=_blank aria-label=네임스페이스>네임스페이스</a>별로 리소스 사용과 생성을 제한할 수 있다.
네임스페이스 내에서 파드나 컨테이너는 네임스페이스의 리소스 쿼터에 정의된 만큼의 CPU와 메모리를 사용할 수 있다. 하나의 파드 또는 컨테이너가 사용 가능한 모든 리소스를 독점할 수 있다는 우려가 있다. 리밋레인지는 네임스페이스에서 리소스 할당(파드 또는 컨테이너)을 제한하는 정책이다.</p>
<p><em>리밋레인지</em> 는 다음과 같은 제약 조건을 제공한다.</p>
<ul>
<li>네임스페이스에서 파드 또는 컨테이너별 최소 및 최대 컴퓨팅 리소스 사용량을 지정한다.</li>
<li>네임스페이스에서 스토리지클래스별 최소 및 최대 스토리지 요청을 지정한다.</li>
<li>네임스페이스에서 리소스에 대한 요청과 제한 사이의 비율을 지정한다.</li>
<li>네임스페이스에서 컴퓨팅 리소스에 대한 기본 요청/제한을 설정하고 런타임에 있는 컨테이너에 자동으로 설정한다.</li>
</ul>
<h2 id=리밋레인지-활성화>리밋레인지 활성화</h2>
<p>쿠버네티스 1.10 버전부터 리밋레인지 지원이 기본적으로 활성화되었다.</p>
<p>해당 네임스페이스에 리밋레인지 오브젝트가 있는 경우
특정 네임스페이스에 리밋레인지가 지정된다.</p>
<p>리밋레인지 오브젝트의 이름은 유효한
<a href=/ko/docs/concepts/overview/working-with-objects/names/#dns-%EC%84%9C%EB%B8%8C%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%9D%B4%EB%A6%84>DNS 서브도메인 이름</a>이어야 한다.</p>
<h3 id=리밋-레인지-개요>리밋 레인지 개요</h3>
<ul>
<li>관리자는 하나의 네임스페이스에 하나의 리밋레인지를 만든다.</li>
<li>사용자는 네임스페이스에서 파드, 컨테이너 및 퍼시스턴트볼륨클레임과 같은 리소스를 생성한다.</li>
<li><code>LimitRanger</code> 어드미션 컨트롤러는 컴퓨팅 리소스 요청 사항을 설정하지 않은 모든 파드와 컨테이너에 대한 기본값과 제한을 지정하고 네임스페이스의 리밋레인지에 정의된 리소스의 최소, 최대 및 비율을 초과하지 않도록 사용량을 추적한다.</li>
<li>리밋레인지 제약 조건을 위반하는 리소스(파드, 컨테이너, 퍼시스턴트볼륨클레임)를 생성하거나 업데이트하는 경우 HTTP 상태 코드 <code>403 FORBIDDEN</code> 및 위반된 제약 조건을 설명하는 메시지와 함께 API 서버에 대한 요청이 실패한다.</li>
<li><code>cpu</code>, <code>memory</code>와 같은 컴퓨팅 리소스의 네임스페이스에서 리밋레인지가 활성화된 경우 사용자는 해당 값에
대한 요청 또는 제한을 지정해야 한다. 그렇지 않으면 시스템에서 파드 생성이 거부될 수 있다.</li>
<li>리밋레인지 유효성 검사는 파드 실행 단계가 아닌 파드 어드미션 단계에서만 발생한다.</li>
</ul>
<p>리밋 레인지를 사용하여 생성할 수 있는 정책의 예는 다음과 같다.</p>
<ul>
<li>용량이 8GiB RAM과 16 코어인 2 노드 클러스터에서 네임스페이스의 파드를 제한하여 CPU의 최대 제한이 500m인 CPU 100m를 요청하고 메모리의 최대 제한이 600M인 메모리 200Mi를 요청하라.</li>
<li>스펙에 CPU 및 메모리 요청없이 시작된 컨테이너에 대해 기본 CPU 제한 및 요청을 150m로, 메모리 기본 요청을 300Mi로 정의하라.</li>
</ul>
<p>네임스페이스의 총 제한이 파드/컨테이너의 제한 합보다 작은 경우 리소스에 대한 경합이 있을 수 있다.
이 경우 컨테이너 또는 파드가 생성되지 않는다.</p>
<p>경합이나 리밋레인지 변경은 이미 생성된 리소스에 영향을 미치지 않는다.</p>
<h2 id=다음-내용>다음 내용</h2>
<p>자세한 내용은 <a href=https://git.k8s.io/community/contributors/design-proposals/resource-management/admission_control_limit_range.md>LimitRanger 디자인 문서</a>를 참조한다.</p>
<p>제한의 사용에 대한 예시는 다음을 참조한다.</p>
<ul>
<li><a href=/ko/docs/tasks/administer-cluster/manage-resources/cpu-constraint-namespace/>네임스페이스당 최소 및 최대 CPU 제약 조건을 설정하는 방법</a>.</li>
<li><a href=/ko/docs/tasks/administer-cluster/manage-resources/memory-constraint-namespace/>네임스페이스당 최소 및 최대 메모리 제약 조건을 설정하는 방법</a>.</li>
<li><a href=/ko/docs/tasks/administer-cluster/manage-resources/cpu-default-namespace/>네임스페이스당 기본 CPU 요청과 제한을 설정하는 방법</a>.</li>
<li><a href=/ko/docs/tasks/administer-cluster/manage-resources/memory-default-namespace/>네임스페이스당 기본 메모리 요청과 제한을 설정하는 방법</a>.</li>
<li><a href=/docs/tasks/administer-cluster/limit-storage-consumption/#limitrange-to-limit-requests-for-storage>네임스페이스당 최소 및 최대 스토리지 사용량을 설정하는 방법</a>.</li>
<li><a href=/ko/docs/tasks/administer-cluster/manage-resources/quota-memory-cpu-namespace/>네임스페이스당 할당량을 설정하는 자세한 예시</a>.</li>
</ul>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-94ddc6e901c30f256138db11d09f05a3>2 - 리소스 쿼터</h1>
<p>여러 사용자나 팀이 정해진 수의 노드로 클러스터를 공유할 때
한 팀이 공정하게 분배된 리소스보다 많은 리소스를 사용할 수 있다는 우려가 있다.</p>
<p>리소스 쿼터는 관리자가 이 문제를 해결하기 위한 도구이다.</p>
<p><code>ResourceQuota</code> 오브젝트로 정의된 리소스 쿼터는 네임스페이스별 총 리소스 사용을 제한하는
제약 조건을 제공한다. 유형별로 네임스페이스에서 만들 수 있는 오브젝트 수와
해당 네임스페이스의 리소스가 사용할 수 있는 총 컴퓨트 리소스의 양을
제한할 수 있다.</p>
<p>리소스 쿼터는 다음과 같이 작동한다.</p>
<ul>
<li>
<p>다른 팀은 다른 네임스페이스에서 작동한다. 현재 이것은 자발적이지만 ACL을 통해 이 필수 사항을
적용하기 위한 지원이 계획되어 있다.</p>
</li>
<li>
<p>관리자는 각 네임스페이스에 대해 하나의 리소스쿼터를 생성한다.</p>
</li>
<li>
<p>사용자는 네임스페이스에서 리소스(파드, 서비스 등)를 생성하고 쿼터 시스템은
사용량을 추적하여 리소스쿼터에 정의된 하드(hard) 리소스 제한을 초과하지 않도록 한다.</p>
</li>
<li>
<p>리소스를 생성하거나 업데이트할 때 쿼터 제약 조건을 위반하면 위반된 제약 조건을 설명하는
메시지와 함께 HTTP 상태 코드 <code>403 FORBIDDEN</code>으로 요청이 실패한다.</p>
</li>
<li>
<p><code>cpu</code>, <code>memory</code>와 같은 컴퓨트 리소스에 대해 네임스페이스에서 쿼터가 활성화된 경우
사용자는 해당값에 대한 요청 또는 제한을 지정해야 한다. 그렇지 않으면 쿼터 시스템이
파드 생성을 거부할 수 있다. 힌트: 컴퓨트 리소스 요구 사항이 없는 파드를 기본값으로 설정하려면 <code>LimitRanger</code> 어드미션 컨트롤러를 사용하자.</p>
<p>이 문제를 회피하는 방법에 대한 예제는
<a href=/ko/docs/tasks/administer-cluster/manage-resources/quota-memory-cpu-namespace/>연습</a>을 참고하길 바란다.</p>
</li>
</ul>
<p>리소스쿼터 오브젝트의 이름은 유효한
<a href=/ko/docs/concepts/overview/working-with-objects/names#dns-%EC%84%9C%EB%B8%8C%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%9D%B4%EB%A6%84>DNS 서브도메인 이름</a>이어야 한다.</p>
<p>네임스페이스와 쿼터를 사용하여 만들 수 있는 정책의 예는 다음과 같다.</p>
<ul>
<li>용량이 32GiB RAM, 16 코어인 클러스터에서 A 팀이 20GiB 및 10 코어를 사용하고
B 팀은 10GiB 및 4 코어를 사용하게 하고 2GiB 및 2 코어를 향후 할당을 위해 보유하도록 한다.</li>
<li>"testing" 네임스페이스를 1 코어 및 1GiB RAM을 사용하도록 제한한다.
"production" 네임스페이스에는 원하는 양을 사용하도록 한다.</li>
</ul>
<p>클러스터의 총 용량이 네임스페이스의 쿼터 합보다 작은 경우 리소스에 대한 경합이 있을 수 있다.
이것은 선착순으로 처리된다.</p>
<p>경합이나 쿼터 변경은 이미 생성된 리소스에 영향을 미치지 않는다.</p>
<h2 id=리소스-쿼터-활성화>리소스 쿼터 활성화</h2>
<p>많은 쿠버네티스 배포판에 기본적으로 리소스 쿼터 지원이 활성화되어 있다.
<a class=glossary-tooltip title="쿠버네티스 API를 제공하는 컨트롤 플레인 컴포넌트." data-toggle=tooltip data-placement=top href=/ko/docs/concepts/overview/components/#kube-apiserver target=_blank aria-label="API 서버">API 서버</a>
<code>--enable-admission-plugins=</code> 플래그의 인수 중 하나로
<code>ResourceQuota</code>가 있는 경우 활성화된다.</p>
<p>해당 네임스페이스에 리소스쿼터가 있는 경우 특정 네임스페이스에
리소스 쿼터가 적용된다.</p>
<h2 id=컴퓨트-리소스-쿼터>컴퓨트 리소스 쿼터</h2>
<p>지정된 네임스페이스에서 요청할 수 있는 총
<a href=/ko/docs/concepts/configuration/manage-resources-containers/>컴퓨트 리소스</a>
합을 제한할 수 있다.</p>
<p>다음과 같은 리소스 유형이 지원된다.</p>
<table>
<thead>
<tr>
<th>리소스 이름</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>limits.cpu</code></td>
<td>터미널이 아닌 상태의 모든 파드에서 CPU 제한의 합은 이 값을 초과할 수 없음.</td>
</tr>
<tr>
<td><code>limits.memory</code></td>
<td>터미널이 아닌 상태의 모든 파드에서 메모리 제한의 합은 이 값을 초과할 수 없음.</td>
</tr>
<tr>
<td><code>requests.cpu</code></td>
<td>터미널이 아닌 상태의 모든 파드에서 CPU 요청의 합은 이 값을 초과할 수 없음.</td>
</tr>
<tr>
<td><code>requests.memory</code></td>
<td>터미널이 아닌 상태의 모든 파드에서 메모리 요청의 합은 이 값을 초과할 수 없음.</td>
</tr>
<tr>
<td><code>hugepages-&lt;size></code></td>
<td>터미널 상태가 아닌 모든 파드에 걸쳐서, 지정된 사이즈의 휴즈 페이지 요청은 이 값을 초과하지 못함.</td>
</tr>
<tr>
<td><code>cpu</code></td>
<td><code>requests.cpu</code> 와 같음.</td>
</tr>
<tr>
<td><code>memory</code></td>
<td><code>requests.memory</code> 와 같음.</td>
</tr>
</tbody>
</table>
<h3 id=확장된-리소스에-대한-리소스-쿼터>확장된 리소스에 대한 리소스 쿼터</h3>
<p>위에서 언급한 리소스 외에도 릴리스 1.10에서는
<a href=/ko/docs/concepts/configuration/manage-resources-containers/#%ED%99%95%EC%9E%A5%EB%90%9C-%EB%A6%AC%EC%86%8C%EC%8A%A4>확장된 리소스</a>에 대한 쿼터 지원이 추가되었다.</p>
<p>확장된 리소스에는 오버커밋(overcommit)이 허용되지 않으므로 하나의 쿼터에서
동일한 확장된 리소스에 대한 <code>requests</code>와 <code>limits</code>을 모두 지정하는 것은 의미가 없다. 따라서 확장된
리소스의 경우 지금은 접두사 <code>requests.</code>이 있는 쿼터 항목만 허용된다.</p>
<p>예를 들어, 리소스 이름이 <code>nvidia.com/gpu</code>이고 네임스페이스에서 요청된 총 GPU 수를 4개로 제한하려는 경우,
GPU 리소스를 다음과 같이 쿼터를 정의할 수 있다.</p>
<ul>
<li><code>requests.nvidia.com/gpu: 4</code></li>
</ul>
<p>자세한 내용은 <a href=#%EC%BF%BC%ED%84%B0-%EB%B3%B4%EA%B8%B0-%EB%B0%8F-%EC%84%A4%EC%A0%95>쿼터 보기 및 설정</a>을 참고하길 바란다.</p>
<h2 id=스토리지-리소스-쿼터>스토리지 리소스 쿼터</h2>
<p>지정된 네임스페이스에서 요청할 수 있는 총 <a href=/ko/docs/concepts/storage/persistent-volumes/>스토리지 리소스</a> 합을 제한할 수 있다.</p>
<p>또한 연관된 스토리지 클래스를 기반으로 스토리지 리소스 사용을 제한할 수 있다.</p>
<table>
<thead>
<tr>
<th>리소스 이름</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>requests.storage</code></td>
<td>모든 퍼시스턴트 볼륨 클레임에서 스토리지 요청의 합은 이 값을 초과할 수 없음</td>
</tr>
<tr>
<td><code>persistentvolumeclaims</code></td>
<td>네임스페이스에 존재할 수 있는 총 <a href=/ko/docs/concepts/storage/persistent-volumes/#%ED%8D%BC%EC%8B%9C%EC%8A%A4%ED%84%B4%ED%8A%B8%EB%B3%BC%EB%A5%A8%ED%81%B4%EB%A0%88%EC%9E%84>퍼시스턴트 볼륨 클레임</a> 수</td>
</tr>
<tr>
<td><code>&lt;storage-class-name>.storageclass.storage.k8s.io/requests.storage</code></td>
<td>storage-class-name과 관련된 모든 퍼시스턴트 볼륨 클레임에서 스토리지 요청의 합은 이 값을 초과할 수 없음</td>
</tr>
<tr>
<td><code>&lt;storage-class-name>.storageclass.storage.k8s.io/persistentvolumeclaims</code></td>
<td><code>&lt;storage-class-name></code> 과 관련된 모든 퍼시스턴트 볼륨 클레임에서 네임스페이스에 존재할 수 있는 총 <a href=/ko/docs/concepts/storage/persistent-volumes/#%ED%8D%BC%EC%8B%9C%EC%8A%A4%ED%84%B4%ED%8A%B8%EB%B3%BC%EB%A5%A8%ED%81%B4%EB%A0%88%EC%9E%84>퍼시스턴트 볼륨 클레임</a> 수</td>
</tr>
</tbody>
</table>
<p>예를 들어, 운영자가 <code>bronze</code> 스토리지 클래스와 별도로 <code>gold</code> 스토리지 클래스를 사용하여 스토리지에 쿼터를 지정하려는 경우 운영자는 다음과 같이
쿼터를 정의할 수 있다.</p>
<ul>
<li><code>gold.storageclass.storage.k8s.io/requests.storage: 500Gi</code></li>
<li><code>bronze.storageclass.storage.k8s.io/requests.storage: 100Gi</code></li>
</ul>
<p>릴리스 1.8에서는 로컬 임시 스토리지에 대한 쿼터 지원이 알파 기능으로 추가되었다.</p>
<table>
<thead>
<tr>
<th>리소스 이름</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>requests.ephemeral-storage</code></td>
<td>네임스페이스의 모든 파드에서 로컬 임시 스토리지 요청의 합은 이 값을 초과할 수 없음.</td>
</tr>
<tr>
<td><code>limits.ephemeral-storage</code></td>
<td>네임스페이스의 모든 파드에서 로컬 임시 스토리지 제한의 합은 이 값을 초과할 수 없음.</td>
</tr>
<tr>
<td><code>ephemeral-storage</code></td>
<td><code>requests.ephemeral-storage</code> 와 같음.</td>
</tr>
</tbody>
</table>
<div class="alert alert-info note callout" role=alert>
<strong>참고:</strong> CRI 컨테이너 런타임을 사용할 때, 컨테이너 로그는 임시 스토리지 쿼터에 포함된다.
이로 인해 스토리지 쿼터를 소진한 파드가 예기치 않게 축출될 수 있다.
자세한 내용은 <a href=/ko/docs/concepts/cluster-administration/logging/>로깅 아키텍처</a>를 참조한다.
</div>
<h2 id=오브젝트-수-쿼터>오브젝트 수 쿼터</h2>
<p>다음 구문을 사용하여 모든 표준 네임스페이스 처리된(namespaced) 리소스 유형에 대한
특정 리소스 전체 수에 대하여 쿼터를 지정할 수 있다.</p>
<ul>
<li>코어 그룹이 아닌(non-core) 리소스를 위한 <code>count/&lt;resource>.&lt;group></code></li>
<li>코어 그룹의 리소스를 위한 <code>count/&lt;resource></code></li>
</ul>
<p>다음은 사용자가 오브젝트 수 쿼터 아래에 배치하려는 리소스 셋의 예이다.</p>
<ul>
<li><code>count/persistentvolumeclaims</code></li>
<li><code>count/services</code></li>
<li><code>count/secrets</code></li>
<li><code>count/configmaps</code></li>
<li><code>count/replicationcontrollers</code></li>
<li><code>count/deployments.apps</code></li>
<li><code>count/replicasets.apps</code></li>
<li><code>count/statefulsets.apps</code></li>
<li><code>count/jobs.batch</code></li>
<li><code>count/cronjobs.batch</code></li>
</ul>
<p>사용자 정의 리소스를 위해 동일한 구문을 사용할 수 있다.
예를 들어 <code>example.com</code> API 그룹에서 <code>widgets</code> 사용자 정의 리소스에 대한 쿼터를 생성하려면 <code>count/widgets.example.com</code>을 사용한다.</p>
<p><code>count/*</code> 리소스 쿼터를 사용할 때 서버 스토리지 영역에 있다면 오브젝트는 쿼터에 대해 과금된다.
이러한 유형의 쿼터는 스토리지 리소스 고갈을 방지하는 데 유용하다. 예를 들어,
크기가 큰 서버에서 시크릿 수에 쿼터를 지정할 수 있다. 클러스터에 시크릿이 너무 많으면 실제로 서버와
컨트롤러가 시작되지 않을 수 있다. 잘못 구성된 크론 잡으로부터의 보호를 위해
잡의 쿼터를 설정할 수 있다. 네임스페이스 내에서 너무 많은 잡을 생성하는 크론 잡은 서비스 거부를 유발할 수 있다.</p>
<p>또한 제한된 리소스 셋에 대해서 일반 오브젝트 수(generic object count) 쿼터를 적용하는 것도 가능하다.
다음 유형이 지원된다.</p>
<table>
<thead>
<tr>
<th>리소스 이름</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>configmaps</code></td>
<td>네임스페이스에 존재할 수 있는 총 컨피그맵 수</td>
</tr>
<tr>
<td><code>persistentvolumeclaims</code></td>
<td>네임스페이스에 존재할 수 있는 총 <a href=/ko/docs/concepts/storage/persistent-volumes/#%ED%8D%BC%EC%8B%9C%EC%8A%A4%ED%84%B4%ED%8A%B8%EB%B3%BC%EB%A5%A8%ED%81%B4%EB%A0%88%EC%9E%84>퍼시스턴트 볼륨 클레임</a> 수</td>
</tr>
<tr>
<td><code>pods</code></td>
<td>네임스페이스에 존재할 수 있는 터미널이 아닌 상태의 파드의 총 수. <code>.status.phase in (Failed, Succeeded)</code>가 true인 경우 파드는 터미널 상태임</td>
</tr>
<tr>
<td><code>replicationcontrollers</code></td>
<td>네임스페이스에 존재할 수 있는 총 레플리케이션컨트롤러 수</td>
</tr>
<tr>
<td><code>resourcequotas</code></td>
<td>네임스페이스에 존재할 수 있는 총 리소스쿼터 수</td>
</tr>
<tr>
<td><code>services</code></td>
<td>네임스페이스에 존재할 수 있는 총 서비스 수</td>
</tr>
<tr>
<td><code>services.loadbalancers</code></td>
<td>네임스페이스에 존재할 수 있는 <code>LoadBalancer</code> 유형의 총 서비스 수</td>
</tr>
<tr>
<td><code>services.nodeports</code></td>
<td>네임스페이스에 존재할 수 있는 <code>NodePort</code> 유형의 총 서비스 수</td>
</tr>
<tr>
<td><code>secrets</code></td>
<td>네임스페이스에 존재할 수 있는 총 시크릿 수</td>
</tr>
</tbody>
</table>
<p>예를 들어, <code>pods</code> 쿼터는 터미널이 아닌 단일 네임스페이스에서 생성된 <code>pods</code> 수를
계산하고 최댓값을 적용한다. 사용자가 작은 파드를 많이 생성하여 클러스터의 파드 IP
공급이 고갈되는 경우를 피하기 위해 네임스페이스에
<code>pods</code> 쿼터를 설정할 수 있다.</p>
<h2 id=쿼터-범위>쿼터 범위</h2>
<p>각 쿼터에는 연결된 <code>scopes</code> 셋이 있을 수 있다. 쿼터는 열거된 범위의 교차 부분과 일치하는 경우에만
리소스 사용량을 측정한다.</p>
<p>범위가 쿼터에 추가되면 해당 범위와 관련된 리소스를 지원하는 리소스 수가 제한된다.
허용된 셋 이외의 쿼터에 지정된 리소스는 유효성 검사 오류가 발생한다.</p>
<table>
<thead>
<tr>
<th>범위</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Terminating</code></td>
<td><code>.spec.activeDeadlineSeconds >= 0</code>에 일치하는 파드</td>
</tr>
<tr>
<td><code>NotTerminating</code></td>
<td><code>.spec.activeDeadlineSeconds is nil</code>에 일치하는 파드</td>
</tr>
<tr>
<td><code>BestEffort</code></td>
<td>최상의 서비스 품질을 제공하는 파드</td>
</tr>
<tr>
<td><code>NotBestEffort</code></td>
<td>서비스 품질이 나쁜 파드</td>
</tr>
<tr>
<td><code>PriorityClass</code></td>
<td>지정된 <a href=/ko/docs/concepts/scheduling-eviction/pod-priority-preemption/>프라이어리티클래스</a>를 참조하여 일치하는 파드.</td>
</tr>
<tr>
<td><code>CrossNamespacePodAffinity</code></td>
<td>크로스-네임스페이스 파드 [(안티)어피니티 용어]가 있는 파드</td>
</tr>
</tbody>
</table>
<p><code>BestEffort</code> 범위는 다음의 리소스를 추적하도록 쿼터를 제한한다.</p>
<ul>
<li><code>pods</code></li>
</ul>
<p><code>Terminating</code>, <code>NotTerminating</code>, <code>NotBestEffort</code> 및 <code>PriorityClass</code>
범위는 쿼터를 제한하여 다음의 리소스를 추적한다.</p>
<ul>
<li><code>pods</code></li>
<li><code>cpu</code></li>
<li><code>memory</code></li>
<li><code>requests.cpu</code></li>
<li><code>requests.memory</code></li>
<li><code>limits.cpu</code></li>
<li><code>limits.memory</code></li>
</ul>
<p><code>Terminating</code> 과 <code>NotTerminating</code> 범위를 동일한 쿼터 내에 모두
명시하지는 못하며, 마찬가지로 <code>BestEffort</code> 와
<code>NotBestEffort</code> 범위도 동일한 쿼터 내에서 모두 명시하지는 못한다.</p>
<p><code>scopeSelector</code> 는 <code>operator</code> 필드에 다음의 값을 지원한다.</p>
<ul>
<li><code>In</code></li>
<li><code>NotIn</code></li>
<li><code>Exists</code></li>
<li><code>DoesNotExist</code></li>
</ul>
<p><code>scopeSelector</code> 를 정의할 때, <code>scopeName</code> 으로 다음의 값 중 하나를 사용하는
경우, <code>operator</code> 는 <code>Exists</code> 이어야 한다.</p>
<ul>
<li><code>Terminating</code></li>
<li><code>NotTerminating</code></li>
<li><code>BestEffort</code></li>
<li><code>NotBestEffort</code></li>
</ul>
<p>만약 <code>operator</code> 가 <code>In</code> 또는 <code>NotIn</code> 인 경우, <code>values</code> 필드는 적어도 하나의 값은
가져야 한다. 예를 들면 다음과 같다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#bbb>  </span><span style=color:green;font-weight:700>scopeSelector</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchExpressions</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>scopeName</span>:<span style=color:#bbb> </span>PriorityClass<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>operator</span>:<span style=color:#bbb> </span>In<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>values</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span>- middle<span style=color:#bbb>
</span></code></pre></div><p>만약 <code>operator</code> 가 <code>Exists</code> 또는 <code>DoesNotExist</code> 이라면, <code>values</code> 필드는 명시되면
<em>안된다</em>.</p>
<h3 id=priorityclass별-리소스-쿼터>PriorityClass별 리소스 쿼터</h3>
<div style=margin-top:10px;margin-bottom:10px>
<b>FEATURE STATE:</b> <code>Kubernetes v1.17 [stable]</code>
</div>
<p>특정 <a href=/ko/docs/concepts/scheduling-eviction/pod-priority-preemption/#%ED%8C%8C%EB%93%9C-%EC%9A%B0%EC%84%A0%EC%88%9C%EC%9C%84>우선 순위</a>로 파드를 생성할 수 있다.
쿼터 스펙의 <code>scopeSelector</code> 필드를 사용하여 파드의 우선 순위에 따라 파드의 시스템 리소스 사용을
제어할 수 있다.</p>
<p>쿼터 스펙의 <code>scopeSelector</code>가 파드를 선택한 경우에만 쿼터가 일치하고 사용된다.</p>
<p><code>scopeSelector</code> 필드를 사용하여 우선 순위 클래스의 쿼터 범위를 지정하면,
쿼터 오브젝트는 다음의 리소스만 추적하도록 제한된다.</p>
<ul>
<li><code>pods</code></li>
<li><code>cpu</code></li>
<li><code>memory</code></li>
<li><code>ephemeral-storage</code></li>
<li><code>limits.cpu</code></li>
<li><code>limits.memory</code></li>
<li><code>limits.ephemeral-storage</code></li>
<li><code>requests.cpu</code></li>
<li><code>requests.memory</code></li>
<li><code>requests.ephemeral-storage</code></li>
</ul>
<p>이 예에서는 쿼터 오브젝트를 생성하여 특정 우선 순위의 파드와 일치시킨다.
예제는 다음과 같이 작동한다.</p>
<ul>
<li>클러스터의 파드는 "low(낮음)", "medium(중간)", "high(높음)"의 세 가지 우선 순위 클래스 중 하나를 가진다.</li>
<li>각 우선 순위마다 하나의 쿼터 오브젝트가 생성된다.</li>
</ul>
<p>다음 YAML을 <code>quota.yml</code> 파일에 저장한다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>List<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>items</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ResourceQuota<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>pods-high<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>hard</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;1000&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>200Gi<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>pods</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;10&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>scopeSelector</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>matchExpressions</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>operator </span>:<span style=color:#bbb> </span>In<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>scopeName</span>:<span style=color:#bbb> </span>PriorityClass<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>values</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;high&#34;</span>]<span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ResourceQuota<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>pods-medium<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>hard</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;10&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>20Gi<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>pods</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;10&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>scopeSelector</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>matchExpressions</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>operator </span>:<span style=color:#bbb> </span>In<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>scopeName</span>:<span style=color:#bbb> </span>PriorityClass<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>values</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;medium&#34;</span>]<span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ResourceQuota<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>pods-low<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>hard</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;5&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span>10Gi<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>pods</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;10&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>scopeSelector</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>matchExpressions</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>operator </span>:<span style=color:#bbb> </span>In<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>scopeName</span>:<span style=color:#bbb> </span>PriorityClass<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>values</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;low&#34;</span>]<span style=color:#bbb>
</span></code></pre></div><p><code>kubectl create</code>를 사용하여 YAML을 적용한다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create -f ./quota.yml
</code></pre></div><pre><code>resourcequota/pods-high created
resourcequota/pods-medium created
resourcequota/pods-low created
</code></pre><p><code>kubectl describe quota</code>를 사용하여 <code>Used</code> 쿼터가 <code>0</code>인지 확인하자.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl describe quota
</code></pre></div><pre><code>Name:       pods-high
Namespace:  default
Resource    Used  Hard
--------    ----  ----
cpu         0     1k
memory      0     200Gi
pods        0     10


Name:       pods-low
Namespace:  default
Resource    Used  Hard
--------    ----  ----
cpu         0     5
memory      0     10Gi
pods        0     10


Name:       pods-medium
Namespace:  default
Resource    Used  Hard
--------    ----  ----
cpu         0     10
memory      0     20Gi
pods        0     10
</code></pre><p>우선 순위가 "high"인 파드를 생성한다. 다음 YAML을
<code>high-priority-pod.yml</code> 파일에 저장한다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>high-priority<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>high-priority<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>ubuntu<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;/bin/sh&#34;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;-c&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;while true; do echo hello; sleep 10;done&#34;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>requests</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;10Gi&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;500m&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>limits</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>memory</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;10Gi&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>cpu</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;500m&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>priorityClassName</span>:<span style=color:#bbb> </span>high<span style=color:#bbb>
</span></code></pre></div><p><code>kubectl create</code>로 적용하자.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create -f ./high-priority-pod.yml
</code></pre></div><p>"high" 우선 순위 쿼터가 적용된 <code>pods-high</code>에 대한 "Used" 통계가 변경되었고
다른 두 쿼터는 변경되지 않았는지 확인한다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl describe quota
</code></pre></div><pre><code>Name:       pods-high
Namespace:  default
Resource    Used  Hard
--------    ----  ----
cpu         500m  1k
memory      10Gi  200Gi
pods        1     10


Name:       pods-low
Namespace:  default
Resource    Used  Hard
--------    ----  ----
cpu         0     5
memory      0     10Gi
pods        0     10


Name:       pods-medium
Namespace:  default
Resource    Used  Hard
--------    ----  ----
cpu         0     10
memory      0     20Gi
pods        0     10
</code></pre><h3 id=네임스페이스-간-파드-어피니티-쿼터>네임스페이스 간 파드 어피니티 쿼터</h3>
<div style=margin-top:10px;margin-bottom:10px>
<b>FEATURE STATE:</b> <code>Kubernetes v1.22 [beta]</code>
</div>
<p>오퍼레이터는 네임스페이스를 교차하는 어피니티가 있는 파드를 가질 수 있는 네임스페이스를
제한하기 위해 <code>CrossNamespacePodAffinity</code> 쿼터 범위를 사용할 수 있다. 특히, 파드 어피니티 용어의
<code>namespaces</code> 또는 <code>namespaceSelector</code> 필드를 설정할 수 있는 파드를 제어한다.</p>
<p>안티-어피니티 제약 조건이 있는 파드는 장애 도메인에서 다른 모든 네임스페이스의 파드가 예약되지 않도록
차단할 수 있으므로 사용자가 네임스페이스 간 어피니티 용어를
사용하지 못하도록 하는 것이 바람직할 수 있다.</p>
<p>이 범위 오퍼레이터를 사용하면 <code>CrossNamespaceAffinity</code> 범위와 하드(hard) 제한이 0인
네임스페이스에 리소스 쿼터 오브젝트를 생성하여 특정 네임스페이스(아래 예에서 <code>foo-ns</code>)가 네임스페이스 간 파드 어피니티를
사용하는 파드를 사용하지 못하도록 방지할 수 있다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ResourceQuota<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>disable-cross-namespace-affinity<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>foo-ns<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hard</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>pods</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;0&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>scopeSelector</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchExpressions</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>scopeName</span>:<span style=color:#bbb> </span>CrossNamespaceAffinity<span style=color:#bbb>
</span></code></pre></div><p>오퍼레이터가 기본적으로 <code>namespaces</code> 및 <code>namespaceSelector</code> 사용을 허용하지 않고,
특정 네임스페이스에만 허용하려는 경우, kube-apiserver 플래그 --admission-control-config-file를
다음의 구성 파일의 경로로 설정하여 <code>CrossNamespaceAffinity</code> 를
제한된 리소스로 구성할 수 있다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apiserver.config.k8s.io/v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>AdmissionConfiguration<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>plugins</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;ResourceQuota&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>configuration</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apiserver.config.k8s.io/v1<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ResourceQuotaConfiguration<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>limitedResources</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>resource</span>:<span style=color:#bbb> </span>pods<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>matchScopes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>scopeName</span>:<span style=color:#bbb> </span>CrossNamespaceAffinity<span style=color:#bbb>
</span></code></pre></div><p>위의 구성을 사용하면, 파드는 생성된 네임스페이스에 <code>CrossNamespaceAffinity</code> 범위가 있는 리소스 쿼터 오브젝트가 있고,
해당 필드를 사용하는 파드 수보다 크거나 같은 하드 제한이 있는 경우에만
파드 어피니티에서 <code>namespaces</code> 및 <code>namespaceSelector</code> 를 사용할 수 있다.</p>
<p>이 기능은 베타이며 기본으로 활성화되어 있다. kube-apiserver 및 kube-scheduler 모두에서
<a href=/ko/docs/reference/command-line-tools-reference/feature-gates/>기능 게이트</a>
<code>PodAffinityNamespaceSelector</code> 를 사용하여 비활성화할 수 있다.</p>
<h2 id=requests-vs-limits>요청과 제한의 비교</h2>
<p>컴퓨트 리소스를 할당할 때 각 컨테이너는 CPU 또는 메모리에 대한 요청과 제한값을 지정할 수 있다.
쿼터는 값에 대한 쿼터를 지정하도록 구성할 수 있다.</p>
<p>쿼터에 <code>requests.cpu</code>나 <code>requests.memory</code>에 지정된 값이 있으면 들어오는 모든
컨테이너가 해당 리소스에 대한 명시적인 요청을 지정해야 한다. 쿼터에 <code>limits.cpu</code>나
<code>limits.memory</code>에 지정된 값이 있으면 들어오는 모든 컨테이너가 해당 리소스에 대한 명시적인 제한을 지정해야 한다.</p>
<h2 id=쿼터-보기-및-설정>쿼터 보기 및 설정</h2>
<p>Kubectl은 쿼터 생성, 업데이트 및 보기를 지원한다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create namespace myspace
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cat <span style=color:#b44>&lt;&lt;EOF &gt; compute-resources.yaml
</span><span style=color:#b44>apiVersion: v1
</span><span style=color:#b44>kind: ResourceQuota
</span><span style=color:#b44>metadata:
</span><span style=color:#b44>  name: compute-resources
</span><span style=color:#b44>spec:
</span><span style=color:#b44>  hard:
</span><span style=color:#b44>    requests.cpu: &#34;1&#34;
</span><span style=color:#b44>    requests.memory: 1Gi
</span><span style=color:#b44>    limits.cpu: &#34;2&#34;
</span><span style=color:#b44>    limits.memory: 2Gi
</span><span style=color:#b44>    requests.nvidia.com/gpu: 4
</span><span style=color:#b44>EOF</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create -f ./compute-resources.yaml --namespace<span style=color:#666>=</span>myspace
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cat <span style=color:#b44>&lt;&lt;EOF &gt; object-counts.yaml
</span><span style=color:#b44>apiVersion: v1
</span><span style=color:#b44>kind: ResourceQuota
</span><span style=color:#b44>metadata:
</span><span style=color:#b44>  name: object-counts
</span><span style=color:#b44>spec:
</span><span style=color:#b44>  hard:
</span><span style=color:#b44>    configmaps: &#34;10&#34;
</span><span style=color:#b44>    persistentvolumeclaims: &#34;4&#34;
</span><span style=color:#b44>    pods: &#34;4&#34;
</span><span style=color:#b44>    replicationcontrollers: &#34;20&#34;
</span><span style=color:#b44>    secrets: &#34;10&#34;
</span><span style=color:#b44>    services: &#34;10&#34;
</span><span style=color:#b44>    services.loadbalancers: &#34;2&#34;
</span><span style=color:#b44>EOF</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create -f ./object-counts.yaml --namespace<span style=color:#666>=</span>myspace
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get quota --namespace<span style=color:#666>=</span>myspace
</code></pre></div><pre><code class=language-none data-lang=none>NAME                    AGE
compute-resources       30s
object-counts           32s
</code></pre><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl describe quota compute-resources --namespace<span style=color:#666>=</span>myspace
</code></pre></div><pre><code class=language-none data-lang=none>Name:                    compute-resources
Namespace:               myspace
Resource                 Used  Hard
--------                 ----  ----
limits.cpu               0     2
limits.memory            0     2Gi
requests.cpu             0     1
requests.memory          0     1Gi
requests.nvidia.com/gpu  0     4
</code></pre><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl describe quota object-counts --namespace<span style=color:#666>=</span>myspace
</code></pre></div><pre><code class=language-none data-lang=none>Name:                   object-counts
Namespace:              myspace
Resource                Used    Hard
--------                ----    ----
configmaps              0       10
persistentvolumeclaims  0       4
pods                    0       4
replicationcontrollers  0       20
secrets                 1       10
services                0       10
services.loadbalancers  0       2
</code></pre><p>Kubectl은 <code>count/&lt;resource>.&lt;group></code> 구문을 사용하여 모든 표준 네임스페이스 리소스에 대한
오브젝트 수 쿼터를 지원한다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create namespace myspace
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create quota <span style=color:#a2f>test</span> --hard<span style=color:#666>=</span>count/deployments.apps<span style=color:#666>=</span>2,count/replicasets.apps<span style=color:#666>=</span>4,count/pods<span style=color:#666>=</span>3,count/secrets<span style=color:#666>=</span><span style=color:#666>4</span> --namespace<span style=color:#666>=</span>myspace
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create deployment nginx --image<span style=color:#666>=</span>nginx --namespace<span style=color:#666>=</span>myspace --replicas<span style=color:#666>=</span><span style=color:#666>2</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl describe quota --namespace<span style=color:#666>=</span>myspace
</code></pre></div><pre><code>Name:                         test
Namespace:                    myspace
Resource                      Used  Hard
--------                      ----  ----
count/deployments.apps        1     2
count/pods                    2     3
count/replicasets.apps        1     4
count/secrets                 1     4
</code></pre><h2 id=쿼터-및-클러스터-용량>쿼터 및 클러스터 용량</h2>
<p>리소스쿼터는 클러스터 용량과 무관하다. 그것들은 절대 단위로 표현된다.
따라서 클러스터에 노드를 추가해도 각 네임스페이스에 더 많은 리소스를
사용할 수 있는 기능이 자동으로 부여되지는 <em>않는다</em>.</p>
<p>가끔 다음과 같은 보다 복잡한 정책이 필요할 수 있다.</p>
<ul>
<li>여러 팀으로 전체 클러스터 리소스를 비례적으로 나눈다.</li>
<li>각 테넌트가 필요에 따라 리소스 사용량을 늘릴 수 있지만, 실수로 리소스가 고갈되는 것을
막기 위한 충분한 제한이 있다.</li>
<li>하나의 네임스페이스에서 요구를 감지하고 노드를 추가하며 쿼터를 늘린다.</li>
</ul>
<p>이러한 정책은 쿼터 사용을 감시하고 다른 신호에 따라 각 네임스페이스의 쿼터 하드 제한을
조정하는 "컨트롤러"를 작성하여 <code>ResourceQuotas</code>를 구성 요소로
사용하여 구현할 수 있다.</p>
<p>리소스 쿼터는 통합된 클러스터 리소스를 분할하지만 노드에 대한 제한은 없다.
여러 네임스페이스의 파드가 동일한 노드에서 실행될 수 있다.</p>
<h2 id=기본적으로-우선-순위-클래스-소비-제한>기본적으로 우선 순위 클래스 소비 제한</h2>
<p>파드가 특정 우선 순위, 예를 들어 일치하는 쿼터 오브젝트가 존재하는
경우에만 "cluster-services"가 네임스페이스에 허용되어야 한다.</p>
<p>이 메커니즘을 통해 운영자는 특정 우선 순위가 높은 클래스의 사용을
제한된 수의 네임스페이스로 제한할 수 있으며 모든 네임스페이스가
기본적으로 이러한 우선 순위 클래스를 사용할 수 있는 것은 아니다.</p>
<p>이를 적용하려면 kube-apiserver 플래그 <code>--admission-control-config-file</code> 을
사용하여 다음 구성 파일의 경로를 전달해야 한다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apiserver.config.k8s.io/v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>AdmissionConfiguration<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>plugins</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;ResourceQuota&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>configuration</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apiserver.config.k8s.io/v1<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ResourceQuotaConfiguration<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>limitedResources</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>resource</span>:<span style=color:#bbb> </span>pods<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>matchScopes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>scopeName</span>:<span style=color:#bbb> </span>PriorityClass<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>operator</span>:<span style=color:#bbb> </span>In<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>values</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;cluster-services&#34;</span>]<span style=color:#bbb>
</span></code></pre></div><p>그리고, <code>kube-system</code> 네임스페이스에 리소스 쿼터 오브젝트를 생성한다.</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/ko/examples/policy/priority-class-resourcequota.yaml download=policy/priority-class-resourcequota.yaml><code>policy/priority-class-resourcequota.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('policy-priority-class-resourcequota-yaml')" title="Copy policy/priority-class-resourcequota.yaml to clipboard">
</img>
</div>
<div class=includecode id=policy-priority-class-resourcequota-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ResourceQuota<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>pods-cluster-services<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>scopeSelector</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>matchExpressions</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>operator </span>:<span style=color:#bbb> </span>In<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>scopeName</span>:<span style=color:#bbb> </span>PriorityClass<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>values</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#34;cluster-services&#34;</span>]</code></pre></div>
</div>
</div>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl apply -f https://k8s.io/examples/policy/priority-class-resourcequota.yaml -n kube-system
</code></pre></div><pre><code class=language-none data-lang=none>resourcequota/pods-cluster-services created
</code></pre><p>이 경우, 파드 생성은 다음의 조건을 만족해야 허용될 것이다.</p>
<ol>
<li>파드의 <code>priorityClassName</code> 가 명시되지 않음.</li>
<li>파드의 <code>priorityClassName</code> 가 <code>cluster-services</code> 이외의 다른 값으로 명시됨.</li>
<li>파드의 <code>priorityClassName</code> 가 <code>cluster-services</code> 로 설정되고, 파드가 <code>kube-system</code>
네임스페이스에 생성되었으며 리소스 쿼터 검증을 통과함.</li>
</ol>
<p>파드 생성 요청은 <code>priorityClassName</code> 가 <code>cluster-services</code> 로 명시되고
<code>kube-system</code> 이외의 다른 네임스페이스에 생성되는 경우, 거절된다.</p>
<h2 id=다음-내용>다음 내용</h2>
<ul>
<li>자세한 내용은 <a href=https://git.k8s.io/community/contributors/design-proposals/resource-management/admission_control_resource_quota.md>리소스쿼터 디자인 문서</a>를 참고한다.</li>
<li><a href=/docs/tasks/administer-cluster/quota-api-object/>리소스 쿼터를 사용하는 방법에 대한 자세한 예</a>를 참고한다.</li>
<li><a href=https://github.com/kubernetes/community/blob/master/contributors/design-proposals/scheduling/pod-priority-resourcequota.md>우선 순위 클래스에 대한 쿼터 지원 디자인 문서</a>를 읽는다.</li>
<li><a href=https://github.com/kubernetes/kubernetes/pull/36765>제한된 자원</a>을 참고한다.</li>
</ul>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-59977cbac423e20437db079757cb03df>3 - 파드 시큐리티 폴리시</h1>
<div style=margin-top:10px;margin-bottom:10px>
<b>FEATURE STATE:</b> <code>Kubernetes v1.21 [deprecated]</code>
</div>
<p>파드시큐리티폴리시(PodSecurityPolicy)는 쿠버네티스 v1.21부터 더 이상 사용되지 않으며, v1.25에서 제거될 예정이다.
파드시큐리티폴리시는 <a href=/docs/concepts/security/pod-security-admission/>파드 시큐리티 어드미션</a>으로 대체되었다.
사용 중단에 대한 상세 사항은 <a href=/blog/2021/04/06/podsecuritypolicy-deprecation-past-present-and-future/>파드시큐리티폴리시 사용 중단: 과거, 현재, 그리고 미래</a>를 참조한다.</p>
<p>파드 시큐리티 폴리시를 사용하면 파드 생성 및 업데이트에 대한 세분화된 권한을
부여할 수 있다.</p>
<h2 id=파드-시큐리티-폴리시란>파드 시큐리티 폴리시란?</h2>
<p><em>Pod Security Policy</em> 는 파드 명세의 보안 관련 측면을 제어하는 클러스터-레벨의
리소스이다. <a href=/docs/reference/generated/kubernetes-api/v1.23/#podsecuritypolicy-v1beta1-policy>파드시큐리티폴리시</a> 오브젝트는
관련 필드에 대한 기본값뿐만 아니라 시스템에 적용하기 위해 파드가 실행해야만 하는
조건 셋을 정의한다. 관리자는
다음을 제어할 수 있다.</p>
<table>
<thead>
<tr>
<th>제어 측면</th>
<th>필드 이름</th>
</tr>
</thead>
<tbody>
<tr>
<td>특권을 가진(privileged) 컨테이너의 실행</td>
<td><a href=#%ED%8A%B9%EA%B6%8C%EC%9D%84-%EA%B0%80%EC%A7%84><code>privileged</code></a></td>
</tr>
<tr>
<td>호스트 네임스페이스의 사용</td>
<td><a href=#%ED%98%B8%EC%8A%A4%ED%8A%B8-%EB%84%A4%EC%9E%84%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4><code>hostPID</code>, <code>hostIPC</code></a></td>
</tr>
<tr>
<td>호스트 네트워킹과 포트의 사용</td>
<td><a href=#%ED%98%B8%EC%8A%A4%ED%8A%B8-%EB%84%A4%EC%9E%84%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4><code>hostNetwork</code>, <code>hostPorts</code></a></td>
</tr>
<tr>
<td>볼륨 유형의 사용</td>
<td><a href=#%EB%B3%BC%EB%A5%A8-%EB%B0%8F-%ED%8C%8C%EC%9D%BC%EC%8B%9C%EC%8A%A4%ED%85%9C><code>volumes</code></a></td>
</tr>
<tr>
<td>호스트 파일시스템의 사용</td>
<td><a href=#%EB%B3%BC%EB%A5%A8-%EB%B0%8F-%ED%8C%8C%EC%9D%BC%EC%8B%9C%EC%8A%A4%ED%85%9C><code>allowedHostPaths</code></a></td>
</tr>
<tr>
<td>특정 FlexVolume 드라이버의 허용</td>
<td><a href=#flexvolume-%EB%93%9C%EB%9D%BC%EC%9D%B4%EB%B2%84><code>allowedFlexVolumes</code></a></td>
</tr>
<tr>
<td>파드 볼륨을 소유한 FSGroup 할당</td>
<td><a href=#%EB%B3%BC%EB%A5%A8-%EB%B0%8F-%ED%8C%8C%EC%9D%BC%EC%8B%9C%EC%8A%A4%ED%85%9C><code>fsGroup</code></a></td>
</tr>
<tr>
<td>읽기 전용 루트 파일시스템 사용 필요</td>
<td><a href=#%EB%B3%BC%EB%A5%A8-%EB%B0%8F-%ED%8C%8C%EC%9D%BC%EC%8B%9C%EC%8A%A4%ED%85%9C><code>readOnlyRootFilesystem</code></a></td>
</tr>
<tr>
<td>컨테이너의 사용자 및 그룹 ID</td>
<td><a href=#%EC%82%AC%EC%9A%A9%EC%9E%90-%EB%B0%8F-%EA%B7%B8%EB%A3%B9><code>runAsUser</code>, <code>runAsGroup</code>, <code>supplementalGroups</code></a></td>
</tr>
<tr>
<td>루트 특권으로의 에스컬레이션 제한</td>
<td><a href=#%EA%B6%8C%ED%95%9C-%EC%97%90%EC%8A%A4%EC%BB%AC%EB%A0%88%EC%9D%B4%EC%85%98><code>allowPrivilegeEscalation</code>, <code>defaultAllowPrivilegeEscalation</code></a></td>
</tr>
<tr>
<td>리눅스 기능</td>
<td><a href=#%EA%B8%B0%EB%8A%A5><code>defaultAddCapabilities</code>, <code>requiredDropCapabilities</code>, <code>allowedCapabilities</code></a></td>
</tr>
<tr>
<td>컨테이너의 SELinux 컨텍스트</td>
<td><a href=#selinux><code>seLinux</code></a></td>
</tr>
<tr>
<td>컨테이너에 허용된 Proc 마운트 유형</td>
<td><a href=#allowedprocmounttypes><code>allowedProcMountTypes</code></a></td>
</tr>
<tr>
<td>컨테이너가 사용하는 AppArmor 프로파일</td>
<td><a href=#apparmor>어노테이션</a></td>
</tr>
<tr>
<td>컨테이너가 사용하는 seccomp 프로파일</td>
<td><a href=#seccomp>어노테이션</a></td>
</tr>
<tr>
<td>컨테이너가 사용하는 sysctl 프로파일</td>
<td><a href=#sysctl><code>forbiddenSysctls</code>,<code>allowedUnsafeSysctls</code></a></td>
</tr>
</tbody>
</table>
<h2 id=파드-시큐리티-폴리시-활성화>파드 시큐리티 폴리시 활성화</h2>
<p>파드 시큐리티 폴리시 제어는 선택 사항인 <a href=/docs/reference/access-authn-authz/admission-controllers/#podsecuritypolicy>어드미션
컨트롤러</a>로 구현된다.
<a href=/docs/reference/access-authn-authz/admission-controllers/#how-do-i-turn-on-an-admission-control-plug-in>어드미션 컨트롤러를 활성화</a>하면
파드시큐리티폴리시가 적용되지만,
정책을 승인하지 않고 활성화하면 클러스터에
<strong>파드가 생성되지 않는다.</strong></p>
<p>파드 시큐리티 폴리시 API(<code>policy/v1beta1/podsecuritypolicy</code>)는
어드미션 컨트롤러와 독립적으로 활성화되므로 기존 클러스터의 경우
어드미션 컨트롤러를 활성화하기 전에 정책을 추가하고 권한을
부여하는 것이 좋다.</p>
<h2 id=정책-승인>정책 승인</h2>
<p>파드시큐리티폴리시 리소스가 생성되면 아무 것도 수행하지 않는다. 이를 사용하려면
요청 사용자 또는 대상 파드의
<a href=/docs/tasks/configure-pod-container/configure-service-account/>서비스 어카운트</a>는
정책에서 <code>use</code> 동사를 허용하여 정책을 사용할 권한이 있어야 한다.</p>
<p>대부분의 쿠버네티스 파드는 사용자가 직접 만들지 않는다. 대신 일반적으로
컨트롤러 관리자를 통해
<a href=/ko/docs/concepts/workloads/controllers/deployment/>디플로이먼트</a>,
<a href=/ko/docs/concepts/workloads/controllers/replicaset/>레플리카셋</a>, 또는 기타
템플릿 컨트롤러의 일부로 간접적으로 생성된다. 컨트롤러에 정책에 대한 접근 권한을 부여하면
해당 컨트롤러에 의해 생성된 <em>모든</em> 파드에 대한 접근 권한이 부여되므로 정책을 승인하는
기본 방법은 파드의 서비스 어카운트에 대한 접근 권한을
부여하는 것이다(<a href=#%EB%8B%A4%EB%A5%B8-%ED%8C%8C%EB%93%9C%EB%A5%BC-%EC%8B%A4%ED%96%89>예</a> 참고).</p>
<h3 id=rbac을-통한-방법>RBAC을 통한 방법</h3>
<p><a href=/docs/reference/access-authn-authz/rbac/>RBAC</a>은 표준 쿠버네티스 권한 부여 모드이며,
정책 사용 권한을 부여하는 데 쉽게 사용할 수 있다.</p>
<p>먼저, <code>Role</code> 또는 <code>ClusterRole</code>은 원하는 정책을 <code>use</code> 하려면 접근 권한을 부여해야 한다.
접근 권한을 부여하는 규칙은 다음과 같다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io/v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ClusterRole<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>&lt;role name&gt;<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>rules</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>apiGroups</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#39;policy&#39;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#39;podsecuritypolicies&#39;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>verbs</span>:<span style=color:#bbb>     </span>[<span style=color:#b44>&#39;use&#39;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>resourceNames</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- &lt;list of policies to authorize&gt;<span style=color:#bbb>
</span></code></pre></div><p>그런 다음 <code>(Cluster)Role</code>이 승인된 사용자에게 바인딩된다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io/v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ClusterRoleBinding<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>&lt;binding name&gt;<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>roleRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ClusterRole<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>&lt;role name&gt;<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>subjects</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># 네임스페이스의 모든 서비스 어카운트 승인(권장):</span><span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Group<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>system:serviceaccounts:&lt;authorized namespace&gt;<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># 특정 서비스 어카운트 승인(권장하지 않음):</span><span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ServiceAccount<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>&lt;authorized service account name&gt;<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>&lt;authorized pod namespace&gt;<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># 특정 사용자 승인(권장하지 않음):</span><span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>User<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>&lt;authorized user name&gt;<span style=color:#bbb>
</span></code></pre></div><p><code>RoleBinding</code>(<code>ClusterRoleBinding</code> 아님)을 사용하는 경우, 바인딩과 동일한 네임스페이스에서
실행되는 파드에 대해서만 사용 권한을 부여한다. 네임스페이스에서 실행되는 모든 파드에 접근 권한을
부여하기 위해 시스템 그룹과 쌍을 이룰 수 있다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#080;font-style:italic># 네임스페이스의 모든 서비스 어카운트 승인:</span><span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Group<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>system:serviceaccounts<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># 또는 동일하게, 네임스페이스의 모든 승인된 사용자에게 사용 권한 부여</span><span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Group<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>system:authenticated<span style=color:#bbb>
</span></code></pre></div><p>RBAC 바인딩에 대한 자세한 예는,
<a href=/docs/reference/access-authn-authz/rbac#role-binding-examples>역할 바인딩 예제</a>를 참고한다.
파드시큐리티폴리시 인증에 대한 전체 예제는
<a href=#%EC%98%88%EC%A0%9C>아래</a>를 참고한다.</p>
<h3 id=추천-예제>추천 예제</h3>
<p>파드시큐리티폴리시는 새롭고 간결해진 <code>PodSecurity</code> <a class=glossary-tooltip title="쿠버네티스 API 서버에서 요청을 처리하여 오브젝트가 지속되기 전에 그 요청을 가로채는 코드 조각." data-toggle=tooltip data-placement=top href=/docs/reference/access-authn-authz/admission-controllers/ target=_blank aria-label="어드미션 컨트롤러">어드미션 컨트롤러</a>로 대체되고 있다.
이 변경에 대한 상세사항은
<a href=/blog/2021/04/06/podsecuritypolicy-deprecation-past-present-and-future/>파드시큐리티폴리시 사용 중단: 과거, 현재, 그리고 미래</a>를 참조한다.
다음 가이드라인을 참조하여 파드시큐리티폴리시를 새로운 어드미션 컨트롤러로 쉽게 전환할 수 있다.</p>
<ol>
<li>
<p>파드시큐리티폴리시를 <a href=/docs/concepts/security/pod-security-standards/>파드 보안 표준</a>에 의해 정의된 폴리시로 한정한다.</p>
<ul>
<li>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/ko/examples/policy/privileged-psp.yaml download=policy/privileged-psp.yaml>Privileged</a>
</li>
<li>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/ko/examples/policy/baseline-psp.yaml download=policy/baseline-psp.yaml>Baseline</a>
</li>
<li>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/ko/examples/policy/restricted-psp.yaml download=policy/restricted-psp.yaml>Restricted</a>
</li>
</ul>
</li>
<li>
<p><code>system:serviceaccounts:&lt;namespace></code> (여기서 <code>&lt;namespace></code>는 타겟 네임스페이스) 그룹을 사용하여
파드시큐리티폴리시를 전체 네임스페이스에만 바인드한다. 예시는 다음과 같다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io/v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># 이 클러스터롤바인딩(ClusterRoleBinding)을 통해 &#34;development&#34; 네임스페이스의 모든 파드가 기준 파드시큐리티폴리시(PSP)를 사용할 수 있다.</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ClusterRoleBinding<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>psp-baseline-namespaces<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>roleRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ClusterRole<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>psp-baseline<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>subjects</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Group<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>system:serviceaccounts:development<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Group<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>system:serviceaccounts:canary<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span></code></pre></div></li>
</ol>
<h3 id=문제-해결>문제 해결</h3>
<ul>
<li><a href=/docs/reference/command-line-tools-reference/kube-controller-manager/>컨트롤러 관리자</a>는
보안 API 포트에 대해 실행되어야 하며 수퍼유저 권한이 없어야 한다.
API 서버 접근 제어에 대한 자세한 내용은
<a href=/ko/docs/concepts/security/controlling-access>쿠버네티스 API에 대한 접근 제어</a>를 참고하길 바란다.
컨트롤러 관리자가 신뢰할 수 있는 API 포트(<code>localhost</code> 리스너라고도 함)를
통해 연결된 경우, 요청이 인증 및 권한 부여 모듈을 우회하고,
모든 파드시큐리티폴리시 오브젝트가 허용되며 사용자는 특권을 가진 컨테이너를
만들 수 있는 권한을 부여할 수 있다.</li>
</ul>
<p>컨트롤러 관리자 권한 구성에 대한 자세한 내용은
<a href=/docs/reference/access-authn-authz/rbac/#controller-roles>컨트롤러 역할</a>을 참고하기 바란다.</p>
<h2 id=정책-순서>정책 순서</h2>
<p>파드 생성 및 업데이트를 제한할 뿐만 아니라 파드 시큐리티 폴리시를 사용하여
제어하는 많은 필드에 기본값을 제공할 수도 있다. 여러 정책을
사용할 수 있는 경우 파드 시큐리티 폴리시 컨트롤러는
다음 기준에 따라 정책을 선택한다.</p>
<ol>
<li>기본 설정을 변경하거나 파드를 변경하지 않고 파드를 있는 그대로 허용하는 파드시큐리티폴리시가
선호된다. 이러한 비-변이(non-mutating) 파드시큐리티폴리시의
순서는 중요하지 않다.</li>
<li>파드를 기본값으로 설정하거나 변경해야 하는 경우, 파드를 허용할 첫 번째 파드시큐리티폴리시
(이름순)가 선택된다.</li>
</ol>
<div class="alert alert-info note callout" role=alert>
<strong>참고:</strong> 업데이트 작업 중(파드 스펙에 대한 변경이 허용되지 않는 동안) 비-변이 파드시큐리티폴리시만
파드의 유효성을 검사하는 데 사용된다.
</div>
<h2 id=예제>예제</h2>
<p><em>이 예에서는 파드시큐리티폴리시 어드미션 컨트롤러가 활성화된 클러스터가 실행 중이고
클러스터 관리자 권한이 있다고 가정한다.</em></p>
<h3 id=설정>설정</h3>
<p>이 예제와 같이 네임스페이스와 서비스 어카운트를 설정한다.
이 서비스 어카운트를 사용하여 관리자가 아닌 사용자를 조정한다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create namespace psp-example
kubectl create serviceaccount -n psp-example fake-user
kubectl create rolebinding -n psp-example fake-editor --clusterrole<span style=color:#666>=</span>edit --serviceaccount<span style=color:#666>=</span>psp-example:fake-user
</code></pre></div><p>어떤 사용자로 활동하고 있는지 명확하게 하고 입력 내용을 저장하려면 2개의 별칭(alias)을
만든다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#a2f>alias</span> kubectl-admin<span style=color:#666>=</span><span style=color:#b44>&#39;kubectl -n psp-example&#39;</span>
<span style=color:#a2f>alias</span> kubectl-user<span style=color:#666>=</span><span style=color:#b44>&#39;kubectl --as=system:serviceaccount:psp-example:fake-user -n psp-example&#39;</span>
</code></pre></div><h3 id=정책과-파드-생성>정책과 파드 생성</h3>
<p>파일에서 예제 파드시큐리티폴리시 오브젝트를 정의한다. 이는 특권있는 파드를
만들지 못하게 하는 정책이다.
파드시큐리티폴리시 오브젝트의 이름은 유효한
<a href=/ko/docs/concepts/overview/working-with-objects/names#dns-%EC%84%9C%EB%B8%8C%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%9D%B4%EB%A6%84>DNS 서브도메인 이름</a>이어야 한다.</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/ko/examples/policy/example-psp.yaml download=policy/example-psp.yaml><code>policy/example-psp.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('policy-example-psp-yaml')" title="Copy policy/example-psp.yaml to clipboard">
</img>
</div>
<div class=includecode id=policy-example-psp-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>policy/v1beta1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>PodSecurityPolicy<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>example<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>privileged</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># 특권을 가진 파드는 허용금지!</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># 나머지는 일부 필수 필드를 채운다.</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>seLinux</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span>RunAsAny<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>supplementalGroups</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span>RunAsAny<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>runAsUser</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span>RunAsAny<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>fsGroup</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span>RunAsAny<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:#b44>&#39;*&#39;</span><span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<p>그리고 kubectl로 생성한다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-admin create -f example-psp.yaml
</code></pre></div><p>이제 권한이 없는 사용자로서 간단한 파드를 생성해보자.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user create -f- <span style=color:#b44>&lt;&lt;EOF
</span><span style=color:#b44>apiVersion: v1
</span><span style=color:#b44>kind: Pod
</span><span style=color:#b44>metadata:
</span><span style=color:#b44>  name: pause
</span><span style=color:#b44>spec:
</span><span style=color:#b44>  containers:
</span><span style=color:#b44>    - name: pause
</span><span style=color:#b44>      image: k8s.gcr.io/pause
</span><span style=color:#b44>EOF</span>
</code></pre></div><p>이것의 출력은 다음과 같을 것이다.</p>
<pre><code>Error from server (Forbidden): error when creating &quot;STDIN&quot;: pods &quot;pause&quot; is forbidden: unable to validate against any pod security policy: []
</code></pre><p><strong>무슨 일이 일어났나?</strong> 파드시큐리티폴리시가 생성되었지만, 파드의 서비스 어카운트나 <code>fake-user</code>는
새 정책을 사용할 권한이 없다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user auth can-i use podsecuritypolicy/example
no
</code></pre></div><p>예제 정책에서 <code>fake-user</code>에게 <code>use</code> 동사를 부여하는 rolebinding을
생성한다.</p>
<div class="alert alert-info note callout" role=alert>
<strong>참고:</strong> 이 방법은 권장하지 않는다! 선호하는 방법은 <a href=#%EB%8B%A4%EB%A5%B8-%ED%8C%8C%EB%93%9C%EB%A5%BC-%EC%8B%A4%ED%96%89>다음 절</a>을
참고하길 바란다.
</div>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-admin create role psp:unprivileged <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>    --verb<span style=color:#666>=</span>use <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>    --resource<span style=color:#666>=</span>podsecuritypolicy <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>    --resource-name<span style=color:#666>=</span>example
role <span style=color:#b44>&#34;psp:unprivileged&#34;</span> created

kubectl-admin create rolebinding fake-user:psp:unprivileged <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>    --role<span style=color:#666>=</span>psp:unprivileged <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>    --serviceaccount<span style=color:#666>=</span>psp-example:fake-user
rolebinding <span style=color:#b44>&#34;fake-user:psp:unprivileged&#34;</span> created

kubectl-user auth can-i use podsecuritypolicy/example
yes
</code></pre></div><p>이제 파드 생성을 다시 시도하자.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user create -f- <span style=color:#b44>&lt;&lt;EOF
</span><span style=color:#b44>apiVersion: v1
</span><span style=color:#b44>kind: Pod
</span><span style=color:#b44>metadata:
</span><span style=color:#b44>  name: pause
</span><span style=color:#b44>spec:
</span><span style=color:#b44>  containers:
</span><span style=color:#b44>    - name: pause
</span><span style=color:#b44>      image: k8s.gcr.io/pause
</span><span style=color:#b44>EOF</span>
</code></pre></div><p>이것의 출력은 다음과 같을 것이다.</p>
<pre><code>pod &quot;pause&quot; created
</code></pre><p>예상대로 작동한다! 그러나 특권있는 파드를 만들려는 시도는 여전히
거부되어야 한다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user create -f- <span style=color:#b44>&lt;&lt;EOF
</span><span style=color:#b44>apiVersion: v1
</span><span style=color:#b44>kind: Pod
</span><span style=color:#b44>metadata:
</span><span style=color:#b44>  name: privileged
</span><span style=color:#b44>spec:
</span><span style=color:#b44>  containers:
</span><span style=color:#b44>    - name: pause
</span><span style=color:#b44>      image: k8s.gcr.io/pause
</span><span style=color:#b44>      securityContext:
</span><span style=color:#b44>        privileged: true
</span><span style=color:#b44>EOF</span>
</code></pre></div><p>이것의 출력은 다음과 같을 것이다.</p>
<pre><code>Error from server (Forbidden): error when creating &quot;STDIN&quot;: pods &quot;privileged&quot; is forbidden: unable to validate against any pod security policy: [spec.containers[0].securityContext.privileged: Invalid value: true: Privileged containers are not allowed]
</code></pre><p>계속 진행하기 전에 파드를 삭제하자.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user delete pod pause
</code></pre></div><h3 id=다른-파드를-실행>다른 파드를 실행</h3>
<p>약간 다르게 다시 시도해보자.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user create deployment pause --image<span style=color:#666>=</span>k8s.gcr.io/pause
deployment <span style=color:#b44>&#34;pause&#34;</span> created

kubectl-user get pods
No resources found.

kubectl-user get events | head -n <span style=color:#666>2</span>
LASTSEEN   FIRSTSEEN   COUNT     NAME              KIND         SUBOBJECT                TYPE      REASON                  SOURCE                                  MESSAGE
1m         2m          <span style=color:#666>15</span>        pause-7774d79b5   ReplicaSet                            Warning   FailedCreate            replicaset-controller                   Error creating: pods <span style=color:#b44>&#34;pause-7774d79b5-&#34;</span> is forbidden: no providers available to validate pod request
</code></pre></div><p><strong>무슨 일이 일어났나?</strong> 우리는 이미 <code>fake-user</code>에 대해 <code>psp:unprivileged</code> 역할을 바인딩했는데,
<code>Error creating: pods "pause-7774d79b5-" is forbidden: no providers available to validate pod request</code> 오류가
발생하는 이유는 무엇인가? 그 답은 소스인 <code>replicaset-controller</code>에 있다. Fake-user가
디플로이먼트를 성공적으로 생성했지만(레플리카셋을 성공적으로 생성했음), 레플리카셋이
파드를 생성했을 때 podsecuritypolicy 예제를
사용할 권한이 없었다.</p>
<p>이 문제를 해결하려면 <code>psp:unprivileged</code> 역할을 파드의 서비스 어카운트에 대신
바인딩한다. 이 경우(지정하지 않았으므로) 서비스 어카운트는
<code>default</code>이다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-admin create rolebinding default:psp:unprivileged <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>    --role<span style=color:#666>=</span>psp:unprivileged <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>    --serviceaccount<span style=color:#666>=</span>psp-example:default
rolebinding <span style=color:#b44>&#34;default:psp:unprivileged&#34;</span> created
</code></pre></div><p>이제 다시 한번 해본다면 replicaset-controller가
파드를 성공적으로 생성할 것이다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user get pods --watch
NAME                    READY     STATUS    RESTARTS   AGE
pause-7774d79b5-qrgcb   0/1       Pending   <span style=color:#666>0</span>         1s
pause-7774d79b5-qrgcb   0/1       Pending   <span style=color:#666>0</span>         1s
pause-7774d79b5-qrgcb   0/1       ContainerCreating   <span style=color:#666>0</span>         1s
pause-7774d79b5-qrgcb   1/1       Running   <span style=color:#666>0</span>         2s
</code></pre></div><h3 id=정리>정리</h3>
<p>네임스페이스를 삭제하여 대부분의 예제 리소스를 정리한다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-admin delete ns psp-example
namespace <span style=color:#b44>&#34;psp-example&#34;</span> deleted
</code></pre></div><p><code>PodSecurityPolicy</code> 리소스는 네임스페이스에 포함되지 않으므로 별도로
정리해야 한다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-admin delete psp example
podsecuritypolicy <span style=color:#b44>&#34;example&#34;</span> deleted
</code></pre></div><h3 id=정책-예제>정책 예제</h3>
<p>다음은 파드 시큐리티 폴리시 어드미션 컨트롤러를 사용하지 않는 것과 동일하게 만들 수 있는
최소한의 제한 정책이다.</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/ko/examples/policy/privileged-psp.yaml download=policy/privileged-psp.yaml><code>policy/privileged-psp.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('policy-privileged-psp-yaml')" title="Copy policy/privileged-psp.yaml to clipboard">
</img>
</div>
<div class=includecode id=policy-privileged-psp-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>policy/v1beta1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>PodSecurityPolicy<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>privileged<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>seccomp.security.alpha.kubernetes.io/allowedProfileNames</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;*&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>privileged</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>allowPrivilegeEscalation</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>allowedCapabilities</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:#b44>&#39;*&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:#b44>&#39;*&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostNetwork</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostPorts</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>min</span>:<span style=color:#bbb> </span><span style=color:#666>0</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>max</span>:<span style=color:#bbb> </span><span style=color:#666>65535</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostIPC</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostPID</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>runAsUser</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;RunAsAny&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>seLinux</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;RunAsAny&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>supplementalGroups</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;RunAsAny&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>fsGroup</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;RunAsAny&#39;</span><span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<p>다음은 권한이 없는 사용자로서의 실행을 필요로 하고, 루트로의 에스컬레이션(escalation) 가능성을 차단하고,
여러 보안 메커니즘을 사용을 필요로 하는 제한적
정책의 예제이다.</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/ko/examples/policy/restricted-psp.yaml download=policy/restricted-psp.yaml><code>policy/restricted-psp.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('policy-restricted-psp-yaml')" title="Copy policy/restricted-psp.yaml to clipboard">
</img>
</div>
<div class=includecode id=policy-restricted-psp-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>policy/v1beta1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>PodSecurityPolicy<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>restricted<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>seccomp.security.alpha.kubernetes.io/allowedProfileNames</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;docker/default,runtime/default&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>apparmor.security.beta.kubernetes.io/allowedProfileNames</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;runtime/default&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>apparmor.security.beta.kubernetes.io/defaultProfileName</span>:<span style=color:#bbb>  </span><span style=color:#b44>&#39;runtime/default&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>privileged</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># 루트로의 에스컬레이션을 방지하는 데 필요하다.</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>allowPrivilegeEscalation</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>requiredDropCapabilities</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- ALL<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># 기본 볼륨 유형을 허용한다.</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;configMap&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;emptyDir&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;projected&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;secret&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;downwardAPI&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># 클러스터 관리자에 의해 구성된 휘발성 CSI 드라이버와 퍼시스턴트볼륨(PersistentVolume)의 사용은 안전하다고 가정한다.</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;csi&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;persistentVolumeClaim&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;ephemeral&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostNetwork</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostIPC</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostPID</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>runAsUser</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># 루트 권한없이 컨테이너를 실행해야 한다.</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;MustRunAsNonRoot&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>seLinux</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># 이 정책은 노드가 SELinux가 아닌 AppArmor를 사용한다고 가정한다.</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;RunAsAny&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>supplementalGroups</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;MustRunAs&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>ranges</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># 루트 그룹을 추가하지 않는다.</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>min</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>max</span>:<span style=color:#bbb> </span><span style=color:#666>65535</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>fsGroup</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;MustRunAs&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>ranges</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># 루트 그룹을 추가하지 않는다.</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>min</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>max</span>:<span style=color:#bbb> </span><span style=color:#666>65535</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>readOnlyRootFilesystem</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<p>더 많은 예제는 <a href=/docs/concepts/security/pod-security-standards/#policy-instantiation>파드 보안 표준</a>을 본다.</p>
<h2 id=정책-레퍼런스>정책 레퍼런스</h2>
<h3 id=특권을-가진>특권을 가진</h3>
<p><strong>Privileged</strong> - 파드의 컨테이너가 특권 모드를 사용할 수 있는지 여부를 결정한다.
기본적으로 컨테이너는 호스트의 모든 장치에 접근할 수 없지만
"특권을 가진" 컨테이너는 호스트의 모든 장치에 접근할 수 있다. 이것은
컨테이너가 호스트에서 실행되는 프로세스와 거의 동일한 접근을 허용한다.
이것은 네트워크 스택 조작 및 장치 접근과 같은
리눅스 기능을 사용하려는 컨테이너에 유용하다.</p>
<h3 id=호스트-네임스페이스>호스트 네임스페이스</h3>
<p><strong>HostPID</strong> - 파드 컨테이너가 호스트 프로세스 ID 네임스페이스를 공유할 수 있는지 여부를
제어한다. ptrace와 함께 사용하면 컨테이너 외부로 권한을 에스컬레이션하는 데 사용할 수
있다(ptrace는 기본적으로 금지되어 있음).</p>
<p><strong>HostIPC</strong> - 파드 컨테이너가 호스트 IPC 네임스페이스를 공유할 수 있는지 여부를
제어한다.</p>
<p><strong>HostNetwork</strong> - 파드가 노드 네트워크 네임스페이스를 사용할 수 있는지 여부를 제어한다.
이렇게 하면 파드에 루프백 장치에 접근 권한을 주고, 서비스는 로컬호스트(localhost)를 리스닝할 수 있으며,
동일한 노드에 있는 다른 파드의 네트워크 활동을 스누핑(snoop)하는 데
사용할 수 있다.</p>
<p><strong>HostPorts</strong> - 호스트 네트워크 네임스페이스에 허용되는 포트 범위의 목록을
제공한다. <code>min</code>과 <code>max</code>를 포함하여 <code>HostPortRange</code>의 목록으로 정의된다.
기본값은 허용하는 호스트 포트 없음(no allowed host ports)이다.</p>
<h3 id=볼륨-및-파일시스템>볼륨 및 파일시스템</h3>
<p><strong>Volumes</strong> - 허용되는 볼륨 유형의 목록을 제공한다. 허용 가능한 값은
볼륨을 생성할 때 정의된 볼륨 소스에 따른다. 볼륨 유형의 전체 목록은
<a href=/ko/docs/concepts/storage/volumes/#%EB%B3%BC%EB%A5%A8-%EC%9C%A0%ED%98%95%EB%93%A4>볼륨 유형들</a>에서 참고한다.
또한 <code>*</code>를 사용하여 모든 볼륨 유형을
허용할 수 있다.</p>
<p>새 PSP에 허용되는 볼륨의 <strong>최소 권장 셋</strong> 은 다음과 같다.</p>
<ul>
<li>컨피그맵</li>
<li>다운워드API</li>
<li>emptyDir</li>
<li>퍼시스턴트볼륨클레임</li>
<li>시크릿</li>
<li>프로젝티드(projected)</li>
</ul>
<div class="alert alert-danger warning callout" role=alert>
<strong>경고:</strong> 파드시큐리티폴리시는 <code>PersistentVolumeClaim</code>이 참조할 수 있는 <code>PersistentVolume</code>
오브젝트의 유형을 제한하지 않으며 hostPath 유형
<code>PersistentVolumes</code>은 읽기-전용 접근 모드를 지원하지 않는다. 신뢰할 수 있는 사용자만
<code>PersistentVolume</code> 오브젝트를 생성할 수 있는 권한을 부여 받아야 한다.
</div>
<p><strong>FSGroup</strong> - 일부 볼륨에 적용되는 보충 그룹(supplemental group)을 제어한다.</p>
<ul>
<li><em>MustRunAs</em> - 하나 이상의 <code>range</code>를 지정해야 한다. 첫 번째 범위의 최솟값을
기본값으로 사용한다. 모든 범위에 대해 검증한다.</li>
<li><em>MayRunAs</em> - 하나 이상의 <code>range</code>를 지정해야 한다. 기본값을 제공하지 않고
<code>FSGroups</code>을 설정하지 않은 상태로 둘 수 있다. <code>FSGroups</code>이 설정된 경우 모든 범위에 대해
유효성을 검사한다.</li>
<li><em>RunAsAny</em> - 기본값은 제공되지 않는다. 어떠한 <code>fsGroup</code> ID의 지정도 허용한다.</li>
</ul>
<p><strong>AllowedHostPaths</strong> - hostPath 볼륨에서 사용할 수 있는 호스트 경로의 목록을
지정한다. 빈 목록은 사용되는 호스트 경로에 제한이 없음을 의미한다.
이는 단일 <code>pathPrefix</code> 필드가 있는 오브젝트 목록으로 정의되며, hostPath 볼륨은
허용된 접두사로 시작하는 경로를 마운트할 수 있으며 <code>readOnly</code> 필드는
읽기-전용으로 마운트 되어야 함을 나타낸다.
예를 들면 다음과 같습니다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#bbb> </span><span style=color:green;font-weight:700>allowedHostPaths</span>:<span style=color:#bbb>
</span><span style=color:#bbb>   </span><span style=color:#080;font-style:italic># 이 정책은 &#34;/foo&#34;, &#34;/foo/&#34;, &#34;/foo/bar&#34; 등을 허용하지만,</span><span style=color:#bbb>
</span><span style=color:#bbb>   </span><span style=color:#080;font-style:italic># &#34;/fool&#34;, &#34;/etc/foo&#34; 등은 허용하지 않는다.</span><span style=color:#bbb>
</span><span style=color:#bbb>   </span><span style=color:#080;font-style:italic># &#34;/foo/../&#34; 는 절대 유효하지 않다.</span><span style=color:#bbb>
</span><span style=color:#bbb>   </span>- <span style=color:green;font-weight:700>pathPrefix</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;/foo&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:green;font-weight:700>readOnly</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># 읽기 전용 마운트만 허용</span><span style=color:#bbb>
</span></code></pre></div><div class="alert alert-danger warning callout" role=alert>
<strong>경고:</strong> <p>호스트 파일시스템에 제한없는 접근을 부여하며, 컨테이너가 특권을 에스컬레이션
(다른 컨테이너들에 있는 데이터를 읽고, 시스템 서비스의 자격 증명을 어뷰징(abusing)하는 등)할
수 있도록 만드는 다양한 방법이 있다. 예를 들면, Kubelet과 같다.</p>
<p>쓰기 가능한 hostPath 디렉터리 볼륨을 사용하면, 컨테이너가 <code>pathPrefix</code> 외부의
호스트 파일시스템에 대한 통행을 허용하는 방식으로 컨테이너의 파일시스템 쓰기(write)를 허용한다.
쿠버네티스 1.11 이상 버전에서 사용 가능한 <code>readOnly: true</code>는 지정된 <code>pathPrefix</code>에 대한
접근을 효과적으로 제한하기 위해 <strong>모든</strong> <code>allowedHostPaths</code>에서 사용해야 한다.</p>
</div>
<p><strong>ReadOnlyRootFilesystem</strong> - 컨테이너는 읽기-전용 루트 파일시스템(즉, 쓰기 가능한 레이어 없음)으로
실행해야 한다.</p>
<h3 id=flexvolume-드라이버>FlexVolume 드라이버</h3>
<p>flexvolume에서 사용할 수 있는 FlexVolume 드라이버의 목록을 지정한다.
빈 목록 또는 nil은 드라이버에 제한이 없음을 의미한다.
<a href=#%EB%B3%BC%EB%A5%A8-%EB%B0%8F-%ED%8C%8C%EC%9D%BC%EC%8B%9C%EC%8A%A4%ED%85%9C><code>volumes</code></a> 필드에 <code>flexVolume</code> 볼륨 유형이 포함되어
있는지 확인한다. 그렇지 않으면 FlexVolume 드라이버가 허용되지 않는다.</p>
<p>예를 들면 다음과 같다.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>policy/v1beta1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>PodSecurityPolicy<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>allow-flex-volumes<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ... 다른 스펙 필드</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- flexVolume<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>allowedFlexVolumes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>driver</span>:<span style=color:#bbb> </span>example/lvm<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>driver</span>:<span style=color:#bbb> </span>example/cifs<span style=color:#bbb>
</span></code></pre></div><h3 id=사용자-및-그룹>사용자 및 그룹</h3>
<p><strong>RunAsUser</strong> - 컨테이너를 실행할 사용자 ID를 제어힌다.</p>
<ul>
<li><em>MustRunAs</em> - 하나 이상의 <code>range</code>를 지정해야 한다. 첫 번째 범위의 최솟값을
기본값으로 사용한다. 모든 범위에 대해 검증한다.</li>
<li><em>MustRunAsNonRoot</em> - 파드가 0이 아닌 <code>runAsUser</code>로 제출되거나
이미지에 <code>USER</code> 지시문이 정의되어 있어야 한다(숫자 UID 사용). <code>runAsNonRoot</code> 또는
<code>runAsUser</code> 설정을 지정하지 않은 파드는 <code>runAsNonRoot=true</code>를 설정하도록
변경되므로 컨테이너에 0이 아닌 숫자가 정의된 <code>USER</code> 지시문이
필요하다. 기본값은 제공되지 않는다.
이 전략에서는 <code>allowPrivilegeEscalation=false</code>를 설정하는 것이 좋다.</li>
<li><em>RunAsAny</em> - 기본값은 제공되지 않는다. 어떠한 <code>runAsUser</code>의 지정도 허용한다.</li>
</ul>
<p><strong>RunAsGroup</strong> - 컨테이너가 실행될 기본 그룹 ID를 제어한다.</p>
<ul>
<li><em>MustRunAs</em> - 하나 이상의 <code>range</code>를 지정해야 한다. 첫 번째 범위의 최솟값을
기본값으로 사용한다. 모든 범위에 대해 검증한다.</li>
<li><em>MayRunAs</em> - <code>RunAsGroup</code>을 지정할 필요가 없다. 그러나 <code>RunAsGroup</code>을 지정하면
정의된 범위에 속해야 한다.</li>
<li><em>RunAsAny</em> - 기본값은 제공되지 않는다. 어떠한 <code>runAsGroup</code>의 지정도 허용한다.</li>
</ul>
<p><strong>SupplementalGroups</strong> - 컨테이너가 추가할 그룹 ID를 제어한다.</p>
<ul>
<li><em>MustRunAs</em> - 하나 이상의 <code>range</code>를 지정해야 한다. 첫 번째 범위의 최솟값을
기본값으로 사용한다. 모든 범위에 대해 검증한다.</li>
<li><em>MayRunAs</em> - 하나 이상의 <code>range</code>를 지정해야 한다. <code>supplementalGroups</code>에
기본값을 제공하지 않고 설정하지 않은 상태로 둘 수 있다.
<code>supplementalGroups</code>가 설정된 경우 모든 범위에 대해 유효성을 검증한다.</li>
<li><em>RunAsAny</em> - 기본값은 제공되지 않는다. 어떠한 <code>supplementalGroups</code>의 지정도
허용한다.</li>
</ul>
<h3 id=권한-에스컬레이션>권한 에스컬레이션</h3>
<p>이 옵션은 <code>allowPrivilegeEscalation</code> 컨테이너 옵션을 제어한다. 이 bool은
컨테이너 프로세스에서
<a href=https://www.kernel.org/doc/Documentation/prctl/no_new_privs.txt><code>no_new_privs</code></a>
플래그가 설정되는지 여부를 직접 제어한다. 이 플래그는 <code>setuid</code> 바이너리가
유효 사용자 ID를 변경하지 못하게 하고 파일에 추가 기능을 활성화하지 못하게
한다(예: <code>ping</code> 도구 사용을 못하게 함). <code>MustRunAsNonRoot</code>를 효과적으로
강제하려면 이 동작이 필요하다.</p>
<p><strong>AllowPrivilegeEscalation</strong> - 사용자가 컨테이너의 보안 컨텍스트를
<code>allowPrivilegeEscalation=true</code>로 설정할 수 있는지 여부를 게이트한다.
이 기본값은 setuid 바이너리를 중단하지 않도록 허용한다. 이를 <code>false</code>로 설정하면
컨테이너의 하위 프로세스가 상위 프로세스보다 더 많은 권한을 얻을 수 없다.</p>
<p><strong>DefaultAllowPrivilegeEscalation</strong> - <code>allowPrivilegeEscalation</code> 옵션의
기본값을 설정한다. 이것이 없는 기본 동작은 setuid 바이너리를 중단하지 않도록
권한 에스컬레이션을 허용하는 것이다. 해당 동작이 필요하지 않은 경우 이 필드를 사용하여
기본적으로 허용하지 않도록 설정할 수 있지만 파드는 여전히 <code>allowPrivilegeEscalation</code>을
명시적으로 요청할 수 있다.</p>
<h3 id=기능>기능</h3>
<p>리눅스 기능은 전통적으로 슈퍼유저와 관련된 권한을 보다 세밀하게 분류한다.
이러한 기능 중 일부는 권한 에스컬레이션 또는 컨테이너 분류에 사용될 수 있으며
파드시큐리티폴리시에 의해 제한될 수 있다. 리눅스 기능에 대한 자세한 내용은
<a href=https://man7.org/linux/man-pages/man7/capabilities.7.html>기능(7)</a>을
참고하길 바란다.</p>
<p>다음 필드는 대문자로 표기된 기능 이름 목록을
<code>CAP_</code> 접두사 없이 가져온다.</p>
<p><strong>AllowedCapabilities</strong> - 컨테이너에 추가될 수 있는 기능의 목록을
제공한다. 기본적인 기능 셋은 암시적으로 허용된다. 비어있는 셋은
기본 셋을 넘어서는 추가 기능이 추가되지 않는 것을
의미한다. <code>*</code>는 모든 기능을 허용하는 데 사용할 수 있다.</p>
<p><strong>RequiredDropCapabilities</strong> - 컨테이너에서 삭제해야 하는 기능이다.
이러한 기능은 기본 셋에서 제거되며 추가해서는 안된다.
<code>RequiredDropCapabilities</code>에 나열된 기능은 <code>AllowedCapabilities</code> 또는
<code>DefaultAddCapabilities</code>에 포함되지 않아야 한다.</p>
<p><strong>DefaultAddCapabilities</strong> - 런타임 기본값 외에 기본적으로 컨테이너에 추가되는 기능이다.
도커 런타임을 사용할 때 기본 기능 목록은
<a href=https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities>도커 문서</a>를
참고하길 바란다.</p>
<h3 id=selinux>SELinux</h3>
<ul>
<li><em>MustRunAs</em> - <code>seLinuxOptions</code>을 구성해야 한다.
<code>seLinuxOptions</code>을 기본값으로 사용한다. <code>seLinuxOptions</code>에 대해 유효성을 검사한다.</li>
<li><em>RunAsAny</em> - 기본값은 제공되지 않는다. 어떠한 <code>seLinuxOptions</code>의 지정도
허용한다.</li>
</ul>
<h3 id=allowedprocmounttypes>AllowedProcMountTypes</h3>
<p><code>allowedProcMountTypes</code>는 허용된 ProcMountTypes의 목록이다.
비어 있거나 nil은 <code>DefaultProcMountType</code>만 사용할 수 있음을 나타낸다.</p>
<p><code>DefaultProcMount</code>는 /proc의 읽기 전용 및 마스킹(masking)된 경로에 컨테이너 런타임
기본값을 사용한다. 대부분의 컨테이너 런타임은 특수 장치나 정보가 실수로 보안에
노출되지 않도록 /proc의 특정 경로를 마스킹한다. 이것은 문자열
<code>Default</code>로 표시된다.</p>
<p>유일하게 다른 ProcMountType은 <code>UnmaskedProcMount</code>로, 컨테이너 런타임의
기본 마스킹 동작을 무시하고 새로 작성된 /proc 컨테이너가 수정없이
그대로 유지되도록 한다. 이 문자열은
<code>Unmasked</code>로 표시된다.</p>
<h3 id=apparmor>AppArmor</h3>
<p>파드시큐리티폴리시의 어노테이션을 통해 제어된다. <a href=/ko/docs/tutorials/clusters/apparmor/#podsecuritypolicy-annotations>AppArmor
문서</a>를 참고하길 바란다.</p>
<h3 id=seccomp>Seccomp</h3>
<p>쿠버네티스 v1.19부터 파드나 컨테이너의 <code>securityContext</code> 에서
<code>seccompProfile</code> 필드를 사용하여 <a href=/docs/tutorials/clusters/seccomp>seccomp 프로파일 사용을
제어</a>할 수 있다. 이전 버전에서는, 파드에
어노테이션을 추가하여 seccomp를 제어했다. 두 버전에서 동일한 파드시큐리티폴리시를 사용하여
이러한 필드나 어노테이션이 적용되는 방식을 적용할 수 있다.</p>
<p><strong>seccomp.security.alpha.kubernetes.io/defaultProfileName</strong> - 컨테이너에
적용할 기본 seccomp 프로파일을 지정하는 어노테이션이다. 가능한 값은
다음과 같다.</p>
<ul>
<li><code>unconfined</code> - 대안이 제공되지 않으면 Seccomp가 컨테이너 프로세스에 적용되지
않는다(쿠버네티스의 기본값임).</li>
<li><code>runtime/default</code> - 기본 컨테이너 런타임 프로파일이 사용된다.</li>
<li><code>docker/default</code> - 도커 기본 seccomp 프로파일이 사용된다. 쿠버네티스 1.11 부터 사용 중단(deprecated)
되었다. 대신 <code>runtime/default</code> 사용을 권장한다.</li>
<li><code>localhost/&lt;path></code> - <code>&lt;seccomp_root>/&lt;path></code>에 있는 노드에서 파일을 프로파일로
지정한다. 여기서 <code>&lt;seccomp_root></code>는 Kubelet의 <code>--seccomp-profile-root</code> 플래그를
통해 정의된다. <code>--seccomp-profile-root</code> 플래그가
정의되어 있지 않으면, <code>&lt;root-dir></code> 이 <code>--root-dir</code> 플래그로
지정된 <code>&lt;root-dir>/seccomp</code> 기본 경로가 사용된다.</li>
</ul>
<div class="alert alert-info note callout" role=alert>
<strong>참고:</strong> <code>--seccomp-profile-root</code> 플래그는 쿠버네티스 v1.19부터 더 이상 사용되지
않는다. 사용자는 기본 경로를 사용하는 것이 좋다.
</div>
<p><strong>seccomp.security.alpha.kubernetes.io/allowedProfileNames</strong> - 파드 seccomp
어노테이션에 허용되는 값을 지정하는 어노테이션. 쉼표로 구분된
허용된 값의 목록으로 지정된다. 가능한 값은 위에 나열된 값과
모든 프로파일을 허용하는 <code>*</code> 이다.
이 주석이 없으면 기본값을 변경할 수 없다.</p>
<h3 id=sysctl>Sysctl</h3>
<p>기본적으로 모든 안전한 sysctls가 허용된다.</p>
<ul>
<li><code>forbiddenSysctls</code> - 특정 sysctls를 제외한다. 목록에서 안전한 것과 안전하지 않은 sysctls의 조합을 금지할 수 있다. 모든 sysctls 설정을 금지하려면 자체적으로 <code>*</code>를 사용한다.</li>
<li><code>allowedUnsafeSysctls</code> - <code>forbiddenSysctls</code>에 나열되지 않는 한 기본 목록에서 허용하지 않은 특정 sysctls를 허용한다.</li>
</ul>
<p><a href=/ko/docs/tasks/administer-cluster/sysctl-cluster/#%ED%8C%8C%EB%93%9C%EC%8B%9C%ED%81%90%EB%A6%AC%ED%8B%B0%ED%8F%B4%EB%A6%AC%EC%8B%9C-podsecuritypolicy>Sysctl 문서</a>를 참고하길 바란다.</p>
<h2 id=다음-내용>다음 내용</h2>
<ul>
<li>
<p><a href=/blog/2021/04/06/podsecuritypolicy-deprecation-past-present-and-future/>파드시큐리티폴리시 사용 중단: 과거, 현재, 그리고
미래</a>에서
파드시큐리티폴리시의 미래에 대해 알아본다.</p>
</li>
<li>
<p>폴리시 권장 사항에 대해서는 <a href=/docs/concepts/security/pod-security-standards/>파드 보안 표준</a>을 참조한다.</p>
</li>
<li>
<p>API 세부 정보는 <a href=/docs/reference/generated/kubernetes-api/v1.23/#podsecuritypolicy-v1beta1-policy>파드 시큐리티 폴리시 레퍼런스</a> 참조한다.</p>
</li>
</ul>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-b528c4464c030f3f044124b38d778f04>4 - 노드 리소스 매니저</h1>
<p>쿠버네티스는 지연 시간에 민감하고 처리량이 많은 워크로드를 지원하기 위해 리소스 매니저 세트를 제공한다. 매니저는 CPU, 장치 및 메모리 (hugepages) 리소스와 같은 특정한 요구 사항으로 구성된 파드를 위해 노드의 리소스 할당을 조정하고 최적화하는 것을 목표로 한다.</p>
<p>주 매니저인 토폴로지 매니저는 <a href=/docs/tasks/administer-cluster/topology-manager/>정책</a>을 통해 전체 리소스 관리 프로세스를 조정하는 Kubelet 컴포넌트이다.</p>
<p>개별 매니저의 구성은 다음의 문서에 자세히 기술되어 있다.</p>
<ul>
<li><a href=/docs/tasks/administer-cluster/cpu-management-policies/>CPU 관리 정책</a></li>
<li><a href=/ko/docs/concepts/extend-kubernetes/compute-storage-net/device-plugins/#%ED%86%A0%ED%8F%B4%EB%A1%9C%EC%A7%80-%EA%B4%80%EB%A6%AC%EC%9E%90%EC%99%80-%EC%9E%A5%EC%B9%98-%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8-%ED%86%B5%ED%95%A9>장치 매니저</a></li>
<li><a href=/docs/tasks/administer-cluster/memory-manager/>메모리 관리 정책</a></li>
</ul>
</div>
</main>
</div>
</div>
<footer class=d-print-none>
<div class=footer__links>
<nav>
<a class=text-white href=/ko/docs/home/>홈</a>
<a class=text-white href=/ko/blog/>블로그</a>
<a class=text-white href=/ko/training/>교육</a>
<a class=text-white href=/ko/partners/>파트너</a>
<a class=text-white href=/ko/community/>커뮤니티</a>
<a class=text-white href=/ko/case-studies/>사례 연구</a>
</nav>
</div>
<div class=container-fluid>
<div class=row>
<div class="col-6 col-sm-2 text-xs-center order-sm-2">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list">
<a class=text-white target=_blank href=https://discuss.kubernetes.io>
<i class="fa fa-envelope"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter>
<a class=text-white target=_blank href=https://twitter.com/kubernetesio>
<i class="fab fa-twitter"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Calendar aria-label=Calendar>
<a class=text-white target=_blank href="https://calendar.google.com/calendar/embed?src=calendar%40kubernetes.io">
<i class="fas fa-calendar-alt"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Youtube aria-label=Youtube>
<a class=text-white target=_blank href=https://youtube.com/kubernetescommunity>
<i class="fab fa-youtube"></i>
</a>
</li>
</ul>
</div>
<div class="col-6 col-sm-2 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank href=https://github.com/kubernetes/kubernetes>
<i class="fab fa-github"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack>
<a class=text-white target=_blank href=https://slack.k8s.io>
<i class="fab fa-slack"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Contribute aria-label=Contribute>
<a class=text-white target=_blank href=https://git.k8s.io/community/contributors/guide>
<i class="fas fa-edit"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow">
<a class=text-white target=_blank href=https://stackoverflow.com/questions/tagged/kubernetes>
<i class="fab fa-stack-overflow"></i>
</a>
</li>
</ul>
</div>
<div class="col-12 col-sm-8 text-center order-sm-2">
<small class=text-white>&copy; 2023 The Kubernetes Authors | Documentation Distributed under <a href=https://git.k8s.io/website/LICENSE class=light-text>CC BY 4.0</a></small>
<br>
<small class=text-white>Copyright &copy; 2023 The Linux Foundation &reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage class=light-text>Trademark Usage page</a></small>
<br>
<small class=text-white>ICP license: 京ICP备17074266号-3</small>
</div>
</div>
</div>
</footer>
</div>
<script src=/js/popper-1.14.3.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=/js/bootstrap-4.3.1.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script>
<script src=/js/main.min.40616251a9b6e4b689e7769be0340661efa4d7ebb73f957404e963e135b4ed52.js integrity="sha256-QGFiUam25LaJ53ab4DQGYe+k1+u3P5V0BOlj4TW07VI=" crossorigin=anonymous></script>
</body>
</html>