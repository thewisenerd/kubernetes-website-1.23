<!doctype html><html lang=en class=no-js>
<head>
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JPP6RFM2BP"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-JPP6RFM2BP')</script>
<link rel=alternate hreflang=zh href=https://kubernetes.io/zh/docs/concepts/security/>
<link rel=alternate hreflang=ko href=https://kubernetes.io/ko/docs/concepts/security/>
<link rel=alternate hreflang=ja href=https://kubernetes.io/ja/docs/concepts/security/>
<link rel=alternate hreflang=fr href=https://kubernetes.io/fr/docs/concepts/security/>
<link rel=alternate hreflang=pt-br href=https://kubernetes.io/pt-br/docs/concepts/security/>
<link rel=alternate hreflang=es href=https://kubernetes.io/es/docs/concepts/security/>
<link rel=alternate hreflang=id href=https://kubernetes.io/id/docs/concepts/security/>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.87.0">
<link rel=canonical type=text/html href=https://kubernetes.io/docs/concepts/security/>
<link rel="shortcut icon" type=image/png href=/images/favicon.png>
<link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=manifest href=/manifest.webmanifest>
<link rel=apple-touch-icon href=/images/kubernetes-192x192.png>
<title>Security | Kubernetes</title><meta property="og:title" content="Security">
<meta property="og:description" content="Concepts for keeping your cloud-native workload secure.
">
<meta property="og:type" content="website">
<meta property="og:url" content="https://kubernetes.io/docs/concepts/security/"><meta property="og:site_name" content="Kubernetes">
<meta itemprop=name content="Security">
<meta itemprop=description content="Concepts for keeping your cloud-native workload secure.
"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Security">
<meta name=twitter:description content="Concepts for keeping your cloud-native workload secure.
">
<link href=/scss/main.css rel=stylesheet>
<script src=/js/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","url":"https://kubernetes.io","logo":"https://kubernetes.io/images/favicon.png"}</script>
<meta name=theme-color content="#326ce5">
<link rel=stylesheet href=/css/feature-states.css>
<meta name=description content="Concepts for keeping your cloud-native workload secure.
">
<meta property="og:description" content="Concepts for keeping your cloud-native workload secure.
">
<meta name=twitter:description content="Concepts for keeping your cloud-native workload secure.
">
<meta property="og:url" content="https://kubernetes.io/docs/concepts/security/">
<meta property="og:title" content="Security">
<meta name=twitter:title content="Security">
<meta name=twitter:image content="https://kubernetes.io/images/favicon.png">
<meta name=twitter:image:alt content="Kubernetes">
<meta property="og:image" content="/images/kubernetes-horizontal-color.png">
<meta property="og:type" content="article">
<script src=/js/script.js></script>
</head>
<body class=td-section>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" data-auto-burger=primary>
<a class=navbar-brand href=/></a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-2 mb-lg-0">
<a class="nav-link active" href=/docs/>Documentation</a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/blog/>Kubernetes Blog</a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/training/>Training</a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/partners/>Partners</a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/community/>Community</a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/case-studies/>Case Studies</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
Versions
</a>
<div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/releases>Release Information</a>
<a class=dropdown-item href=https://kubernetes.io/docs/concepts/security/>v1.27</a>
<a class=dropdown-item href=https://v1-26.docs.kubernetes.io/docs/concepts/security/>v1.26</a>
<a class=dropdown-item href=https://v1-25.docs.kubernetes.io/docs/concepts/security/>v1.25</a>
<a class=dropdown-item href=https://v1-24.docs.kubernetes.io/docs/concepts/security/>v1.24</a>
<a class=dropdown-item href=https://v1-23.docs.kubernetes.io/docs/concepts/security/>v1.23</a>
</div>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdownMenuLink role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
English
</a>
<div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/zh/docs/concepts/security/>中文 Chinese</a>
<a class=dropdown-item href=/ko/docs/concepts/security/>한국어 Korean</a>
<a class=dropdown-item href=/ja/docs/concepts/security/>日本語 Japanese</a>
<a class=dropdown-item href=/fr/docs/concepts/security/>Français</a>
<a class=dropdown-item href=/pt-br/docs/concepts/security/>Português</a>
<a class=dropdown-item href=/es/docs/concepts/security/>Español</a>
<a class=dropdown-item href=/id/docs/concepts/security/>Bahasa Indonesia</a>
</div>
</li>
</ul>
</div>
<button id=hamburger onclick=kub.toggleMenu() data-auto-burger-exclude><div></div></button>
</nav>
</header>
<div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<div class=td-content>
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.
</p><p>
<a href=/docs/concepts/security/>Return to the regular view of this page</a>.
</p>
</div>
<h1 class=title>Security</h1>
<div class=lead>Concepts for keeping your cloud-native workload secure.</div>
<ul>
<li>1: <a href=#pg-04eeb110d75afc8acb2cf7a3db743985>Overview of Cloud Native Security</a></li>
<li>2: <a href=#pg-1fb24c1dd155f43849da490a74c4b8c5>Pod Security Standards</a></li>
<li>3: <a href=#pg-bc9934fccfeaf880eec6ea79025c0381>Pod Security Admission</a></li>
<li>4: <a href=#pg-ac71855bb20cbf21edc666e810f4103a>Pod Security Policies</a></li>
<li>5: <a href=#pg-4d77d1ae4c06aa14f54b385191627881>Controlling Access to the Kubernetes API</a></li>
</ul>
<div class=content>
</div>
</div>
<div class=td-content>
<h1 id=pg-04eeb110d75afc8acb2cf7a3db743985>1 - Overview of Cloud Native Security</h1>
<div class=lead>A model for thinking about Kubernetes security in the context of Cloud Native security.</div>
<p>This overview defines a model for thinking about Kubernetes security in the context of Cloud Native security.</p>
<div class="alert alert-danger warning callout" role=alert>
<strong>Warning:</strong> This container security model provides suggestions, not proven information security policies.
</div>
<h2 id=the-4c-s-of-cloud-native-security>The 4C's of Cloud Native security</h2>
<p>You can think about security in layers. The 4C's of Cloud Native security are Cloud,
Clusters, Containers, and Code.</p>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> This layered approach augments the <a href=https://en.wikipedia.org/wiki/Defense_in_depth_(computing)>defense in depth</a>
computing approach to security, which is widely regarded as a best practice for securing
software systems.
</div>
<figure class=diagram-large>
<img src=/images/docs/4c.png> <figcaption>
<h4>The 4C's of Cloud Native Security</h4>
</figcaption>
</figure>
<p>Each layer of the Cloud Native security model builds upon the next outermost layer.
The Code layer benefits from strong base (Cloud, Cluster, Container) security layers.
You cannot safeguard against poor security standards in the base layers by addressing
security at the Code level.</p>
<h2 id=cloud>Cloud</h2>
<p>In many ways, the Cloud (or co-located servers, or the corporate datacenter) is the
<a href=https://en.wikipedia.org/wiki/Trusted_computing_base>trusted computing base</a>
of a Kubernetes cluster. If the Cloud layer is vulnerable (or
configured in a vulnerable way) then there is no guarantee that the components built
on top of this base are secure. Each cloud provider makes security recommendations
for running workloads securely in their environment.</p>
<h3 id=cloud-provider-security>Cloud provider security</h3>
<p>If you are running a Kubernetes cluster on your own hardware or a different cloud provider,
consult your documentation for security best practices.
Here are links to some of the popular cloud providers' security documentation:</p>
<table><caption style=display:none>Cloud provider security</caption>
<thead>
<tr>
<th>IaaS Provider</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr>
<td>Alibaba Cloud</td>
<td><a href=https://www.alibabacloud.com/trust-center>https://www.alibabacloud.com/trust-center</a></td>
</tr>
<tr>
<td>Amazon Web Services</td>
<td><a href=https://aws.amazon.com/security/>https://aws.amazon.com/security/</a></td>
</tr>
<tr>
<td>Google Cloud Platform</td>
<td><a href=https://cloud.google.com/security/>https://cloud.google.com/security/</a></td>
</tr>
<tr>
<td>IBM Cloud</td>
<td><a href=https://www.ibm.com/cloud/security>https://www.ibm.com/cloud/security</a></td>
</tr>
<tr>
<td>Microsoft Azure</td>
<td><a href=https://docs.microsoft.com/en-us/azure/security/azure-security>https://docs.microsoft.com/en-us/azure/security/azure-security</a></td>
</tr>
<tr>
<td>Oracle Cloud Infrastructure</td>
<td><a href=https://www.oracle.com/security/>https://www.oracle.com/security/</a></td>
</tr>
<tr>
<td>VMWare VSphere</td>
<td><a href=https://www.vmware.com/security/hardening-guides.html>https://www.vmware.com/security/hardening-guides.html</a></td>
</tr>
</tbody>
</table>
<h3 id=infrastructure-security>Infrastructure security</h3>
<p>Suggestions for securing your infrastructure in a Kubernetes cluster:</p>
<table><caption style=display:none>Infrastructure security</caption>
<thead>
<tr>
<th>Area of Concern for Kubernetes Infrastructure</th>
<th>Recommendation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Network access to API Server (Control plane)</td>
<td>All access to the Kubernetes control plane is not allowed publicly on the internet and is controlled by network access control lists restricted to the set of IP addresses needed to administer the cluster.</td>
</tr>
<tr>
<td>Network access to Nodes (nodes)</td>
<td>Nodes should be configured to <em>only</em> accept connections (via network access control lists) from the control plane on the specified ports, and accept connections for services in Kubernetes of type NodePort and LoadBalancer. If possible, these nodes should not be exposed on the public internet entirely.</td>
</tr>
<tr>
<td>Kubernetes access to Cloud Provider API</td>
<td>Each cloud provider needs to grant a different set of permissions to the Kubernetes control plane and nodes. It is best to provide the cluster with cloud provider access that follows the <a href=https://en.wikipedia.org/wiki/Principle_of_least_privilege>principle of least privilege</a> for the resources it needs to administer. The <a href=https://github.com/kubernetes/kops/blob/master/docs/iam_roles.md#iam-roles>Kops documentation</a> provides information about IAM policies and roles.</td>
</tr>
<tr>
<td>Access to etcd</td>
<td>Access to etcd (the datastore of Kubernetes) should be limited to the control plane only. Depending on your configuration, you should attempt to use etcd over TLS. More information can be found in the <a href=https://github.com/etcd-io/etcd/tree/master/Documentation>etcd documentation</a>.</td>
</tr>
<tr>
<td>etcd Encryption</td>
<td>Wherever possible it's a good practice to encrypt all storage at rest, and since etcd holds the state of the entire cluster (including Secrets) its disk should especially be encrypted at rest.</td>
</tr>
</tbody>
</table>
<h2 id=cluster>Cluster</h2>
<p>There are two areas of concern for securing Kubernetes:</p>
<ul>
<li>Securing the cluster components that are configurable</li>
<li>Securing the applications which run in the cluster</li>
</ul>
<h3 id=cluster-components>Components of the Cluster</h3>
<p>If you want to protect your cluster from accidental or malicious access and adopt
good information practices, read and follow the advice about
<a href=/docs/tasks/administer-cluster/securing-a-cluster/>securing your cluster</a>.</p>
<h3 id=cluster-applications>Components in the cluster (your application)</h3>
<p>Depending on the attack surface of your application, you may want to focus on specific
aspects of security. For example: If you are running a service (Service A) that is critical
in a chain of other resources and a separate workload (Service B) which is
vulnerable to a resource exhaustion attack, then the risk of compromising Service A
is high if you do not limit the resources of Service B. The following table lists
areas of security concerns and recommendations for securing workloads running in Kubernetes:</p>
<table>
<thead>
<tr>
<th>Area of Concern for Workload Security</th>
<th>Recommendation</th>
</tr>
</thead>
<tbody>
<tr>
<td>RBAC Authorization (Access to the Kubernetes API)</td>
<td><a href=https://kubernetes.io/docs/reference/access-authn-authz/rbac/>https://kubernetes.io/docs/reference/access-authn-authz/rbac/</a></td>
</tr>
<tr>
<td>Authentication</td>
<td><a href=https://kubernetes.io/docs/concepts/security/controlling-access/>https://kubernetes.io/docs/concepts/security/controlling-access/</a></td>
</tr>
<tr>
<td>Application secrets management (and encrypting them in etcd at rest)</td>
<td><a href=https://kubernetes.io/docs/concepts/configuration/secret/>https://kubernetes.io/docs/concepts/configuration/secret/</a> <br> <a href=https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/>https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/</a></td>
</tr>
<tr>
<td>Ensuring that pods meet defined Pod Security Standards</td>
<td><a href=https://kubernetes.io/docs/concepts/security/pod-security-standards/#policy-instantiation>https://kubernetes.io/docs/concepts/security/pod-security-standards/#policy-instantiation</a></td>
</tr>
<tr>
<td>Quality of Service (and Cluster resource management)</td>
<td><a href=https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/>https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/</a></td>
</tr>
<tr>
<td>Network Policies</td>
<td><a href=https://kubernetes.io/docs/concepts/services-networking/network-policies/>https://kubernetes.io/docs/concepts/services-networking/network-policies/</a></td>
</tr>
<tr>
<td>TLS for Kubernetes Ingress</td>
<td><a href=https://kubernetes.io/docs/concepts/services-networking/ingress/#tls>https://kubernetes.io/docs/concepts/services-networking/ingress/#tls</a></td>
</tr>
</tbody>
</table>
<h2 id=container>Container</h2>
<p>Container security is outside the scope of this guide. Here are general recommendations and
links to explore this topic:</p>
<table>
<thead>
<tr>
<th>Area of Concern for Containers</th>
<th>Recommendation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Container Vulnerability Scanning and OS Dependency Security</td>
<td>As part of an image build step, you should scan your containers for known vulnerabilities.</td>
</tr>
<tr>
<td>Image Signing and Enforcement</td>
<td>Sign container images to maintain a system of trust for the content of your containers.</td>
</tr>
<tr>
<td>Disallow privileged users</td>
<td>When constructing containers, consult your documentation for how to create users inside of the containers that have the least level of operating system privilege necessary in order to carry out the goal of the container.</td>
</tr>
<tr>
<td>Use container runtime with stronger isolation</td>
<td>Select <a href=/docs/concepts/containers/runtime-class/>container runtime classes</a> that provide stronger isolation</td>
</tr>
</tbody>
</table>
<h2 id=code>Code</h2>
<p>Application code is one of the primary attack surfaces over which you have the most control.
While securing application code is outside of the Kubernetes security topic, here
are recommendations to protect application code:</p>
<h3 id=code-security>Code security</h3>
<table><caption style=display:none>Code security</caption>
<thead>
<tr>
<th>Area of Concern for Code</th>
<th>Recommendation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Access over TLS only</td>
<td>If your code needs to communicate by TCP, perform a TLS handshake with the client ahead of time. With the exception of a few cases, encrypt everything in transit. Going one step further, it's a good idea to encrypt network traffic between services. This can be done through a process known as mutual TLS authentication or <a href=https://en.wikipedia.org/wiki/Mutual_authentication>mTLS</a> which performs a two sided verification of communication between two certificate holding services.</td>
</tr>
<tr>
<td>Limiting port ranges of communication</td>
<td>This recommendation may be a bit self-explanatory, but wherever possible you should only expose the ports on your service that are absolutely essential for communication or metric gathering.</td>
</tr>
<tr>
<td>3rd Party Dependency Security</td>
<td>It is a good practice to regularly scan your application's third party libraries for known security vulnerabilities. Each programming language has a tool for performing this check automatically.</td>
</tr>
<tr>
<td>Static Code Analysis</td>
<td>Most languages provide a way for a snippet of code to be analyzed for any potentially unsafe coding practices. Whenever possible you should perform checks using automated tooling that can scan codebases for common security errors. Some of the tools can be found at: <a href=https://owasp.org/www-community/Source_Code_Analysis_Tools>https://owasp.org/www-community/Source_Code_Analysis_Tools</a></td>
</tr>
<tr>
<td>Dynamic probing attacks</td>
<td>There are a few automated tools that you can run against your service to try some of the well known service attacks. These include SQL injection, CSRF, and XSS. One of the most popular dynamic analysis tools is the <a href=https://owasp.org/www-project-zap/>OWASP Zed Attack proxy</a> tool.</td>
</tr>
</tbody>
</table>
<h2 id=what-s-next>What's next</h2>
<p>Learn about related Kubernetes security topics:</p>
<ul>
<li><a href=/docs/concepts/security/pod-security-standards/>Pod security standards</a></li>
<li><a href=/docs/concepts/services-networking/network-policies/>Network policies for Pods</a></li>
<li><a href=/docs/concepts/security/controlling-access>Controlling Access to the Kubernetes API</a></li>
<li><a href=/docs/tasks/administer-cluster/securing-a-cluster/>Securing your cluster</a></li>
<li><a href=/docs/tasks/tls/managing-tls-in-a-cluster/>Data encryption in transit</a> for the control plane</li>
<li><a href=/docs/tasks/administer-cluster/encrypt-data/>Data encryption at rest</a></li>
<li><a href=/docs/concepts/configuration/secret/>Secrets in Kubernetes</a></li>
<li><a href=/docs/concepts/containers/runtime-class>Runtime class</a></li>
</ul>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-1fb24c1dd155f43849da490a74c4b8c5>2 - Pod Security Standards</h1>
<div class=lead>A detailed look at the different policy levels defined in the Pod Security Standards.</div>
<p>The Pod Security Standards define three different <em>policies</em> to broadly cover the security
spectrum. These policies are <em>cumulative</em> and range from highly-permissive to highly-restrictive.
This guide outlines the requirements of each policy.</p>
<table>
<thead>
<tr>
<th>Profile</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong style=white-space:nowrap>Privileged</strong></td>
<td>Unrestricted policy, providing the widest possible level of permissions. This policy allows for known privilege escalations.</td>
</tr>
<tr>
<td><strong style=white-space:nowrap>Baseline</strong></td>
<td>Minimally restrictive policy which prevents known privilege escalations. Allows the default (minimally specified) Pod configuration.</td>
</tr>
<tr>
<td><strong style=white-space:nowrap>Restricted</strong></td>
<td>Heavily restricted policy, following current Pod hardening best practices.</td>
</tr>
</tbody>
</table>
<h2 id=profile-details>Profile Details</h2>
<h3 id=privileged>Privileged</h3>
<p><strong>The <em>Privileged</em> policy is purposely-open, and entirely unrestricted.</strong> This type of policy is
typically aimed at system- and infrastructure-level workloads managed by privileged, trusted users.</p>
<p>The Privileged policy is defined by an absence of restrictions. For allow-by-default enforcement
mechanisms (such as gatekeeper), the Privileged policy may be an absence of applied constraints
rather than an instantiated profile. In contrast, for a deny-by-default mechanism (such as Pod
Security Policy) the Privileged policy should enable all controls (disable all restrictions).</p>
<h3 id=baseline>Baseline</h3>
<p><strong>The <em>Baseline</em> policy is aimed at ease of adoption for common containerized workloads while
preventing known privilege escalations.</strong> This policy is targeted at application operators and
developers of non-critical applications. The following listed controls should be
enforced/disallowed:</p>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> In this table, wildcards (<code>*</code>) indicate all elements in a list. For example,
<code>spec.containers[*].securityContext</code> refers to the Security Context object for <em>all defined
containers</em>. If any of the listed containers fails to meet the requirements, the entire pod will
fail validation.
</div>
<table>
<caption style=display:none>Baseline policy specification</caption>
<tbody>
<tr>
<th>Control</th>
<th>Policy</th>
</tr>
<tr>
<td style=white-space:nowrap>HostProcess</td>
<td>
<p>Windows pods offer the ability to run <a href=/docs/tasks/configure-pod-container/create-hostprocess-pod>HostProcess containers</a> which enables privileged access to the Windows node. Privileged access to the host is disallowed in the baseline policy. HostProcess pods are an <strong>alpha</strong> feature as of Kubernetes <strong>v1.22</strong>.</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.securityContext.windowsOptions.hostProcess</code></li>
<li><code>spec.containers[*].securityContext.windowsOptions.hostProcess</code></li>
<li><code>spec.initContainers[*].securityContext.windowsOptions.hostProcess</code></li>
<li><code>spec.ephemeralContainers[*].securityContext.windowsOptions.hostProcess</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li>Undefined/nil</li>
<li><code>false</code></li>
</ul>
</td>
</tr>
<tr>
<td style=white-space:nowrap>Host Namespaces</td>
<td>
<p>Sharing the host namespaces must be disallowed.</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.hostNetwork</code></li>
<li><code>spec.hostPID</code></li>
<li><code>spec.hostIPC</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li>Undefined/nil</li>
<li><code>false</code></li>
</ul>
</td>
</tr>
<tr>
<td style=white-space:nowrap>Privileged Containers</td>
<td>
<p>Privileged Pods disable most security mechanisms and must be disallowed.</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.containers[*].securityContext.privileged</code></li>
<li><code>spec.initContainers[*].securityContext.privileged</code></li>
<li><code>spec.ephemeralContainers[*].securityContext.privileged</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li>Undefined/nil</li>
<li><code>false</code></li>
</ul>
</td>
</tr>
<tr>
<td style=white-space:nowrap>Capabilities</td>
<td>
<p>Adding additional capabilities beyond those listed below must be disallowed.</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.containers[*].securityContext.capabilities.add</code></li>
<li><code>spec.initContainers[*].securityContext.capabilities.add</code></li>
<li><code>spec.ephemeralContainers[*].securityContext.capabilities.add</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li>Undefined/nil</li>
<li><code>AUDIT_WRITE</code></li>
<li><code>CHOWN</code></li>
<li><code>DAC_OVERRIDE</code></li>
<li><code>FOWNER</code></li>
<li><code>FSETID</code></li>
<li><code>KILL</code></li>
<li><code>MKNOD</code></li>
<li><code>NET_BIND_SERVICE</code></li>
<li><code>SETFCAP</code></li>
<li><code>SETGID</code></li>
<li><code>SETPCAP</code></li>
<li><code>SETUID</code></li>
<li><code>SYS_CHROOT</code></li>
</ul>
</td>
</tr>
<tr>
<td style=white-space:nowrap>HostPath Volumes</td>
<td>
<p>HostPath volumes must be forbidden.</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.volumes[*].hostPath</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li>Undefined/nil</li>
</ul>
</td>
</tr>
<tr>
<td style=white-space:nowrap>Host Ports</td>
<td>
<p>HostPorts should be disallowed, or at minimum restricted to a known list.</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.containers[*].ports[*].hostPort</code></li>
<li><code>spec.initContainers[*].ports[*].hostPort</code></li>
<li><code>spec.ephemeralContainers[*].ports[*].hostPort</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li>Undefined/nil</li>
<li>Known list</li>
<li><code>0</code></li>
</ul>
</td>
</tr>
<tr>
<td style=white-space:nowrap>AppArmor</td>
<td>
<p>On supported hosts, the <code>runtime/default</code> AppArmor profile is applied by default. The baseline policy should prevent overriding or disabling the default AppArmor profile, or restrict overrides to an allowed set of profiles.</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>metadata.annotations["container.apparmor.security.beta.kubernetes.io/*"]</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li>Undefined/nil</li>
<li><code>runtime/default</code></li>
<li><code>localhost/*</code></li>
</ul>
</td>
</tr>
<tr>
<td style=white-space:nowrap>SELinux</td>
<td>
<p>Setting the SELinux type is restricted, and setting a custom SELinux user or role option is forbidden.</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.securityContext.seLinuxOptions.type</code></li>
<li><code>spec.containers[*].securityContext.seLinuxOptions.type</code></li>
<li><code>spec.initContainers[*].securityContext.seLinuxOptions.type</code></li>
<li><code>spec.ephemeralContainers[*].securityContext.seLinuxOptions.type</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li>Undefined/""</li>
<li><code>container_t</code></li>
<li><code>container_init_t</code></li>
<li><code>container_kvm_t</code></li>
</ul>
<hr>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.securityContext.seLinuxOptions.user</code></li>
<li><code>spec.containers[*].securityContext.seLinuxOptions.user</code></li>
<li><code>spec.initContainers[*].securityContext.seLinuxOptions.user</code></li>
<li><code>spec.ephemeralContainers[*].securityContext.seLinuxOptions.user</code></li>
<li><code>spec.securityContext.seLinuxOptions.role</code></li>
<li><code>spec.containers[*].securityContext.seLinuxOptions.role</code></li>
<li><code>spec.initContainers[*].securityContext.seLinuxOptions.role</code></li>
<li><code>spec.ephemeralContainers[*].securityContext.seLinuxOptions.role</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li>Undefined/""</li>
</ul>
</td>
</tr>
<tr>
<td style=white-space:nowrap><code>/proc</code> Mount Type</td>
<td>
<p>The default <code>/proc</code> masks are set up to reduce attack surface, and should be required.</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.containers[*].securityContext.procMount</code></li>
<li><code>spec.initContainers[*].securityContext.procMount</code></li>
<li><code>spec.ephemeralContainers[*].securityContext.procMount</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li>Undefined/nil</li>
<li><code>Default</code></li>
</ul>
</td>
</tr>
<tr>
<td>Seccomp</td>
<td>
<p>Seccomp profile must not be explicitly set to <code>Unconfined</code>.</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.securityContext.seccompProfile.type</code></li>
<li><code>spec.containers[*].securityContext.seccompProfile.type</code></li>
<li><code>spec.initContainers[*].securityContext.seccompProfile.type</code></li>
<li><code>spec.ephemeralContainers[*].securityContext.seccompProfile.type</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li>Undefined/nil</li>
<li><code>RuntimeDefault</code></li>
<li><code>Localhost</code></li>
</ul>
</td>
</tr>
<tr>
<td style=white-space:nowrap>Sysctls</td>
<td>
<p>Sysctls can disable security mechanisms or affect all containers on a host, and should be disallowed except for an allowed "safe" subset. A sysctl is considered safe if it is namespaced in the container or the Pod, and it is isolated from other Pods or processes on the same Node.</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.securityContext.sysctls[*].name</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li>Undefined/nil</li>
<li><code>kernel.shm_rmid_forced</code></li>
<li><code>net.ipv4.ip_local_port_range</code></li>
<li><code>net.ipv4.ip_unprivileged_port_start</code></li>
<li><code>net.ipv4.tcp_syncookies</code></li>
<li><code>net.ipv4.ping_group_range</code></li>
</ul>
</td>
</tr>
</tbody>
</table>
<h3 id=restricted>Restricted</h3>
<p><strong>The <em>Restricted</em> policy is aimed at enforcing current Pod hardening best practices, at the
expense of some compatibility.</strong> It is targeted at operators and developers of security-critical
applications, as well as lower-trust users. The following listed controls should be
enforced/disallowed:</p>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> In this table, wildcards (<code>*</code>) indicate all elements in a list. For example,
<code>spec.containers[*].securityContext</code> refers to the Security Context object for <em>all defined
containers</em>. If any of the listed containers fails to meet the requirements, the entire pod will
fail validation.
</div>
<table>
<caption style=display:none>Restricted policy specification</caption>
<tbody>
<tr>
<td><strong>Control</strong></td>
<td><strong>Policy</strong></td>
</tr>
<tr>
<td colspan=2><em>Everything from the baseline profile.</em></td>
</tr>
<tr>
<td style=white-space:nowrap>Volume Types</td>
<td>
<p>The restricted policy only permits the following volume types.</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.volumes[*]</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
Every item in the <code>spec.volumes[*]</code> list must set one of the following fields to a non-null value:
<ul>
<li><code>spec.volumes[*].configMap</code></li>
<li><code>spec.volumes[*].csi</code></li>
<li><code>spec.volumes[*].downwardAPI</code></li>
<li><code>spec.volumes[*].emptyDir</code></li>
<li><code>spec.volumes[*].ephemeral</code></li>
<li><code>spec.volumes[*].persistentVolumeClaim</code></li>
<li><code>spec.volumes[*].projected</code></li>
<li><code>spec.volumes[*].secret</code></li>
</ul>
</td>
</tr>
<tr>
<td style=white-space:nowrap>Privilege Escalation (v1.8+)</td>
<td>
<p>Privilege escalation (such as via set-user-ID or set-group-ID file mode) should not be allowed.</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.containers[*].securityContext.allowPrivilegeEscalation</code></li>
<li><code>spec.initContainers[*].securityContext.allowPrivilegeEscalation</code></li>
<li><code>spec.ephemeralContainers[*].securityContext.allowPrivilegeEscalation</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li><code>false</code></li>
</ul>
</td>
</tr>
<tr>
<td style=white-space:nowrap>Running as Non-root</td>
<td>
<p>Containers must be required to run as non-root users.</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.securityContext.runAsNonRoot</code></li>
<li><code>spec.containers[*].securityContext.runAsNonRoot</code></li>
<li><code>spec.initContainers[*].securityContext.runAsNonRoot</code></li>
<li><code>spec.ephemeralContainers[*].securityContext.runAsNonRoot</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li><code>true</code></li>
</ul>
<small>
The container fields may be undefined/<code>nil</code> if the pod-level
<code>spec.securityContext.runAsNonRoot</code> is set to <code>true</code>.
</small>
</td>
</tr>
<tr>
<td style=white-space:nowrap>Running as Non-root user (v1.23+)</td>
<td>
<p>Containers must not set <tt>runAsUser</tt> to 0</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.securityContext.runAsUser</code></li>
<li><code>spec.containers[*].securityContext.runAsUser</code></li>
<li><code>spec.initContainers[*].securityContext.runAsUser</code></li>
<li><code>spec.ephemeralContainers[*].securityContext.runAsUser</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li>any non-zero value</li>
<li><code>undefined/null</code></li>
</ul>
</td>
</tr>
<tr>
<td style=white-space:nowrap>Seccomp (v1.19+)</td>
<td>
<p>Seccomp profile must be explicitly set to one of the allowed values. Both the <code>Unconfined</code> profile and the <em>absence</em> of a profile are prohibited.</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.securityContext.seccompProfile.type</code></li>
<li><code>spec.containers[*].securityContext.seccompProfile.type</code></li>
<li><code>spec.initContainers[*].securityContext.seccompProfile.type</code></li>
<li><code>spec.ephemeralContainers[*].securityContext.seccompProfile.type</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li><code>RuntimeDefault</code></li>
<li><code>Localhost</code></li>
</ul>
<small>
The container fields may be undefined/<code>nil</code> if the pod-level
<code>spec.securityContext.seccompProfile.type</code> field is set appropriately.
Conversely, the pod-level field may be undefined/<code>nil</code> if _all_ container-
level fields are set.
</small>
</td>
</tr>
<tr>
<td style=white-space:nowrap>Capabilities (v1.22+)</td>
<td>
<p>
Containers must drop <code>ALL</code> capabilities, and are only permitted to add back
the <code>NET_BIND_SERVICE</code> capability.
</p>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.containers[*].securityContext.capabilities.drop</code></li>
<li><code>spec.initContainers[*].securityContext.capabilities.drop</code></li>
<li><code>spec.ephemeralContainers[*].securityContext.capabilities.drop</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li>Any list of capabilities that includes <code>ALL</code></li>
</ul>
<hr>
<p><strong>Restricted Fields</strong></p>
<ul>
<li><code>spec.containers[*].securityContext.capabilities.add</code></li>
<li><code>spec.initContainers[*].securityContext.capabilities.add</code></li>
<li><code>spec.ephemeralContainers[*].securityContext.capabilities.add</code></li>
</ul>
<p><strong>Allowed Values</strong></p>
<ul>
<li>Undefined/nil</li>
<li><code>NET_BIND_SERVICE</code></li>
</ul>
</td>
</tr>
</tbody>
</table>
<h2 id=policy-instantiation>Policy Instantiation</h2>
<p>Decoupling policy definition from policy instantiation allows for a common understanding and
consistent language of policies across clusters, independent of the underlying enforcement
mechanism.</p>
<p>As mechanisms mature, they will be defined below on a per-policy basis. The methods of enforcement
of individual policies are not defined here.</p>
<p><a href=/docs/concepts/security/pod-security-admission/><strong>Pod Security Admission Controller</strong></a></p>
<ul>
<li>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/security/podsecurity-privileged.yaml download=security/podsecurity-privileged.yaml>Privileged namespace</a>
</li>
<li>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/security/podsecurity-baseline.yaml download=security/podsecurity-baseline.yaml>Baseline namespace</a>
</li>
<li>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/security/podsecurity-restricted.yaml download=security/podsecurity-restricted.yaml>Restricted namespace</a>
</li>
</ul>
<p><a href=/docs/concepts/security/pod-security-policy/><strong>PodSecurityPolicy</strong></a> (Deprecated)</p>
<ul>
<li>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/policy/privileged-psp.yaml download=policy/privileged-psp.yaml>Privileged</a>
</li>
<li>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/policy/baseline-psp.yaml download=policy/baseline-psp.yaml>Baseline</a>
</li>
<li>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/policy/restricted-psp.yaml download=policy/restricted-psp.yaml>Restricted</a>
</li>
</ul>
<h2 id=faq>FAQ</h2>
<h3 id=why-isn-t-there-a-profile-between-privileged-and-baseline>Why isn't there a profile between privileged and baseline?</h3>
<p>The three profiles defined here have a clear linear progression from most secure (restricted) to least
secure (privileged), and cover a broad set of workloads. Privileges required above the baseline
policy are typically very application specific, so we do not offer a standard profile in this
niche. This is not to say that the privileged profile should always be used in this case, but that
policies in this space need to be defined on a case-by-case basis.</p>
<p>SIG Auth may reconsider this position in the future, should a clear need for other profiles arise.</p>
<h3 id=what-s-the-difference-between-a-security-profile-and-a-security-context>What's the difference between a security profile and a security context?</h3>
<p><a href=/docs/tasks/configure-pod-container/security-context/>Security Contexts</a> configure Pods and
Containers at runtime. Security contexts are defined as part of the Pod and container specifications
in the Pod manifest, and represent parameters to the container runtime.</p>
<p>Security profiles are control plane mechanisms to enforce specific settings in the Security Context,
as well as other related parameters outside the Security Context. As of July 2021,
<a href=/docs/concepts/security/pod-security-policy/>Pod Security Policies</a> are deprecated in favor of the
built-in <a href=/docs/concepts/security/pod-security-admission/>Pod Security Admission Controller</a>.</p>
<div class="alert alert-secondary callout third-party-content" role=alert><strong>Note:</strong>
This section links to third party projects that provide functionality required by Kubernetes. The Kubernetes project authors aren't responsible for these projects, which are listed alphabetically. To add a project to this list, read the <a href=/docs/contribute/style/content-guide/#third-party-content>content guide</a> before submitting a change. <a href=#third-party-content-disclaimer>More information.</a></div>
<p>Other alternatives for enforcing security profiles are being developed in the Kubernetes
ecosystem, such as:</p>
<ul>
<li><a href=https://github.com/open-policy-agent/gatekeeper>OPA Gatekeeper</a>.</li>
<li><a href=https://github.com/kubewarden>Kubewarden</a>.</li>
<li><a href=https://kyverno.io/policies/pod-security/>Kyverno</a>.</li>
</ul>
<h3 id=what-profiles-should-i-apply-to-my-windows-pods>What profiles should I apply to my Windows Pods?</h3>
<p>Windows in Kubernetes has some limitations and differentiators from standard Linux-based
workloads. Specifically, many of the Pod SecurityContext fields <a href=/docs/setup/production-environment/windows/intro-windows-in-kubernetes/#v1-podsecuritycontext>have no effect on
Windows</a>. As
such, no standardized Pod Security profiles currently exist.</p>
<p>If you apply the restricted profile for a Windows pod, this <strong>may</strong> have an impact on the pod
at runtime. The restricted profile requires enforcing Linux-specific restrictions (such as seccomp
profile, and disallowing privilege escalation). If the kubelet and / or its container runtime ignore
these Linux-specific values, then the Windows pod should still work normally within the restricted
profile. However, the lack of enforcement means that there is no additional restriction, for Pods
that use Windows containers, compared to the baseline profile.</p>
<p>The use of the HostProcess flag to create a HostProcess pod should only be done in alignment with the privileged policy. Creation of a Windows HostProcess pod is blocked under the baseline and restricted policies, so any HostProcess pod should be considered privileged.</p>
<h3 id=what-about-sandboxed-pods>What about sandboxed Pods?</h3>
<p>There is not currently an API standard that controls whether a Pod is considered sandboxed or
not. Sandbox Pods may be identified by the use of a sandboxed runtime (such as gVisor or Kata
Containers), but there is no standard definition of what a sandboxed runtime is.</p>
<p>The protections necessary for sandboxed workloads can differ from others. For example, the need to
restrict privileged permissions is lessened when the workload is isolated from the underlying
kernel. This allows for workloads requiring heightened permissions to still be isolated.</p>
<p>Additionally, the protection of sandboxed workloads is highly dependent on the method of
sandboxing. As such, no single recommended profile is recommended for all sandboxed workloads.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-bc9934fccfeaf880eec6ea79025c0381>3 - Pod Security Admission</h1>
<div class=lead>An overview of the Pod Security Admission Controller, which can enforce the Pod Security Standards.</div>
<div style=margin-top:10px;margin-bottom:10px>
<b>FEATURE STATE:</b> <code>Kubernetes v1.23 [beta]</code>
</div>
<p>The Kubernetes <a href=/docs/concepts/security/pod-security-standards/>Pod Security Standards</a> define
different isolation levels for Pods. These standards let you define how you want to restrict the
behavior of pods in a clear, consistent fashion.</p>
<p>As a Beta feature, Kubernetes offers a built-in <em>Pod Security</em> <a class=glossary-tooltip title="A piece of code that intercepts requests to the Kubernetes API server prior to persistence of the object." data-toggle=tooltip data-placement=top href=/docs/reference/access-authn-authz/admission-controllers/ target=_blank aria-label="admission controller">admission controller</a>, the successor
to <a href=/docs/concepts/security/pod-security-policy/>PodSecurityPolicies</a>. Pod security restrictions
are applied at the <a class=glossary-tooltip title="An abstraction used by Kubernetes to support isolation of groups of resources within a single cluster." data-toggle=tooltip data-placement=top href=/docs/concepts/overview/working-with-objects/namespaces target=_blank aria-label=namespace>namespace</a> level when pods
are created.</p>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> The PodSecurityPolicy API is deprecated and will be
<a href=/docs/reference/using-api/deprecation-guide/#v1-25>removed</a> from Kubernetes in v1.25.
</div>
<h2 id=enabling-the-podsecurity-admission-plugin>Enabling the <code>PodSecurity</code> admission plugin</h2>
<p>In v1.23, the <code>PodSecurity</code> <a href=/docs/reference/command-line-tools-reference/feature-gates/>feature gate</a>
is a Beta feature and is enabled by default.</p>
<p>In v1.22, the <code>PodSecurity</code> <a href=/docs/reference/command-line-tools-reference/feature-gates/>feature gate</a>
is an Alpha feature and must be enabled in <code>kube-apiserver</code> in order to use the built-in admission plugin.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>--feature-gates<span style=color:#666>=</span><span style=color:#b44>&#34;...,PodSecurity=true&#34;</span>
</code></pre></div><h2 id=webhook>Alternative: installing the <code>PodSecurity</code> admission webhook</h2>
<p>For environments where the built-in <code>PodSecurity</code> admission plugin cannot be used,
either because the cluster is older than v1.22, or the <code>PodSecurity</code> feature cannot be enabled,
the <code>PodSecurity</code> admission logic is also available as a Beta <a href=https://git.k8s.io/pod-security-admission/webhook>validating admission webhook</a>.</p>
<p>A pre-built container image, certificate generation scripts, and example manifests
are available at <a href=https://git.k8s.io/pod-security-admission/webhook>https://git.k8s.io/pod-security-admission/webhook</a>.</p>
<p>To install:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/kubernetes/pod-security-admission.git
<span style=color:#a2f>cd</span> pod-security-admission/webhook
make certs
kubectl apply -k .
</code></pre></div><div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> The generated certificate is valid for 2 years. Before it expires,
regenerate the certificate or remove the webhook in favor of the built-in admission plugin.
</div>
<h2 id=pod-security-levels>Pod Security levels</h2>
<p>Pod Security admission places requirements on a Pod's <a href=/docs/tasks/configure-pod-container/security-context/>Security
Context</a> and other related fields according
to the three levels defined by the <a href=/docs/concepts/security/pod-security-standards>Pod Security
Standards</a>: <code>privileged</code>, <code>baseline</code>, and
<code>restricted</code>. Refer to the <a href=/docs/concepts/security/pod-security-standards>Pod Security Standards</a>
page for an in-depth look at those requirements.</p>
<h2 id=pod-security-admission-labels-for-namespaces>Pod Security Admission labels for namespaces</h2>
<p>Once the feature is enabled or the webhook is installed, you can configure namespaces to define the admission
control mode you want to use for pod security in each namespace. Kubernetes defines a set of
<a class=glossary-tooltip title="Tags objects with identifying attributes that are meaningful and relevant to users." data-toggle=tooltip data-placement=top href=/docs/concepts/overview/working-with-objects/labels target=_blank aria-label=labels>labels</a> that you can set to define which of the
predefined Pod Security Standard levels you want to use for a namespace. The label you select
defines what action the <a class=glossary-tooltip title="The container orchestration layer that exposes the API and interfaces to define, deploy, and manage the lifecycle of containers." data-toggle=tooltip data-placement=top href="/docs/reference/glossary/?all=true#term-control-plane" target=_blank aria-label="control plane">control plane</a>
takes if a potential violation is detected:</p>
<table><caption style=display:none>Pod Security Admission modes</caption>
<thead>
<tr>
<th style=text-align:left>Mode</th>
<th style=text-align:left>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left><strong>enforce</strong></td>
<td style=text-align:left>Policy violations will cause the pod to be rejected.</td>
</tr>
<tr>
<td style=text-align:left><strong>audit</strong></td>
<td style=text-align:left>Policy violations will trigger the addition of an audit annotation to the event recorded in the <a href=/docs/tasks/debug/debug-cluster/audit/>audit log</a>, but are otherwise allowed.</td>
</tr>
<tr>
<td style=text-align:left><strong>warn</strong></td>
<td style=text-align:left>Policy violations will trigger a user-facing warning, but are otherwise allowed.</td>
</tr>
</tbody>
</table>
<p>A namespace can configure any or all modes, or even set a different level for different modes.</p>
<p>For each mode, there are two labels that determine the policy used:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#080;font-style:italic># The per-mode level label indicates which policy level to apply for the mode.</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># MODE must be one of `enforce`, `audit`, or `warn`.</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># LEVEL must be one of `privileged`, `baseline`, or `restricted`.</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>pod-security.kubernetes.io/&lt;MODE&gt;</span>:<span style=color:#bbb> </span>&lt;LEVEL&gt;<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># Optional: per-mode version label that can be used to pin the policy to the</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># version that shipped with a given Kubernetes minor version (for example v1.23).</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># MODE must be one of `enforce`, `audit`, or `warn`.</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># VERSION must be a valid Kubernetes minor version, or `latest`.</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>pod-security.kubernetes.io/&lt;MODE&gt;-version</span>:<span style=color:#bbb> </span>&lt;VERSION&gt;<span style=color:#bbb>
</span></code></pre></div><p>Check out <a href=/docs/tasks/configure-pod-container/enforce-standards-namespace-labels>Enforce Pod Security Standards with Namespace Labels</a> to see example usage.</p>
<h2 id=workload-resources-and-pod-templates>Workload resources and Pod templates</h2>
<p>Pods are often created indirectly, by creating a <a href=/docs/concepts/workloads/controllers/>workload
object</a> such as a <a class=glossary-tooltip title="Manages a replicated application on your cluster." data-toggle=tooltip data-placement=top href=/docs/concepts/workloads/controllers/deployment/ target=_blank aria-label=Deployment>Deployment</a> or <a class=glossary-tooltip title="A finite or batch task that runs to completion." data-toggle=tooltip data-placement=top href=/docs/concepts/workloads/controllers/job/ target=_blank aria-label=Job>Job</a>. The workload object defines a
<em>Pod template</em> and a <a class=glossary-tooltip title="A control loop that watches the shared state of the cluster through the apiserver and makes changes attempting to move the current state towards the desired state." data-toggle=tooltip data-placement=top href=/docs/concepts/architecture/controller/ target=_blank aria-label=controller>controller</a> for the
workload resource creates Pods based on that template. To help catch violations early, both the
audit and warning modes are applied to the workload resources. However, enforce mode is <strong>not</strong>
applied to workload resources, only to the resulting pod objects.</p>
<h2 id=exemptions>Exemptions</h2>
<p>You can define <em>exemptions</em> from pod security enforcement in order to allow the creation of pods that
would have otherwise been prohibited due to the policy associated with a given namespace.
Exemptions can be statically configured in the
<a href=/docs/tasks/configure-pod-container/enforce-standards-admission-controller/#configure-the-admission-controller>Admission Controller configuration</a>.</p>
<p>Exemptions must be explicitly enumerated. Requests meeting exemption criteria are <em>ignored</em> by the
Admission Controller (all <code>enforce</code>, <code>audit</code> and <code>warn</code> behaviors are skipped). Exemption dimensions include:</p>
<ul>
<li><strong>Usernames:</strong> requests from users with an exempt authenticated (or impersonated) username are
ignored.</li>
<li><strong>RuntimeClassNames:</strong> pods and <a href=#workload-resources-and-pod-templates>workload resources</a> specifying an exempt runtime class name are
ignored.</li>
<li><strong>Namespaces:</strong> pods and <a href=#workload-resources-and-pod-templates>workload resources</a> in an exempt namespace are ignored.</li>
</ul>
<div class="alert alert-warning caution callout" role=alert>
<strong>Caution:</strong> Most pods are created by a controller in response to a <a href=#workload-resources-and-pod-templates>workload
resource</a>, meaning that exempting an end user will only
exempt them from enforcement when creating pods directly, but not when creating a workload resource.
Controller service accounts (such as <code>system:serviceaccount:kube-system:replicaset-controller</code>)
should generally not be exempted, as doing so would implicitly exempt any user that can create the
corresponding workload resource.
</div>
<p>Updates to the following pod fields are exempt from policy checks, meaning that if a pod update
request only changes these fields, it will not be denied even if the pod is in violation of the
current policy level:</p>
<ul>
<li>Any metadata updates <strong>except</strong> changes to the seccomp or AppArmor annotations:
<ul>
<li><code>seccomp.security.alpha.kubernetes.io/pod</code> (deprecated)</li>
<li><code>container.seccomp.security.alpha.kubernetes.io/*</code> (deprecated)</li>
<li><code>container.apparmor.security.beta.kubernetes.io/*</code></li>
</ul>
</li>
<li>Valid updates to <code>.spec.activeDeadlineSeconds</code></li>
<li>Valid updates to <code>.spec.tolerations</code></li>
</ul>
<h2 id=what-s-next>What's next</h2>
<ul>
<li><a href=/docs/concepts/security/pod-security-standards>Pod Security Standards</a></li>
<li><a href=/docs/setup/best-practices/enforcing-pod-security-standards>Enforcing Pod Security Standards</a></li>
<li><a href=/docs/tasks/configure-pod-container/enforce-standards-admission-controller>Enforce Pod Security Standards by Configuring the Built-in Admission Controller</a></li>
<li><a href=/docs/tasks/configure-pod-container/enforce-standards-namespace-labels>Enforce Pod Security Standards with Namespace Labels</a></li>
<li><a href=/docs/tasks/configure-pod-container/migrate-from-psp>Migrate from PodSecurityPolicy to the Built-In PodSecurity Admission Controller</a></li>
</ul>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-ac71855bb20cbf21edc666e810f4103a>4 - Pod Security Policies</h1>
<div style=margin-top:10px;margin-bottom:10px>
<b>FEATURE STATE:</b> <code>Kubernetes v1.21 [deprecated]</code>
</div>
<div class="alert alert-warning caution callout" role=alert>
<strong>Caution:</strong> PodSecurityPolicy is deprecated as of Kubernetes v1.21, and <strong>will be removed in v1.25</strong>. We recommend migrating to
<a href=/docs/concepts/security/pod-security-admission/>Pod Security Admission</a>, or a 3rd party admission plugin.
For a migration guide, see <a href=/docs/tasks/configure-pod-container/migrate-from-psp/>Migrate from PodSecurityPolicy to the Built-In PodSecurity Admission Controller</a>.
For more information on the deprecation,
see <a href=/blog/2021/04/06/podsecuritypolicy-deprecation-past-present-and-future/>PodSecurityPolicy Deprecation: Past, Present, and Future</a>.
</div>
<p>Pod Security Policies enable fine-grained authorization of pod creation and
updates.</p>
<h2 id=what-is-a-pod-security-policy>What is a Pod Security Policy?</h2>
<p>A <em>Pod Security Policy</em> is a cluster-level resource that controls security
sensitive aspects of the pod specification. The
<a href=/docs/reference/generated/kubernetes-api/v1.23/#podsecuritypolicy-v1beta1-policy>PodSecurityPolicy</a> objects
define a set of conditions that a pod must run with in order to be accepted into
the system, as well as defaults for the related fields. They allow an
administrator to control the following:</p>
<table>
<thead>
<tr>
<th>Control Aspect</th>
<th>Field Names</th>
</tr>
</thead>
<tbody>
<tr>
<td>Running of privileged containers</td>
<td><a href=#privileged><code>privileged</code></a></td>
</tr>
<tr>
<td>Usage of host namespaces</td>
<td><a href=#host-namespaces><code>hostPID</code>, <code>hostIPC</code></a></td>
</tr>
<tr>
<td>Usage of host networking and ports</td>
<td><a href=#host-namespaces><code>hostNetwork</code>, <code>hostPorts</code></a></td>
</tr>
<tr>
<td>Usage of volume types</td>
<td><a href=#volumes-and-file-systems><code>volumes</code></a></td>
</tr>
<tr>
<td>Usage of the host filesystem</td>
<td><a href=#volumes-and-file-systems><code>allowedHostPaths</code></a></td>
</tr>
<tr>
<td>Allow specific FlexVolume drivers</td>
<td><a href=#flexvolume-drivers><code>allowedFlexVolumes</code></a></td>
</tr>
<tr>
<td>Allocating an FSGroup that owns the pod's volumes</td>
<td><a href=#volumes-and-file-systems><code>fsGroup</code></a></td>
</tr>
<tr>
<td>Requiring the use of a read only root file system</td>
<td><a href=#volumes-and-file-systems><code>readOnlyRootFilesystem</code></a></td>
</tr>
<tr>
<td>The user and group IDs of the container</td>
<td><a href=#users-and-groups><code>runAsUser</code>, <code>runAsGroup</code>, <code>supplementalGroups</code></a></td>
</tr>
<tr>
<td>Restricting escalation to root privileges</td>
<td><a href=#privilege-escalation><code>allowPrivilegeEscalation</code>, <code>defaultAllowPrivilegeEscalation</code></a></td>
</tr>
<tr>
<td>Linux capabilities</td>
<td><a href=#capabilities><code>defaultAddCapabilities</code>, <code>requiredDropCapabilities</code>, <code>allowedCapabilities</code></a></td>
</tr>
<tr>
<td>The SELinux context of the container</td>
<td><a href=#selinux><code>seLinux</code></a></td>
</tr>
<tr>
<td>The Allowed Proc Mount types for the container</td>
<td><a href=#allowedprocmounttypes><code>allowedProcMountTypes</code></a></td>
</tr>
<tr>
<td>The AppArmor profile used by containers</td>
<td><a href=#apparmor>annotations</a></td>
</tr>
<tr>
<td>The seccomp profile used by containers</td>
<td><a href=#seccomp>annotations</a></td>
</tr>
<tr>
<td>The sysctl profile used by containers</td>
<td><a href=#sysctl><code>forbiddenSysctls</code>,<code>allowedUnsafeSysctls</code></a></td>
</tr>
</tbody>
</table>
<h2 id=enabling-pod-security-policies>Enabling Pod Security Policies</h2>
<p>Pod security policy control is implemented as an optional
<a href=/docs/reference/access-authn-authz/admission-controllers/#podsecuritypolicy>admission controller</a>.
PodSecurityPolicies are enforced by
<a href=/docs/reference/access-authn-authz/admission-controllers/#how-do-i-turn-on-an-admission-control-plug-in>enabling the admission controller</a>,
but doing so without authorizing any policies <strong>will prevent any pods from being created</strong> in the
cluster.</p>
<p>Since the pod security policy API (<code>policy/v1beta1/podsecuritypolicy</code>) is
enabled independently of the admission controller, for existing clusters it is
recommended that policies are added and authorized before enabling the admission
controller.</p>
<h2 id=authorizing-policies>Authorizing Policies</h2>
<p>When a PodSecurityPolicy resource is created, it does nothing. In order to use
it, the requesting user or target pod's
<a href=/docs/tasks/configure-pod-container/configure-service-account/>service account</a>
must be authorized to use the policy, by allowing the <code>use</code> verb on the policy.</p>
<p>Most Kubernetes pods are not created directly by users. Instead, they are
typically created indirectly as part of a
<a href=/docs/concepts/workloads/controllers/deployment/>Deployment</a>,
<a href=/docs/concepts/workloads/controllers/replicaset/>ReplicaSet</a>, or other
templated controller via the controller manager. Granting the controller access
to the policy would grant access for <em>all</em> pods created by that controller,
so the preferred method for authorizing policies is to grant access to the
pod's service account (see <a href=#run-another-pod>example</a>).</p>
<h3 id=via-rbac>Via RBAC</h3>
<p><a href=/docs/reference/access-authn-authz/rbac/>RBAC</a> is a standard Kubernetes
authorization mode, and can easily be used to authorize use of policies.</p>
<p>First, a <code>Role</code> or <code>ClusterRole</code> needs to grant access to <code>use</code> the desired
policies. The rules to grant access look like this:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io/v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ClusterRole<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>&lt;role name&gt;<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>rules</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>apiGroups</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#39;policy&#39;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>resources</span>:<span style=color:#bbb> </span>[<span style=color:#b44>&#39;podsecuritypolicies&#39;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>verbs</span>:<span style=color:#bbb>     </span>[<span style=color:#b44>&#39;use&#39;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>resourceNames</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- &lt;list of policies to authorize&gt;<span style=color:#bbb>
</span></code></pre></div><p>Then the <code>(Cluster)Role</code> is bound to the authorized user(s):</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io/v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ClusterRoleBinding<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>&lt;binding name&gt;<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>roleRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ClusterRole<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>&lt;role name&gt;<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>subjects</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># Authorize all service accounts in a namespace (recommended):</span><span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Group<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>system:serviceaccounts:&lt;authorized namespace&gt;<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># Authorize specific service accounts (not recommended):</span><span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ServiceAccount<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>&lt;authorized service account name&gt;<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>namespace</span>:<span style=color:#bbb> </span>&lt;authorized pod namespace&gt;<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># Authorize specific users (not recommended):</span><span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>User<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>&lt;authorized user name&gt;<span style=color:#bbb>
</span></code></pre></div><p>If a <code>RoleBinding</code> (not a <code>ClusterRoleBinding</code>) is used, it will only grant
usage for pods being run in the same namespace as the binding. This can be
paired with system groups to grant access to all pods run in the namespace:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#080;font-style:italic># Authorize all service accounts in a namespace:</span><span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Group<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>system:serviceaccounts<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># Or equivalently, all authenticated users in a namespace:</span><span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Group<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>system:authenticated<span style=color:#bbb>
</span></code></pre></div><p>For more examples of RBAC bindings, see
<a href=/docs/reference/access-authn-authz/rbac#role-binding-examples>RoleBinding examples</a>.
For a complete example of authorizing a PodSecurityPolicy, see <a href=#example>below</a>.</p>
<h3 id=recommended-practice>Recommended Practice</h3>
<p>PodSecurityPolicy is being replaced by a new, simplified <code>PodSecurity</code>
<a class=glossary-tooltip title="A piece of code that intercepts requests to the Kubernetes API server prior to persistence of the object." data-toggle=tooltip data-placement=top href=/docs/reference/access-authn-authz/admission-controllers/ target=_blank aria-label="admission controller">admission controller</a>.
For more details on this change, see
<a href=/blog/2021/04/06/podsecuritypolicy-deprecation-past-present-and-future/>PodSecurityPolicy Deprecation: Past, Present, and Future</a>.
Follow these guidelines to simplify migration from PodSecurityPolicy to the
new admission controller:</p>
<ol>
<li>
<p>Limit your PodSecurityPolicies to the policies defined by the
<a href=/docs/concepts/security/pod-security-standards>Pod Security Standards</a>:</p>
<ul>
<li>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/policy/privileged-psp.yaml download=policy/privileged-psp.yaml>Privileged</a>
</li>
<li>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/policy/baseline-psp.yaml download=policy/baseline-psp.yaml>Baseline</a>
</li>
<li>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/policy/restricted-psp.yaml download=policy/restricted-psp.yaml>Restricted</a>
</li>
</ul>
</li>
<li>
<p>Only bind PSPs to entire namespaces, by using the <code>system:serviceaccounts:&lt;namespace></code> group
(where <code>&lt;namespace></code> is the target namespace). For example:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io/v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-style:italic># This cluster role binding allows all pods in the &#34;development&#34; namespace to use the baseline PSP.</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ClusterRoleBinding<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>psp-baseline-namespaces<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>roleRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>ClusterRole<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>psp-baseline<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>subjects</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Group<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>system:serviceaccounts:development<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Group<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>system:serviceaccounts:canary<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span></code></pre></div></li>
</ol>
<h3 id=troubleshooting>Troubleshooting</h3>
<ul>
<li>
<p>The <a href=/docs/reference/command-line-tools-reference/kube-controller-manager/>controller manager</a>
must be run against the secured API port and must not have superuser permissions. See
<a href=/docs/concepts/security/controlling-access>Controlling Access to the Kubernetes API</a>
to learn about API server access controls.<br>
If the controller manager connected through the trusted API port (also known as the
<code>localhost</code> listener), requests would bypass authentication and authorization modules;
all PodSecurityPolicy objects would be allowed, and users would be able to create grant
themselves the ability to create privileged containers.</p>
<p>For more details on configuring controller manager authorization, see
<a href=/docs/reference/access-authn-authz/rbac/#controller-roles>Controller Roles</a>.</p>
</li>
</ul>
<h2 id=policy-order>Policy Order</h2>
<p>In addition to restricting pod creation and update, pod security policies can
also be used to provide default values for many of the fields that it
controls. When multiple policies are available, the pod security policy
controller selects policies according to the following criteria:</p>
<ol>
<li>PodSecurityPolicies which allow the pod as-is, without changing defaults or
mutating the pod, are preferred. The order of these non-mutating
PodSecurityPolicies doesn't matter.</li>
<li>If the pod must be defaulted or mutated, the first PodSecurityPolicy
(ordered by name) to allow the pod is selected.</li>
</ol>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> During update operations (during which mutations to pod specs are disallowed)
only non-mutating PodSecurityPolicies are used to validate the pod.
</div>
<h2 id=example>Example</h2>
<p>This example assumes you have a running cluster with the PodSecurityPolicy
admission controller enabled and you have cluster admin privileges.</p>
<h3 id=set-up>Set up</h3>
<p>Set up a namespace and a service account to act as for this example. We'll use
this service account to mock a non-admin user.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create namespace psp-example
kubectl create serviceaccount -n psp-example fake-user
kubectl create rolebinding -n psp-example fake-editor --clusterrole<span style=color:#666>=</span>edit --serviceaccount<span style=color:#666>=</span>psp-example:fake-user
</code></pre></div><p>To make it clear which user we're acting as and save some typing, create 2
aliases:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#a2f>alias</span> kubectl-admin<span style=color:#666>=</span><span style=color:#b44>&#39;kubectl -n psp-example&#39;</span>
<span style=color:#a2f>alias</span> kubectl-user<span style=color:#666>=</span><span style=color:#b44>&#39;kubectl --as=system:serviceaccount:psp-example:fake-user -n psp-example&#39;</span>
</code></pre></div><h3 id=create-a-policy-and-a-pod>Create a policy and a pod</h3>
<p>Define the example PodSecurityPolicy object in a file. This is a policy that
prevents the creation of privileged pods.
The name of a PodSecurityPolicy object must be a valid
<a href=/docs/concepts/overview/working-with-objects/names#dns-subdomain-names>DNS subdomain name</a>.</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/en/examples/policy/example-psp.yaml download=policy/example-psp.yaml><code>policy/example-psp.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('policy-example-psp-yaml')" title="Copy policy/example-psp.yaml to clipboard">
</img>
</div>
<div class=includecode id=policy-example-psp-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>policy/v1beta1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>PodSecurityPolicy<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>example<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>privileged</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># Don&#39;t allow privileged pods!</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># The rest fills in some required fields.</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>seLinux</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span>RunAsAny<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>supplementalGroups</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span>RunAsAny<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>runAsUser</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span>RunAsAny<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>fsGroup</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span>RunAsAny<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:#b44>&#39;*&#39;</span><span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<p>And create it with kubectl:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-admin create -f example-psp.yaml
</code></pre></div><p>Now, as the unprivileged user, try to create a simple pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user create -f- <span style=color:#b44>&lt;&lt;EOF
</span><span style=color:#b44>apiVersion: v1
</span><span style=color:#b44>kind: Pod
</span><span style=color:#b44>metadata:
</span><span style=color:#b44>  name: pause
</span><span style=color:#b44>spec:
</span><span style=color:#b44>  containers:
</span><span style=color:#b44>    - name: pause
</span><span style=color:#b44>      image: k8s.gcr.io/pause
</span><span style=color:#b44>EOF</span>
</code></pre></div><p>The output is similar to this:</p>
<pre><code>Error from server (Forbidden): error when creating &quot;STDIN&quot;: pods &quot;pause&quot; is forbidden: unable to validate against any pod security policy: []
</code></pre><p><strong>What happened?</strong> Although the PodSecurityPolicy was created, neither the
pod's service account nor <code>fake-user</code> have permission to use the new policy:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user auth can-i use podsecuritypolicy/example
no
</code></pre></div><p>Create the rolebinding to grant <code>fake-user</code> the <code>use</code> verb on the example
policy:</p>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> This is not the recommended way! See the <a href=#run-another-pod>next section</a>
for the preferred approach.
</div>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-admin create role psp:unprivileged <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>    --verb<span style=color:#666>=</span>use <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>    --resource<span style=color:#666>=</span>podsecuritypolicy <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>    --resource-name<span style=color:#666>=</span>example
role <span style=color:#b44>&#34;psp:unprivileged&#34;</span> created

kubectl-admin create rolebinding fake-user:psp:unprivileged <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>    --role<span style=color:#666>=</span>psp:unprivileged <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>    --serviceaccount<span style=color:#666>=</span>psp-example:fake-user
rolebinding <span style=color:#b44>&#34;fake-user:psp:unprivileged&#34;</span> created

kubectl-user auth can-i use podsecuritypolicy/example
yes
</code></pre></div><p>Now retry creating the pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user create -f- <span style=color:#b44>&lt;&lt;EOF
</span><span style=color:#b44>apiVersion: v1
</span><span style=color:#b44>kind: Pod
</span><span style=color:#b44>metadata:
</span><span style=color:#b44>  name: pause
</span><span style=color:#b44>spec:
</span><span style=color:#b44>  containers:
</span><span style=color:#b44>    - name: pause
</span><span style=color:#b44>      image: k8s.gcr.io/pause
</span><span style=color:#b44>EOF</span>
</code></pre></div><p>The output is similar to this</p>
<pre><code>pod &quot;pause&quot; created
</code></pre><p>It works as expected! But any attempts to create a privileged pod should still
be denied:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user create -f- <span style=color:#b44>&lt;&lt;EOF
</span><span style=color:#b44>apiVersion: v1
</span><span style=color:#b44>kind: Pod
</span><span style=color:#b44>metadata:
</span><span style=color:#b44>  name: privileged
</span><span style=color:#b44>spec:
</span><span style=color:#b44>  containers:
</span><span style=color:#b44>    - name: pause
</span><span style=color:#b44>      image: k8s.gcr.io/pause
</span><span style=color:#b44>      securityContext:
</span><span style=color:#b44>        privileged: true
</span><span style=color:#b44>EOF</span>
</code></pre></div><p>The output is similar to this:</p>
<pre><code>Error from server (Forbidden): error when creating &quot;STDIN&quot;: pods &quot;privileged&quot; is forbidden: unable to validate against any pod security policy: [spec.containers[0].securityContext.privileged: Invalid value: true: Privileged containers are not allowed]
</code></pre><p>Delete the pod before moving on:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user delete pod pause
</code></pre></div><h3 id=run-another-pod>Run another pod</h3>
<p>Let's try that again, slightly differently:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user create deployment pause --image<span style=color:#666>=</span>k8s.gcr.io/pause
</code></pre></div><pre><code class=language-none data-lang=none>deployment &quot;pause&quot; created
</code></pre><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user get pods
</code></pre></div><pre><code>No resources found.
</code></pre><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user get events | head -n <span style=color:#666>2</span>
</code></pre></div><pre><code>LASTSEEN   FIRSTSEEN   COUNT     NAME              KIND         SUBOBJECT                TYPE      REASON                  SOURCE                                  MESSAGE
1m         2m          15        pause-7774d79b5   ReplicaSet                            Warning   FailedCreate            replicaset-controller                   Error creating: pods &quot;pause-7774d79b5-&quot; is forbidden: no providers available to validate pod request
</code></pre><p><strong>What happened?</strong> We already bound the <code>psp:unprivileged</code> role for our <code>fake-user</code>,
why are we getting the error <code>Error creating: pods "pause-7774d79b5-" is forbidden: no providers available to validate pod request</code>? The answer lies in
the source - <code>replicaset-controller</code>. Fake-user successfully created the
deployment (which successfully created a replicaset), but when the replicaset
went to create the pod it was not authorized to use the example
podsecuritypolicy.</p>
<p>In order to fix this, bind the <code>psp:unprivileged</code> role to the pod's service
account instead. In this case (since we didn't specify it) the service account
is <code>default</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-admin create rolebinding default:psp:unprivileged <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>    --role<span style=color:#666>=</span>psp:unprivileged <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>    --serviceaccount<span style=color:#666>=</span>psp-example:default
</code></pre></div><pre><code class=language-none data-lang=none>rolebinding &quot;default:psp:unprivileged&quot; created
</code></pre><p>Now if you give it a minute to retry, the replicaset-controller should
eventually succeed in creating the pod:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-user get pods --watch
</code></pre></div><pre><code class=language-none data-lang=none>NAME                    READY     STATUS    RESTARTS   AGE
pause-7774d79b5-qrgcb   0/1       Pending   0         1s
pause-7774d79b5-qrgcb   0/1       Pending   0         1s
pause-7774d79b5-qrgcb   0/1       ContainerCreating   0         1s
pause-7774d79b5-qrgcb   1/1       Running   0         2s
</code></pre><h3 id=clean-up>Clean up</h3>
<p>Delete the namespace to clean up most of the example resources:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-admin delete ns psp-example
</code></pre></div><pre><code>namespace &quot;psp-example&quot; deleted
</code></pre><p>Note that <code>PodSecurityPolicy</code> resources are not namespaced, and must be cleaned
up separately:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl-admin delete psp example
</code></pre></div><pre><code>podsecuritypolicy &quot;example&quot; deleted
</code></pre><h3 id=example-policies>Example Policies</h3>
<p>This is the least restrictive policy you can create, equivalent to not using the
pod security policy admission controller:</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/en/examples/policy/privileged-psp.yaml download=policy/privileged-psp.yaml><code>policy/privileged-psp.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('policy-privileged-psp-yaml')" title="Copy policy/privileged-psp.yaml to clipboard">
</img>
</div>
<div class=includecode id=policy-privileged-psp-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>policy/v1beta1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>PodSecurityPolicy<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>privileged<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>seccomp.security.alpha.kubernetes.io/allowedProfileNames</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;*&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>privileged</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>allowPrivilegeEscalation</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>allowedCapabilities</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:#b44>&#39;*&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:#b44>&#39;*&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostNetwork</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostPorts</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>min</span>:<span style=color:#bbb> </span><span style=color:#666>0</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>max</span>:<span style=color:#bbb> </span><span style=color:#666>65535</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostIPC</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostPID</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>runAsUser</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;RunAsAny&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>seLinux</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;RunAsAny&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>supplementalGroups</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;RunAsAny&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>fsGroup</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;RunAsAny&#39;</span><span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<p>This is an example of a restrictive policy that requires users to run as an
unprivileged user, blocks possible escalations to root, and requires use of
several security mechanisms.</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/release-1.23/content/en/examples/policy/restricted-psp.yaml download=policy/restricted-psp.yaml><code>policy/restricted-psp.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('policy-restricted-psp-yaml')" title="Copy policy/restricted-psp.yaml to clipboard">
</img>
</div>
<div class=includecode id=policy-restricted-psp-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>policy/v1beta1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>PodSecurityPolicy<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>restricted<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># docker/default identifies a profile for seccomp, but it is not particularly tied to the Docker runtime</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>seccomp.security.alpha.kubernetes.io/allowedProfileNames</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;docker/default,runtime/default&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>apparmor.security.beta.kubernetes.io/allowedProfileNames</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;runtime/default&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>apparmor.security.beta.kubernetes.io/defaultProfileName</span>:<span style=color:#bbb>  </span><span style=color:#b44>&#39;runtime/default&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>privileged</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># Required to prevent escalations to root.</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>allowPrivilegeEscalation</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>requiredDropCapabilities</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- ALL<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># Allow core volume types.</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;configMap&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;emptyDir&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;projected&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;secret&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;downwardAPI&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Assume that ephemeral CSI drivers &amp; persistentVolumes set up by the cluster admin are safe to use.</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;csi&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;persistentVolumeClaim&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#39;ephemeral&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostNetwork</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostIPC</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>hostPID</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>runAsUser</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Require the container to run without root privileges.</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;MustRunAsNonRoot&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>seLinux</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># This policy assumes the nodes are using AppArmor rather than SELinux.</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;RunAsAny&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>supplementalGroups</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;MustRunAs&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>ranges</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># Forbid adding the root group.</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>min</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>max</span>:<span style=color:#bbb> </span><span style=color:#666>65535</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>fsGroup</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>rule</span>:<span style=color:#bbb> </span><span style=color:#b44>&#39;MustRunAs&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>ranges</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#080;font-style:italic># Forbid adding the root group.</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>min</span>:<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>max</span>:<span style=color:#bbb> </span><span style=color:#666>65535</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>readOnlyRootFilesystem</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span><span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<p>See <a href=/docs/concepts/security/pod-security-standards/#policy-instantiation>Pod Security Standards</a>
for more examples.</p>
<h2 id=policy-reference>Policy Reference</h2>
<h3 id=privileged>Privileged</h3>
<p><strong>Privileged</strong> - determines if any container in a pod can enable privileged mode.
By default a container is not allowed to access any devices on the host, but a
"privileged" container is given access to all devices on the host. This allows
the container nearly all the same access as processes running on the host.
This is useful for containers that want to use linux capabilities like
manipulating the network stack and accessing devices.</p>
<h3 id=host-namespaces>Host namespaces</h3>
<p><strong>HostPID</strong> - Controls whether the pod containers can share the host process ID
namespace. Note that when paired with ptrace this can be used to escalate
privileges outside of the container (ptrace is forbidden by default).</p>
<p><strong>HostIPC</strong> - Controls whether the pod containers can share the host IPC
namespace.</p>
<p><strong>HostNetwork</strong> - Controls whether the pod may use the node network
namespace. Doing so gives the pod access to the loopback device, services
listening on localhost, and could be used to snoop on network activity of other
pods on the same node.</p>
<p><strong>HostPorts</strong> - Provides a list of ranges of allowable ports in the host
network namespace. Defined as a list of <code>HostPortRange</code>, with <code>min</code>(inclusive)
and <code>max</code>(inclusive). Defaults to no allowed host ports.</p>
<h3 id=volumes-and-file-systems>Volumes and file systems</h3>
<p><strong>Volumes</strong> - Provides a list of allowed volume types. The allowable values
correspond to the volume sources that are defined when creating a volume. For
the complete list of volume types, see <a href=/docs/concepts/storage/volumes/#types-of-volumes>Types of
Volumes</a>. Additionally,
<code>*</code> may be used to allow all volume types.</p>
<p>The <strong>recommended minimum set</strong> of allowed volumes for new PSPs are:</p>
<ul>
<li><code>configMap</code></li>
<li><code>downwardAPI</code></li>
<li><code>emptyDir</code></li>
<li><code>persistentVolumeClaim</code></li>
<li><code>secret</code></li>
<li><code>projected</code></li>
</ul>
<div class="alert alert-danger warning callout" role=alert>
<strong>Warning:</strong> PodSecurityPolicy does not limit the types of <code>PersistentVolume</code> objects that
may be referenced by a <code>PersistentVolumeClaim</code>, and hostPath type
<code>PersistentVolumes</code> do not support read-only access mode. Only trusted users
should be granted permission to create <code>PersistentVolume</code> objects.
</div>
<p><strong>FSGroup</strong> - Controls the supplemental group applied to some volumes.</p>
<ul>
<li><em>MustRunAs</em> - Requires at least one <code>range</code> to be specified. Uses the
minimum value of the first range as the default. Validates against all ranges.</li>
<li><em>MayRunAs</em> - Requires at least one <code>range</code> to be specified. Allows
<code>FSGroups</code> to be left unset without providing a default. Validates against
all ranges if <code>FSGroups</code> is set.</li>
<li><em>RunAsAny</em> - No default provided. Allows any <code>fsGroup</code> ID to be specified.</li>
</ul>
<p><strong>AllowedHostPaths</strong> - This specifies a list of host paths that are allowed
to be used by hostPath volumes. An empty list means there is no restriction on
host paths used. This is defined as a list of objects with a single <code>pathPrefix</code>
field, which allows hostPath volumes to mount a path that begins with an
allowed prefix, and a <code>readOnly</code> field indicating it must be mounted read-only.
For example:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#bbb>  </span><span style=color:green;font-weight:700>allowedHostPaths</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># This allows &#34;/foo&#34;, &#34;/foo/&#34;, &#34;/foo/bar&#34; etc., but</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># disallows &#34;/fool&#34;, &#34;/etc/foo&#34; etc.</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># &#34;/foo/../&#34; is never valid.</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>pathPrefix</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;/foo&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>readOnly</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic># only allow read-only mounts</span><span style=color:#bbb>
</span></code></pre></div><div class="alert alert-danger warning callout" role=alert>
<strong>Warning:</strong> <p>There are many ways a container with unrestricted access to the host
filesystem can escalate privileges, including reading data from other
containers, and abusing the credentials of system services, such as Kubelet.</p>
<p>Writeable hostPath directory volumes allow containers to write
to the filesystem in ways that let them traverse the host filesystem outside the <code>pathPrefix</code>.
<code>readOnly: true</code>, available in Kubernetes 1.11+, must be used on <strong>all</strong> <code>allowedHostPaths</code>
to effectively limit access to the specified <code>pathPrefix</code>.</p>
</div>
<p><strong>ReadOnlyRootFilesystem</strong> - Requires that containers must run with a read-only
root filesystem (i.e. no writable layer).</p>
<h3 id=flexvolume-drivers>FlexVolume drivers</h3>
<p>This specifies a list of FlexVolume drivers that are allowed to be used
by flexvolume. An empty list or nil means there is no restriction on the drivers.
Please make sure <a href=#volumes-and-file-systems><code>volumes</code></a> field contains the
<code>flexVolume</code> volume type; no FlexVolume driver is allowed otherwise.</p>
<p>For example:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>policy/v1beta1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>PodSecurityPolicy<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>allow-flex-volumes<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-style:italic># ... other spec fields</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>volumes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- flexVolume<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>allowedFlexVolumes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>driver</span>:<span style=color:#bbb> </span>example/lvm<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:green;font-weight:700>driver</span>:<span style=color:#bbb> </span>example/cifs<span style=color:#bbb>
</span></code></pre></div><h3 id=users-and-groups>Users and groups</h3>
<p><strong>RunAsUser</strong> - Controls which user ID the containers are run with.</p>
<ul>
<li><em>MustRunAs</em> - Requires at least one <code>range</code> to be specified. Uses the
minimum value of the first range as the default. Validates against all ranges.</li>
<li><em>MustRunAsNonRoot</em> - Requires that the pod be submitted with a non-zero
<code>runAsUser</code> or have the <code>USER</code> directive defined (using a numeric UID) in the
image. Pods which have specified neither <code>runAsNonRoot</code> nor <code>runAsUser</code> settings
will be mutated to set <code>runAsNonRoot=true</code>, thus requiring a defined non-zero
numeric <code>USER</code> directive in the container. No default provided. Setting
<code>allowPrivilegeEscalation=false</code> is strongly recommended with this strategy.</li>
<li><em>RunAsAny</em> - No default provided. Allows any <code>runAsUser</code> to be specified.</li>
</ul>
<p><strong>RunAsGroup</strong> - Controls which primary group ID the containers are run with.</p>
<ul>
<li><em>MustRunAs</em> - Requires at least one <code>range</code> to be specified. Uses the
minimum value of the first range as the default. Validates against all ranges.</li>
<li><em>MayRunAs</em> - Does not require that RunAsGroup be specified. However, when RunAsGroup
is specified, they have to fall in the defined range.</li>
<li><em>RunAsAny</em> - No default provided. Allows any <code>runAsGroup</code> to be specified.</li>
</ul>
<p><strong>SupplementalGroups</strong> - Controls which group IDs containers add.</p>
<ul>
<li><em>MustRunAs</em> - Requires at least one <code>range</code> to be specified. Uses the
minimum value of the first range as the default. Validates against all ranges.</li>
<li><em>MayRunAs</em> - Requires at least one <code>range</code> to be specified. Allows
<code>supplementalGroups</code> to be left unset without providing a default.
Validates against all ranges if <code>supplementalGroups</code> is set.</li>
<li><em>RunAsAny</em> - No default provided. Allows any <code>supplementalGroups</code> to be
specified.</li>
</ul>
<h3 id=privilege-escalation>Privilege Escalation</h3>
<p>These options control the <code>allowPrivilegeEscalation</code> container option. This bool
directly controls whether the
<a href=https://www.kernel.org/doc/Documentation/prctl/no_new_privs.txt><code>no_new_privs</code></a>
flag gets set on the container process. This flag will prevent <code>setuid</code> binaries
from changing the effective user ID, and prevent files from enabling extra
capabilities (e.g. it will prevent the use of the <code>ping</code> tool). This behavior is
required to effectively enforce <code>MustRunAsNonRoot</code>.</p>
<p><strong>AllowPrivilegeEscalation</strong> - Gates whether or not a user is allowed to set the
security context of a container to <code>allowPrivilegeEscalation=true</code>. This
defaults to allowed so as to not break setuid binaries. Setting it to <code>false</code>
ensures that no child process of a container can gain more privileges than its parent.</p>
<p><strong>DefaultAllowPrivilegeEscalation</strong> - Sets the default for the
<code>allowPrivilegeEscalation</code> option. The default behavior without this is to allow
privilege escalation so as to not break setuid binaries. If that behavior is not
desired, this field can be used to default to disallow, while still permitting
pods to request <code>allowPrivilegeEscalation</code> explicitly.</p>
<h3 id=capabilities>Capabilities</h3>
<p>Linux capabilities provide a finer grained breakdown of the privileges
traditionally associated with the superuser. Some of these capabilities can be
used to escalate privileges or for container breakout, and may be restricted by
the PodSecurityPolicy. For more details on Linux capabilities, see
<a href=http://man7.org/linux/man-pages/man7/capabilities.7.html>capabilities(7)</a>.</p>
<p>The following fields take a list of capabilities, specified as the capability
name in ALL_CAPS without the <code>CAP_</code> prefix.</p>
<p><strong>AllowedCapabilities</strong> - Provides a list of capabilities that are allowed to be added
to a container. The default set of capabilities are implicitly allowed. The
empty set means that no additional capabilities may be added beyond the default
set. <code>*</code> can be used to allow all capabilities.</p>
<p><strong>RequiredDropCapabilities</strong> - The capabilities which must be dropped from
containers. These capabilities are removed from the default set, and must not be
added. Capabilities listed in <code>RequiredDropCapabilities</code> must not be included in
<code>AllowedCapabilities</code> or <code>DefaultAddCapabilities</code>.</p>
<p><strong>DefaultAddCapabilities</strong> - The capabilities which are added to containers by
default, in addition to the runtime defaults. See the
the documentation for your container runtime for information on working with Linux capabilities.</p>
<h3 id=selinux>SELinux</h3>
<ul>
<li><em>MustRunAs</em> - Requires <code>seLinuxOptions</code> to be configured. Uses
<code>seLinuxOptions</code> as the default. Validates against <code>seLinuxOptions</code>.</li>
<li><em>RunAsAny</em> - No default provided. Allows any <code>seLinuxOptions</code> to be
specified.</li>
</ul>
<h3 id=allowedprocmounttypes>AllowedProcMountTypes</h3>
<p><code>allowedProcMountTypes</code> is a list of allowed ProcMountTypes.
Empty or nil indicates that only the <code>DefaultProcMountType</code> may be used.</p>
<p><code>DefaultProcMount</code> uses the container runtime defaults for readonly and masked
paths for /proc. Most container runtimes mask certain paths in /proc to avoid
accidental security exposure of special devices or information. This is denoted
as the string <code>Default</code>.</p>
<p>The only other ProcMountType is <code>UnmaskedProcMount</code>, which bypasses the
default masking behavior of the container runtime and ensures the newly
created /proc the container stays intact with no modifications. This is
denoted as the string <code>Unmasked</code>.</p>
<h3 id=apparmor>AppArmor</h3>
<p>Controlled via annotations on the PodSecurityPolicy. Refer to the
<a href=/docs/tutorials/security/apparmor/#podsecuritypolicy-annotations>AppArmor documentation</a>.</p>
<h3 id=seccomp>Seccomp</h3>
<p>As of Kubernetes v1.19, you can use the <code>seccompProfile</code> field in the
<code>securityContext</code> of Pods or containers to
<a href=/docs/tutorials/security/seccomp/>control use of seccomp profiles</a>.
In prior versions, seccomp was controlled by adding annotations to a Pod. The
same PodSecurityPolicies can be used with either version to enforce how these
fields or annotations are applied.</p>
<p><strong>seccomp.security.alpha.kubernetes.io/defaultProfileName</strong> - Annotation that
specifies the default seccomp profile to apply to containers. Possible values
are:</p>
<ul>
<li>
<p><code>unconfined</code> - Seccomp is not applied to the container processes (this is the
default in Kubernetes), if no alternative is provided.</p>
</li>
<li>
<p><code>runtime/default</code> - The default container runtime profile is used.</p>
</li>
<li>
<p><code>docker/default</code> - The Docker default seccomp profile is used. Deprecated as
of Kubernetes 1.11. Use <code>runtime/default</code> instead.</p>
</li>
<li>
<p><code>localhost/&lt;path></code> - Specify a profile as a file on the node located at
<code>&lt;seccomp_root>/&lt;path></code>, where <code>&lt;seccomp_root></code> is defined via the
<code>--seccomp-profile-root</code> flag on the Kubelet. If the <code>--seccomp-profile-root</code>
flag is not defined, the default path will be used, which is
<code>&lt;root-dir>/seccomp</code> where <code>&lt;root-dir></code> is specified by the <code>--root-dir</code> flag.</p>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> The <code>--seccomp-profile-root</code> flag is deprecated since Kubernetes
v1.19. Users are encouraged to use the default path.
</div>
</li>
</ul>
<p><strong>seccomp.security.alpha.kubernetes.io/allowedProfileNames</strong> - Annotation that
specifies which values are allowed for the pod seccomp annotations. Specified as
a comma-delimited list of allowed values. Possible values are those listed
above, plus <code>*</code> to allow all profiles. Absence of this annotation means that the
default cannot be changed.</p>
<h3 id=sysctl>Sysctl</h3>
<p>By default, all safe sysctls are allowed.</p>
<ul>
<li><code>forbiddenSysctls</code> - excludes specific sysctls. You can forbid a combination
of safe and unsafe sysctls in the list. To forbid setting any sysctls, use
<code>*</code> on its own.</li>
<li><code>allowedUnsafeSysctls</code> - allows specific sysctls that had been disallowed by
the default list, so long as these are not listed in <code>forbiddenSysctls</code>.</li>
</ul>
<p>Refer to the <a href=/docs/tasks/administer-cluster/sysctl-cluster/#podsecuritypolicy>Sysctl documentation</a>.</p>
<h2 id=what-s-next>What's next</h2>
<ul>
<li>
<p>See <a href=/blog/2021/04/06/podsecuritypolicy-deprecation-past-present-and-future/>PodSecurityPolicy Deprecation: Past, Present, and Future</a>
to learn about the future of pod security policy.</p>
</li>
<li>
<p>See <a href=/docs/concepts/security/pod-security-standards/>Pod Security Standards</a>
for policy recommendations.</p>
</li>
<li>
<p>Refer to <a href=/docs/reference/generated/kubernetes-api/v1.23/#podsecuritypolicy-v1beta1-policy>PodSecurityPolicy reference</a>
for the API details.</p>
</li>
</ul>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-4d77d1ae4c06aa14f54b385191627881>5 - Controlling Access to the Kubernetes API</h1>
<p>This page provides an overview of controlling access to the Kubernetes API.</p>
<p>Users access the <a href=/docs/concepts/overview/kubernetes-api/>Kubernetes API</a> using <code>kubectl</code>,
client libraries, or by making REST requests. Both human users and
<a href=/docs/tasks/configure-pod-container/configure-service-account/>Kubernetes service accounts</a> can be
authorized for API access.
When a request reaches the API, it goes through several stages, illustrated in the
following diagram:</p>
<p><img src=/images/docs/admin/access-control-overview.svg alt="Diagram of request handling steps for Kubernetes API request"></p>
<h2 id=transport-security>Transport security</h2>
<p>In a typical Kubernetes cluster, the API serves on port 443, protected by TLS.
The API server presents a certificate. This certificate may be signed using
a private certificate authority (CA), or based on a public key infrastructure linked
to a generally recognized CA.</p>
<p>If your cluster uses a private certificate authority, you need a copy of that CA
certificate configured into your <code>~/.kube/config</code> on the client, so that you can
trust the connection and be confident it was not intercepted.</p>
<p>Your client can present a TLS client certificate at this stage.</p>
<h2 id=authentication>Authentication</h2>
<p>Once TLS is established, the HTTP request moves to the Authentication step.
This is shown as step <strong>1</strong> in the diagram.
The cluster creation script or cluster admin configures the API server to run
one or more Authenticator modules.
Authenticators are described in more detail in
<a href=/docs/reference/access-authn-authz/authentication/>Authentication</a>.</p>
<p>The input to the authentication step is the entire HTTP request; however, it typically
examines the headers and/or client certificate.</p>
<p>Authentication modules include client certificates, password, and plain tokens,
bootstrap tokens, and JSON Web Tokens (used for service accounts).</p>
<p>Multiple authentication modules can be specified, in which case each one is tried in sequence,
until one of them succeeds.</p>
<p>If the request cannot be authenticated, it is rejected with HTTP status code 401.
Otherwise, the user is authenticated as a specific <code>username</code>, and the user name
is available to subsequent steps to use in their decisions. Some authenticators
also provide the group memberships of the user, while other authenticators
do not.</p>
<p>While Kubernetes uses usernames for access control decisions and in request logging,
it does not have a <code>User</code> object nor does it store usernames or other information about
users in its API.</p>
<h2 id=authorization>Authorization</h2>
<p>After the request is authenticated as coming from a specific user, the request must be authorized. This is shown as step <strong>2</strong> in the diagram.</p>
<p>A request must include the username of the requester, the requested action, and the object affected by the action. The request is authorized if an existing policy declares that the user has permissions to complete the requested action.</p>
<p>For example, if Bob has the policy below, then he can read pods only in the namespace <code>projectCaribou</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:green;font-weight:700>&#34;apiVersion&#34;</span>: <span style=color:#b44>&#34;abac.authorization.kubernetes.io/v1beta1&#34;</span>,
    <span style=color:green;font-weight:700>&#34;kind&#34;</span>: <span style=color:#b44>&#34;Policy&#34;</span>,
    <span style=color:green;font-weight:700>&#34;spec&#34;</span>: {
        <span style=color:green;font-weight:700>&#34;user&#34;</span>: <span style=color:#b44>&#34;bob&#34;</span>,
        <span style=color:green;font-weight:700>&#34;namespace&#34;</span>: <span style=color:#b44>&#34;projectCaribou&#34;</span>,
        <span style=color:green;font-weight:700>&#34;resource&#34;</span>: <span style=color:#b44>&#34;pods&#34;</span>,
        <span style=color:green;font-weight:700>&#34;readonly&#34;</span>: <span style=color:#a2f;font-weight:700>true</span>
    }
}
</code></pre></div><p>If Bob makes the following request, the request is authorized because he is allowed to read objects in the <code>projectCaribou</code> namespace:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:green;font-weight:700>&#34;apiVersion&#34;</span>: <span style=color:#b44>&#34;authorization.k8s.io/v1beta1&#34;</span>,
  <span style=color:green;font-weight:700>&#34;kind&#34;</span>: <span style=color:#b44>&#34;SubjectAccessReview&#34;</span>,
  <span style=color:green;font-weight:700>&#34;spec&#34;</span>: {
    <span style=color:green;font-weight:700>&#34;resourceAttributes&#34;</span>: {
      <span style=color:green;font-weight:700>&#34;namespace&#34;</span>: <span style=color:#b44>&#34;projectCaribou&#34;</span>,
      <span style=color:green;font-weight:700>&#34;verb&#34;</span>: <span style=color:#b44>&#34;get&#34;</span>,
      <span style=color:green;font-weight:700>&#34;group&#34;</span>: <span style=color:#b44>&#34;unicorn.example.org&#34;</span>,
      <span style=color:green;font-weight:700>&#34;resource&#34;</span>: <span style=color:#b44>&#34;pods&#34;</span>
    }
  }
}
</code></pre></div><p>If Bob makes a request to write (<code>create</code> or <code>update</code>) to the objects in the <code>projectCaribou</code> namespace, his authorization is denied. If Bob makes a request to read (<code>get</code>) objects in a different namespace such as <code>projectFish</code>, then his authorization is denied.</p>
<p>Kubernetes authorization requires that you use common REST attributes to interact with existing organization-wide or cloud-provider-wide access control systems. It is important to use REST formatting because these control systems might interact with other APIs besides the Kubernetes API.</p>
<p>Kubernetes supports multiple authorization modules, such as ABAC mode, RBAC Mode, and Webhook mode. When an administrator creates a cluster, they configure the authorization modules that should be used in the API server. If more than one authorization modules are configured, Kubernetes checks each module, and if any module authorizes the request, then the request can proceed. If all of the modules deny the request, then the request is denied (HTTP status code 403).</p>
<p>To learn more about Kubernetes authorization, including details about creating policies using the supported authorization modules, see <a href=/docs/reference/access-authn-authz/authorization/>Authorization</a>.</p>
<h2 id=admission-control>Admission control</h2>
<p>Admission Control modules are software modules that can modify or reject requests.
In addition to the attributes available to Authorization modules, Admission
Control modules can access the contents of the object that is being created or modified.</p>
<p>Admission controllers act on requests that create, modify, delete, or connect to (proxy) an object.
Admission controllers do not act on requests that merely read objects.
When multiple admission controllers are configured, they are called in order.</p>
<p>This is shown as step <strong>3</strong> in the diagram.</p>
<p>Unlike Authentication and Authorization modules, if any admission controller module
rejects, then the request is immediately rejected.</p>
<p>In addition to rejecting objects, admission controllers can also set complex defaults for
fields.</p>
<p>The available Admission Control modules are described in <a href=/docs/reference/access-authn-authz/admission-controllers/>Admission Controllers</a>.</p>
<p>Once a request passes all admission controllers, it is validated using the validation routines
for the corresponding API object, and then written to the object store (shown as step <strong>4</strong>).</p>
<h2 id=auditing>Auditing</h2>
<p>Kubernetes auditing provides a security-relevant, chronological set of records documenting the sequence of actions in a cluster.
The cluster audits the activities generated by users, by applications that use the Kubernetes API, and by the control plane itself.</p>
<p>For more information, see <a href=/docs/tasks/debug/debug-cluster/audit/>Auditing</a>.</p>
<h2 id=api-server-ports-and-ips>API server ports and IPs</h2>
<p>The previous discussion applies to requests sent to the secure port of the API server
(the typical case). The API server can actually serve on 2 ports:</p>
<p>By default, the Kubernetes API server serves HTTP on 2 ports:</p>
<ol>
<li>
<p><code>localhost</code> port:</p>
<ul>
<li>is intended for testing and bootstrap, and for other components of the master node
(scheduler, controller-manager) to talk to the API</li>
<li>no TLS</li>
<li>default is port 8080</li>
<li>default IP is localhost, change with <code>--insecure-bind-address</code> flag.</li>
<li>request <strong>bypasses</strong> authentication and authorization modules.</li>
<li>request handled by admission control module(s).</li>
<li>protected by need to have host access</li>
</ul>
</li>
<li>
<p>“Secure port”:</p>
<ul>
<li>use whenever possible</li>
<li>uses TLS. Set cert with <code>--tls-cert-file</code> and key with <code>--tls-private-key-file</code> flag.</li>
<li>default is port 6443, change with <code>--secure-port</code> flag.</li>
<li>default IP is first non-localhost network interface, change with <code>--bind-address</code> flag.</li>
<li>request handled by authentication and authorization modules.</li>
<li>request handled by admission control module(s).</li>
<li>authentication and authorization modules run.</li>
</ul>
</li>
</ol>
<h2 id=what-s-next>What's next</h2>
<p>Read more documentation on authentication, authorization and API access control:</p>
<ul>
<li><a href=/docs/reference/access-authn-authz/authentication/>Authenticating</a>
<ul>
<li><a href=/docs/reference/access-authn-authz/bootstrap-tokens/>Authenticating with Bootstrap Tokens</a></li>
</ul>
</li>
<li><a href=/docs/reference/access-authn-authz/admission-controllers/>Admission Controllers</a>
<ul>
<li><a href=/docs/reference/access-authn-authz/extensible-admission-controllers/>Dynamic Admission Control</a></li>
</ul>
</li>
<li><a href=/docs/reference/access-authn-authz/authorization/>Authorization</a>
<ul>
<li><a href=/docs/reference/access-authn-authz/rbac/>Role Based Access Control</a></li>
<li><a href=/docs/reference/access-authn-authz/abac/>Attribute Based Access Control</a></li>
<li><a href=/docs/reference/access-authn-authz/node/>Node Authorization</a></li>
<li><a href=/docs/reference/access-authn-authz/webhook/>Webhook Authorization</a></li>
</ul>
</li>
<li><a href=/docs/reference/access-authn-authz/certificate-signing-requests/>Certificate Signing Requests</a>
<ul>
<li>including <a href=/docs/reference/access-authn-authz/certificate-signing-requests/#approval-rejection>CSR approval</a>
and <a href=/docs/reference/access-authn-authz/certificate-signing-requests/#signing>certificate signing</a></li>
</ul>
</li>
<li>Service accounts
<ul>
<li><a href=/docs/tasks/configure-pod-container/configure-service-account/>Developer guide</a></li>
<li><a href=/docs/reference/access-authn-authz/service-accounts-admin/>Administration</a></li>
</ul>
</li>
</ul>
<p>You can learn about:</p>
<ul>
<li>how Pods can use
<a href=/docs/concepts/configuration/secret/#service-accounts-automatically-create-and-attach-secrets-with-api-credentials>Secrets</a>
to obtain API credentials.</li>
</ul>
</div>
</main>
</div>
</div>
<footer class=d-print-none>
<div class=footer__links>
<nav>
<a class=text-white href=/docs/home/>Home</a>
<a class=text-white href=/blog/>Blog</a>
<a class=text-white href=/training/>Training</a>
<a class=text-white href=/partners/>Partners</a>
<a class=text-white href=/community/>Community</a>
<a class=text-white href=/case-studies/>Case Studies</a>
</nav>
</div>
<div class=container-fluid>
<div class=row>
<div class="col-6 col-sm-2 text-xs-center order-sm-2">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list">
<a class=text-white target=_blank href=https://discuss.kubernetes.io>
<i class="fa fa-envelope"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter>
<a class=text-white target=_blank href=https://twitter.com/kubernetesio>
<i class="fab fa-twitter"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Calendar aria-label=Calendar>
<a class=text-white target=_blank href="https://calendar.google.com/calendar/embed?src=calendar%40kubernetes.io">
<i class="fas fa-calendar-alt"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Youtube aria-label=Youtube>
<a class=text-white target=_blank href=https://youtube.com/kubernetescommunity>
<i class="fab fa-youtube"></i>
</a>
</li>
</ul>
</div>
<div class="col-6 col-sm-2 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank href=https://github.com/kubernetes/kubernetes>
<i class="fab fa-github"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack>
<a class=text-white target=_blank href=https://slack.k8s.io>
<i class="fab fa-slack"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Contribute aria-label=Contribute>
<a class=text-white target=_blank href=https://git.k8s.io/community/contributors/guide>
<i class="fas fa-edit"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow">
<a class=text-white target=_blank href=https://stackoverflow.com/questions/tagged/kubernetes>
<i class="fab fa-stack-overflow"></i>
</a>
</li>
</ul>
</div>
<div class="col-12 col-sm-8 text-center order-sm-2">
<small class=text-white>&copy; 2023 The Kubernetes Authors | Documentation Distributed under <a href=https://git.k8s.io/website/LICENSE class=light-text>CC BY 4.0</a></small>
<br>
<small class=text-white>Copyright &copy; 2023 The Linux Foundation &reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage class=light-text>Trademark Usage page</a></small>
<br>
<small class=text-white>ICP license: 京ICP备17074266号-3</small>
</div>
</div>
</div>
</footer>
</div>
<script src=/js/popper-1.14.3.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=/js/bootstrap-4.3.1.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script>
<script src=/js/main.min.40616251a9b6e4b689e7769be0340661efa4d7ebb73f957404e963e135b4ed52.js integrity="sha256-QGFiUam25LaJ53ab4DQGYe+k1+u3P5V0BOlj4TW07VI=" crossorigin=anonymous></script>
</body>
</html>